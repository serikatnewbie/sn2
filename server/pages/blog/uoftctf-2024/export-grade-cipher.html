<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png?v=2"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png?v=2"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png?v=2"/><link rel="manifest" href="/static/favicons/site.webmanifest?v=2"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg?v=2" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');d.add('dark');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>UofTCTF 2024 – Export Grade Cipher</title><meta name="robots" content="follow, index"/><meta name="description" content="Recover LFSR by using chosen plaintext in a faulty cipher"/><meta property="og:url" content="https://sekai.team/blog/uoftctf-2024/export-grade-cipher/"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Project SEKAI"/><meta property="og:description" content="Recover LFSR by using chosen plaintext in a faulty cipher"/><meta property="og:title" content="UofTCTF 2024 – Export Grade Cipher"/><meta property="og:image" content="https://og-vercel-ruby.vercel.app/api/sekai?title=UofTCTF+2024+%E2%80%93+Export+Grade+Cipher&amp;desc=Recover+LFSR+by+using+chosen+plaintext+in+a+faulty+cipher&amp;authors=Wrth"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/ProjectSEKAIctf"/><meta name="twitter:title" content="UofTCTF 2024 – Export Grade Cipher"/><meta name="twitter:description" content="Recover LFSR by using chosen plaintext in a faulty cipher"/><meta name="twitter:image" content="https://og-vercel-ruby.vercel.app/api/sekai?title=UofTCTF+2024+%E2%80%93+Export+Grade+Cipher&amp;desc=Recover+LFSR+by+using+chosen+plaintext+in+a+faulty+cipher&amp;authors=Wrth"/><meta property="article:published_time" content="2024-01-15T00:00:00.000Z"/><link rel="canonical" href="https://sekai.team/blog/uoftctf-2024/export-grade-cipher/"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sekai.team/blog/uoftctf-2024/export-grade-cipher"
  },
  "headline": "UofTCTF 2024 – Export Grade Cipher",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://og-vercel-ruby.vercel.app/api/sekai?title=UofTCTF+2024+%E2%80%93+Export+Grade+Cipher&desc=Recover+LFSR+by+using+chosen+plaintext+in+a+faulty+cipher&authors=Wrth"
    }
  ],
  "datePublished": "2024-01-15T00:00:00.000Z",
  "dateModified": "2024-01-15T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Wrth"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Project SEKAI",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sekai.team/static/images/fullLogo.svg"
    }
  },
  "description": "Recover LFSR by using chosen plaintext in a faulty cipher"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/206f24680f6266ec.css" as="style"/><link rel="stylesheet" href="/_next/static/css/206f24680f6266ec.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-09a75c9ee2bd415e.js" defer=""></script><script src="/_next/static/chunks/main-b8c3e234d7065a2c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b8cbc7cb85baf88e.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/29107295-a2d0c8e72019a3ed.js" defer=""></script><script src="/_next/static/chunks/545-f1dc6b53ce85b08b.js" defer=""></script><script src="/_next/static/chunks/930-1296a6163e1e3cc6.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-9a47024c9df525b8.js" defer=""></script><script src="/_next/static/0wxHpwy3ehtFejYPlY-Z7/_buildManifest.js" defer=""></script><script src="/_next/static/0wxHpwy3ehtFejYPlY-Z7/_ssgManifest.js" defer=""></script><script src="/_next/static/0wxHpwy3ehtFejYPlY-Z7/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="Visit home page" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 468.7 215.63" height="80" width="auto"><defs><linearGradient id="fullLogo_svg__linear-gradient" x1="-7051.74" y1="5608.42" x2="-7051.74" y2="5392.1" gradientTransform="matrix(1 0 .15 -.99 6503.98 5547.9)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#00e5ea"></stop><stop offset="1" stop-color="#00b5cc"></stop></linearGradient><linearGradient id="fullLogo_svg__linear-gradient-2" x1="1498.32" y1="4428.84" x2="1497.92" y2="4311.82" gradientTransform="matrix(1 0 0 -1 -1107.01 4435.41)" xlink:href="#fullLogo_svg__linear-gradient"></linearGradient><linearGradient id="fullLogo_svg__linear-gradient-3" x1="320.76" y1="14.17" x2="320.76" y2="47.97" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0069a5"></stop><stop offset="1" stop-color="#003d6b"></stop></linearGradient><style>.fullLogo_svg__cls-1{fill:#fff}</style></defs><g id="fullLogo_svg__Project_SEKAI_Wide_White" data-name="Project SEKAI Wide White"><path class="fullLogo_svg__cls-1" d="M107 117.14v-4c11.93 0 22.15-8.62 23.76-20l12.91-91.63h4.06l-13 92.14c-1.92 13.4-13.84 23.49-27.73 23.49Z"></path><path class="fullLogo_svg__cls-1" d="M97.43 98.3a16 16 0 0 1-16.26-18.72l8.68-61.42A21.78 21.78 0 0 1 110.77 0a16.34 16.34 0 0 1 12.57 5.5A16.36 16.36 0 0 1 127 18.72l-8.69 61.42c-1.39 10.01-10.77 18.16-20.88 18.16ZM110.77 4a17.63 17.63 0 0 0-17 14.72l-8.64 61.42a12 12 0 0 0 12.3 14.16 17.65 17.65 0 0 0 16.95-14.72l8.69-61.42a12.41 12.41 0 0 0-2.75-10A12.4 12.4 0 0 0 110.77 4ZM186.94 5.42l.56-3.91H162.99l-13.5 95.44H174l.57-4h-20.46l5.85-41.36h20.46l.56-4h-20.45l5.96-42.17h20.45zM266.73 1.51h-31.01l-.55 3.91h14.2l-12.95 91.53h4.06l12.93-91.53h12.77l.55-3.91zM212.61 1.51a15.86 15.86 0 0 0-15.24 13.24l-9.86 69.48a11.69 11.69 0 0 0 2.76 9.34 12.57 12.57 0 0 0 9.18 4.43h.2c6.38 0 11.65-5.57 15.15-9.28L211.9 86c-3.06 3.23-7.67 8.11-12.38 8a8.54 8.54 0 0 1-6.21-3 7.73 7.73 0 0 1-1.84-6.18l9.86-69.48a11.83 11.83 0 0 1 11.28-9.9h13.91l.55-3.91ZM37.08 5.58a12 12 0 0 0-9.26-4.06H13.5L0 97h4.06l6.41-45.37h10.84a15.87 15.87 0 0 0 15.24-13.29l3.25-23a12 12 0 0 0-2.72-9.76Zm-1.24 9.17-3.26 23a11.74 11.74 0 0 1-11.27 9.8H11l6-42.13h10.85a7.94 7.94 0 0 1 8 9.33ZM75.09 5.58a12 12 0 0 0-9.26-4.06h-14.3L38 97h4l6.5-45.42h10L65 96.2h4l-6.6-45a16 16 0 0 0 12.16-12.86l3.25-23a12 12 0 0 0-2.72-9.76Zm-1.24 9.17-3.25 23a11.76 11.76 0 0 1-11.28 9.8H49.07L55 5.42h10.86a7.94 7.94 0 0 1 8 9.33ZM223.75 215.47h-4.06l13.5-95.43h4.05l-13.49 95.43zM65.83 215.63a14.49 14.49 0 0 1-11-4.65 11.3 11.3 0 0 1-2.68-9.15l1.31-8.59 4.4-2.34-1.76 11.52a7.24 7.24 0 0 0 1.75 5.93 10.47 10.47 0 0 0 8 3.28c6.42 0 12.26-4.39 13-9.8l5.42-38.33-28.77 15.27 6.37-46c1-7.3 8.65-13.24 17-13.24a14.52 14.52 0 0 1 11 4.65 11.36 11.36 0 0 1 2.68 9.14l-1.2 8.68-4.35 2.34 1.64-11.6a7.29 7.29 0 0 0-1.74-6 10.5 10.5 0 0 0-8-3.28c-6.42 0-12.26 4.39-13 9.79l-5.29 38.27 28.8-15.28-6.52 46.1c-1.11 7.35-8.73 13.29-17.06 13.29ZM174.15 120.04h-4.51l-26.9 51.72 7.31-51.72H146l-13.5 95.43h4.05l4.5-31.8 10.61-20.4 12.61 52.2h4.11l-13.91-57.6 19.68-37.83zM205 215.47h4l-2.29-94.87v-.56h-4l-29.31 95.43h4.18l9.82-32h16.83Zm-16.37-36L203 132.68l1.13 46.81ZM132.58 123.94l.56-3.91h-24.52l-13.49 95.44h24.51l.56-4H99.75l5.85-41.36h20.45l.57-4h-20.46l5.97-42.17h20.45z"></path><path style="fill:url(#fullLogo_svg__linear-gradient)" d="M279.69 1.51h8.87l-32.09 213.93h-8.87L279.69 1.51z"></path><path d="M393.81 14.88C396 .34 331.4 1.5 296.53 1.5L283.6 87.67c33.36-1.94 99.5-2 97.21 13.27-1.14 7.58-5.53 7.29-6.1 11.08-1.52 10.14 70.94 5.62 81.15 4.52L434 73.6l34.7-43.29c-17.47 1.81-82.47 4.94-81.11-4.15.73-4.87 5.41-5.56 6.22-11.28Z" style="fill:url(#fullLogo_svg__linear-gradient-2)"></path><path d="m324.34 13-5.8 25.24A9.73 9.73 0 0 0 312 36c-4.66 0-8.43 2.82-8.42 6.27s3.8 6.24 8.46 6.22c4 0 7.4-2.12 8.23-4.92 0-.14.06-.28.09-.42l3.48-15.5q9.18 2.06 9.72 5.26a9 9 0 0 1-1.27 6.22 10.78 10.78 0 0 0 5.7-8.81q.48-5.88-13.65-17.32Z" style="fill:url(#fullLogo_svg__linear-gradient-3)"></path></g></svg></div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/members/">Members</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/contests/">Contests</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog/">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags/">Tags</a><a target="_blank" rel="noopener noreferrer" href="https://ctf.sekai.team/" class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100">CTF 2023</a></div><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/members/">Members</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/contests/">Contests</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog/">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags/">Tags</a></div><div class="px-12 py-4"><a target="_blank" rel="noopener noreferrer" href="https://ctf.sekai.team/" class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">CTF 2023</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2024-01-15T00:00:00.000Z">Monday, 15 January 2024</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">UofTCTF 2024 – Export Grade Cipher</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 xl:block sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="https://www.gravatar.com/avatar/11bd96e570fd4e221e1592df8dd95894?d=identicon&amp;size=256" width="38px" height="38px" alt="avatar" class="w-10 h-10 rounded-full"/><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Wrth</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/Wrth1_" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@Wrth1_</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><h2 id="export-grade-cipher-crypto-10-solves"><a href="#export-grade-cipher-crypto-10-solves" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Export Grade Cipher (Crypto, 10 Solves)</h2>
<blockquote>
<p>This &quot;state of the art&quot;™ cipher can be exported to your enemies without restriction.</p>
<p>Author: nullptr</p>
<p>nc 0.cloud.chals.io 23753</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/UofTCTF/uoftctf-2024-chals-public/tree/master/Cryptography/export-grade-cipher/">Attachment &amp; official solution</a></p>
</blockquote>
<p>This crypto challenge is a custom cipher, so we can’t really rely on any known attacks. It doesn’t require much complex math knowledge, but the difficulty lies on being able to extract any useful information from this chosen-plaintext attack.</p>
<p>We are given the source code and a module, this is what <code>chal.py</code> looks like:</p>
<div class="relative"><pre><code class="language-py code-highlight"><span class="code-line"><span class="token keyword">import</span> ast
</span><span class="code-line"><span class="token keyword">import</span> threading
</span><span class="code-line"><span class="token keyword">from</span> exportcipher <span class="token keyword">import</span> <span class="token operator">*</span>
</span><span class="code-line"><span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">from</span> flag <span class="token keyword">import</span> FLAG
</span><span class="code-line"><span class="token keyword">except</span><span class="token punctuation">:</span>
</span><span class="code-line">    FLAG <span class="token operator">=</span> <span class="token string">&quot;test{FLAG}&quot;</span>
</span><span class="code-line">
</span><span class="code-line">MAX_COUNT <span class="token operator">=</span> <span class="token number">100</span>
</span><span class="code-line">TIMEOUT <span class="token operator">=</span> <span class="token number">120</span> <span class="token comment"># seconds</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">input_bytes</span><span class="token punctuation">(</span>display_msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    m <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span>display_msg<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line">        m <span class="token operator">=</span> ast<span class="token punctuation">.</span>literal_eval<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">except</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token comment"># might not be valid str or bytes literal but could still be valid input, so just encode it</span>
</span><span class="code-line">        <span class="token keyword">pass</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        m <span class="token operator">=</span> m<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">return</span> m
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">timeout_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Time is up, you can throw out your work as the key changed.&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Initializing Export Grade Cipher...&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    key <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    cipher <span class="token operator">=</span> ExportGradeCipher<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;You may choose up to {} plaintext messages to encrypt.&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>MAX_COUNT<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Recover the 40-bit key to get the flag.&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;You have {} seconds.&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>TIMEOUT<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token comment"># enough time to crack a 40 bit key with the compute resources of a government</span>
</span><span class="code-line">    threading<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span>TIMEOUT<span class="token punctuation">,</span> timeout_handler<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    i <span class="token operator">=</span> <span class="token number">0</span>
</span><span class="code-line">    <span class="token keyword">while</span> i <span class="token operator">&lt;</span> MAX_COUNT<span class="token punctuation">:</span>
</span><span class="code-line">        pt <span class="token operator">=</span> input_bytes<span class="token punctuation">(</span><span class="token string">&quot;[MSG {}] plaintext: &quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token keyword">not</span> pt<span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">break</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">512</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token comment"># don&#x27;t allow excessively long messages</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Message Too Long!&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">continue</span>
</span><span class="code-line">        nonce <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>
</span><span class="code-line">        cipher<span class="token punctuation">.</span>init_with_nonce<span class="token punctuation">(</span>nonce<span class="token punctuation">)</span>
</span><span class="code-line">        ct <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>pt<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;[MSG {}] nonce: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> nonce<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;[MSG {}] ciphertext: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> ct<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token comment"># sanity check decryption</span>
</span><span class="code-line">        cipher<span class="token punctuation">.</span>init_with_nonce<span class="token punctuation">(</span>nonce<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">assert</span> pt <span class="token operator">==</span> cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>ct<span class="token punctuation">)</span>
</span><span class="code-line">        i <span class="token operator">+=</span> <span class="token number">1</span>
</span><span class="code-line">    recovered_key <span class="token operator">=</span> ast<span class="token punctuation">.</span>literal_eval<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;Recovered Key: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>recovered_key<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">if</span> recovered_key <span class="token operator">==</span> key<span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;That is the key! Here is the flag: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>FLAG<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Wrong!&quot;</span><span class="token punctuation">)</span>
</span></code></pre></div>
<p>So here we can encrypt 100 ciphertexts using <code>ExportGradeCipher</code>, each with a different nonce. Then we have to guess the 40-bit key.</p>
<p>So how does <code>ExportGradeCipher</code> work?</p>
<div class="relative"><pre><code class="language-py code-highlight"><span class="code-line"><span class="token keyword">import</span> os
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">LFSR</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seed<span class="token punctuation">,</span> taps<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">assert</span> seed <span class="token operator">!=</span> <span class="token number">0</span>
</span><span class="code-line">        <span class="token keyword">assert</span> <span class="token punctuation">(</span>seed <span class="token operator">&gt;&gt;</span> size<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
</span><span class="code-line">        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>taps<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">in</span> taps
</span><span class="code-line">        self<span class="token punctuation">.</span>state <span class="token operator">=</span> seed
</span><span class="code-line">        self<span class="token punctuation">.</span>taps <span class="token operator">=</span> taps
</span><span class="code-line">        self<span class="token punctuation">.</span>mask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">_shift</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        feedback <span class="token operator">=</span> <span class="token number">0</span>
</span><span class="code-line">        <span class="token keyword">for</span> tap <span class="token keyword">in</span> self<span class="token punctuation">.</span>taps<span class="token punctuation">:</span>
</span><span class="code-line">            feedback <span class="token operator">^</span><span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>state <span class="token operator">&gt;&gt;</span> tap<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>state <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> feedback<span class="token punctuation">)</span> <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>mask
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">next_byte</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        val <span class="token operator">=</span> self<span class="token punctuation">.</span>state <span class="token operator">&amp;</span> <span class="token number">0xFF</span>
</span><span class="code-line">        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>_shift<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">return</span> val
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">ExportGradeCipher</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token comment"># 40 bit key</span>
</span><span class="code-line">        <span class="token keyword">assert</span> <span class="token punctuation">(</span>key <span class="token operator">&gt;&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>key <span class="token operator">=</span> key
</span><span class="code-line">        self<span class="token punctuation">.</span>initialized <span class="token operator">=</span> <span class="token boolean">False</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">init_with_nonce</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nonce<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token comment"># 256 byte nonce, nonce size isnt export controlled so hopefully this will compensate for the short key size</span>
</span><span class="code-line">        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nonce<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">256</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>lfsr17 <span class="token operator">=</span> LFSR<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>key <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>lfsr32 <span class="token operator">=</span> LFSR<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>key <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0xAB</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFFFFFFFF</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>S <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</span><span class="code-line">        <span class="token comment"># Fisher-Yates shuffle S-table</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token comment"># generate j s.t. 0 &lt;= j &lt;= i, has modulo bias but good luck exploiting that</span>
</span><span class="code-line">            j <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>lfsr17<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> self<span class="token punctuation">.</span>lfsr32<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
</span><span class="code-line">        j <span class="token operator">=</span> <span class="token number">0</span>
</span><span class="code-line">        <span class="token comment"># use nonce to scramble S-table some more</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> self<span class="token punctuation">.</span>lfsr17<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> self<span class="token punctuation">.</span>lfsr32<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> nonce<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>S_inv <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>S_inv<span class="token punctuation">[</span>self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i
</span><span class="code-line">        self<span class="token punctuation">.</span>initialized <span class="token operator">=</span> <span class="token boolean">True</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        i <span class="token operator">=</span> self<span class="token punctuation">.</span>lfsr17<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> self<span class="token punctuation">.</span>lfsr32<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>S_inv<span class="token punctuation">[</span>self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> v
</span><span class="code-line">        self<span class="token punctuation">.</span>S_inv<span class="token punctuation">[</span>self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">assert</span> self<span class="token punctuation">.</span>initialized
</span><span class="code-line">        ct <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">for</span> v <span class="token keyword">in</span> msg<span class="token punctuation">:</span>
</span><span class="code-line">            ct <span class="token operator">+=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>_update<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">return</span> ct
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ct<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">assert</span> self<span class="token punctuation">.</span>initialized
</span><span class="code-line">        msg <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">for</span> v <span class="token keyword">in</span> ct<span class="token punctuation">:</span>
</span><span class="code-line">            vo <span class="token operator">=</span> self<span class="token punctuation">.</span>S_inv<span class="token punctuation">[</span>v<span class="token punctuation">]</span>
</span><span class="code-line">            msg <span class="token operator">+=</span> vo<span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>_update<span class="token punctuation">(</span>vo<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">return</span> msg
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
</span><span class="code-line">    cipher <span class="token operator">=</span> ExportGradeCipher<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    nonce <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Cipher Key: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Nonce: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>nonce<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    msg <span class="token operator">=</span> <span class="token string">&quot;...&quot;</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Plaintext: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    cipher<span class="token punctuation">.</span>init_with_nonce<span class="token punctuation">(</span>nonce<span class="token punctuation">)</span>
</span><span class="code-line">    ct <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Ciphertext: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ct<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    cipher<span class="token punctuation">.</span>init_with_nonce<span class="token punctuation">(</span>nonce<span class="token punctuation">)</span>
</span><span class="code-line">    dec <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>ct<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Decrypted: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>dec<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">assert</span> msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> dec
</span><span class="code-line">    <span class="token keyword">except</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Decryption failed&quot;</span><span class="token punctuation">)</span>
</span></code></pre></div>
<p>Essentially it generates a very scrambled S-box using the key and nonce, and then does substitution to the plaintext. But to add more confusion we update the S-box for every character that we substitute.</p>
<p>So how do we approach this problem? We can start by analyzing some possible simple attacks first:</p>
<h3 id="bruteforce"><a href="#bruteforce" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Bruteforce?</h3>
<p>As noted by the comments as well, it seems very unlikely to bruteforce the whole 40-bit key in reasonable time. However, do take a look at how the key is actually used:</p>
<div class="relative"><pre><code class="language-py code-highlight"><span class="code-line">self<span class="token punctuation">.</span>lfsr17 <span class="token operator">=</span> LFSR<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>key <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span>
</span><span class="code-line">self<span class="token punctuation">.</span>lfsr32 <span class="token operator">=</span> LFSR<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>key <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0xAB</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFFFFFFFF</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
</span></code></pre></div>
<p>So it breaks the key into 2 parts, the last 16 bits are used for LFSR17, and the other 24 bits are used for LFSR32.</p>
<p>This means that although we can’t bruteforce the entire key, we might be able to just bruteforce the LFSR17 which is 16 bits of the key in case we need it. This observation alone will not lead us to the solution but it will be used later.</p>
<p>The other thing that we might need to note is that everything here operates using this LFSR, in LFSR we can shift and also unshift the state. This means that if we recover any state of the LSFR, we can unshift them back to the original key.</p>
<h3 id="recovering-lfsr-state"><a href="#recovering-lfsr-state" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Recovering LFSR State</h3>
<p>So the idea is getting clearer, we want to extract the state of the LFSR, preferably LFSR32 since as we discuss previously we can just perform bruteforcing to find LFSR17. We can analyze this very confusing S-box generating function and we can probably find some crazy relation with the LFSR state maybe?</p>
<p>There is just one problem: IT IS WAY TOO SCRAMBLY</p>
<p>Let’s just cross the <code>init_with_nonce</code> out and suppose it’s secure, there is only one place left where the LFSR is actually used, the <code>_update()</code> function.</p>
<h3 id="_update"><a href="#_update" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>_update()</code></h3>
<p>We know how the encryption works, it substitutes the plaintext using the generated S-box and then updates the S-box by swapping the value for the current character with another number produced by the LFSR.</p>
<div class="relative"><pre><code class="language-py code-highlight"><span class="code-line"><span class="token keyword">def</span> <span class="token function">_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    i <span class="token operator">=</span> self<span class="token punctuation">.</span>lfsr17<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> self<span class="token punctuation">.</span>lfsr32<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span>
</span><span class="code-line">    self<span class="token punctuation">.</span>S_inv<span class="token punctuation">[</span>self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> v
</span><span class="code-line">    self<span class="token punctuation">.</span>S_inv<span class="token punctuation">[</span>self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">assert</span> self<span class="token punctuation">.</span>initialized
</span><span class="code-line">    ct <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">for</span> v <span class="token keyword">in</span> msg<span class="token punctuation">:</span>
</span><span class="code-line">        ct <span class="token operator">+=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>_update<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">return</span> ct
</span></code></pre></div>
<p>This is interesting because it makes it such that the same consecutive characters will have different values. You can try it yourself, it will give different values for each consecutive character.</p>
<p><img src="/static/images/uoftctf-2024/pt-ct-mapping.png" alt="Image of plaintext &quot;AAAA&quot; mapping to ciphertext with 4 different bytes"/></p>
<p>But do take a look at the code again, what <em>if</em> v is equal to i?</p>
<div class="relative"><pre><code class="language-python code-highlight"><span class="code-line"><span class="token keyword">def</span> <span class="token function">_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    i <span class="token operator">=</span> self<span class="token punctuation">.</span>lfsr17<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> self<span class="token punctuation">.</span>lfsr32<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span>
</span><span class="code-line">    self<span class="token punctuation">.</span>S_inv<span class="token punctuation">[</span>self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> v
</span><span class="code-line">    self<span class="token punctuation">.</span>S_inv<span class="token punctuation">[</span>self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i
</span></code></pre></div>
<p>If <code>v == i</code>, then the S-box will not change, thus the consecutive characters WILL HAVE THE SAME VALUE!</p>
<p>Let’s try to check the <code>i</code> value and give inputs that match it. I updated the script and also doesn’t print the nonce for debug purposes:</p>
<div class="relative"><pre><code class="language-python code-highlight"><span class="code-line"><span class="token keyword">def</span> <span class="token function">_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    i <span class="token operator">=</span> self<span class="token punctuation">.</span>lfsr17<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> self<span class="token punctuation">.</span>lfsr32<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span>
</span><span class="code-line">    self<span class="token punctuation">.</span>S_inv<span class="token punctuation">[</span>self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> v
</span><span class="code-line">    self<span class="token punctuation">.</span>S_inv<span class="token punctuation">[</span>self<span class="token punctuation">.</span>S<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i
</span></code></pre></div>
<p><img src="/static/images/uoftctf-2024/output-update.png" alt="Image of output corresponding to _update"/></p>
<p>So we are right, we can now extract <code>i</code> by trying all to input a consecutive value. This works for any index too:</p>
<p><img src="/static/images/uoftctf-2024/output-update-any-idx.png" alt="Image of output for any index"/></p>
<h2 id="putting-it-all-together"><a href="#putting-it-all-together" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Putting it all together</h2>
<p>We know <code>i</code> is just xor of the 2 states of the LFSR, and we can bruteforce for LFSR17, so in order to get the full state of LFSR32, we need 4 consecutive <code>i</code>s (each <code>i</code> is 1 byte and LFSR32 is 4 bytes). Because we can only do 100 plaintexts, it’s not guaranteed, but the length limit is not bad (512 bytes) so we have a very decent chance that at least 4 consecutive <code>i</code>s among the 512 have a value below 100.</p>
<p>After recovering 4 consecutive <code>i</code> values, we can bruteforce all LFSR17, get the state of LFSR32, and unshift them enough to get the original key.</p>
<p>It needs a little bit of calculation but basically the <code>init_with_nonce</code> function does 511 <code>next_byte</code> per LFSR so it’s 4088 shifts, we also need to add the the starting point from the 512 bytes that we encrypt. 4088 shifts is a lot of work even to bruteforce the LFSR17 so I recommend to do a precalculation before connecting to the remote server.</p>
<p>Full solver:</p>
<div class="relative"><pre><code class="language-py code-highlight"><span class="code-line"><span class="token keyword">from</span> wrth <span class="token keyword">import</span> <span class="token operator">*</span>
</span><span class="code-line"><span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">LFSR</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seed<span class="token punctuation">,</span> taps<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">assert</span> seed <span class="token operator">!=</span> <span class="token number">0</span>
</span><span class="code-line">        <span class="token keyword">assert</span> <span class="token punctuation">(</span>seed <span class="token operator">&gt;&gt;</span> size<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
</span><span class="code-line">        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>taps<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">in</span> taps
</span><span class="code-line">        self<span class="token punctuation">.</span>state <span class="token operator">=</span> seed
</span><span class="code-line">        self<span class="token punctuation">.</span>taps <span class="token operator">=</span> taps
</span><span class="code-line">        self<span class="token punctuation">.</span>mask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>size <span class="token operator">=</span> size
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">_shift</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        feedback <span class="token operator">=</span> <span class="token number">0</span>
</span><span class="code-line">        <span class="token keyword">for</span> tap <span class="token keyword">in</span> self<span class="token punctuation">.</span>taps<span class="token punctuation">:</span>
</span><span class="code-line">            feedback <span class="token operator">^</span><span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>state <span class="token operator">&gt;&gt;</span> tap<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>state <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> feedback<span class="token punctuation">)</span> <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>mask
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">_unshift</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        feedback <span class="token operator">=</span> self<span class="token punctuation">.</span>state <span class="token operator">&amp;</span> <span class="token number">1</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>state <span class="token operator">&gt;&gt;</span><span class="token operator">=</span> <span class="token number">1</span>
</span><span class="code-line">        <span class="token keyword">for</span> tap <span class="token keyword">in</span> self<span class="token punctuation">.</span>taps<span class="token punctuation">:</span>
</span><span class="code-line">            feedback <span class="token operator">^</span><span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>state <span class="token operator">&gt;&gt;</span> tap<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>state <span class="token operator">|</span><span class="token operator">=</span> feedback <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">next_byte</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        val <span class="token operator">=</span> self<span class="token punctuation">.</span>state <span class="token operator">&amp;</span> <span class="token number">0xFF</span>
</span><span class="code-line">        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>_shift<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">return</span> val
</span><span class="code-line">
</span><span class="code-line">lfsr17precalc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;precalc&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">for</span> i <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    lfsr17 <span class="token operator">=</span> LFSR<span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4088</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        lfsr17<span class="token punctuation">.</span>_shift<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    lfsr17precalc<span class="token punctuation">.</span>append<span class="token punctuation">(</span>lfsr17<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">r <span class="token operator">=</span> con<span class="token punctuation">(</span><span class="token string">&quot;nc 0.cloud.chals.io 23753&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">recover_i</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">512</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;generating ciphertext...&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        secret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line">        test <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">512</span><span class="token punctuation">)</span>
</span><span class="code-line">        r<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b&quot;plaintext: &quot;</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        r<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b&quot;nonce: &quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        nonce <span class="token operator">=</span> r<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        r<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b&quot;ciphertext: &quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        ct <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">if</span> ct<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> ct<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">                res<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> i
</span><span class="code-line">                <span class="token keyword">break</span>
</span><span class="code-line">
</span><span class="code-line">    starting <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
</span><span class="code-line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">if</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> res<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> res<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> res<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
</span><span class="code-line">            starting <span class="token operator">=</span> i
</span><span class="code-line">            <span class="token keyword">break</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">if</span> starting <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;run again&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>starting <span class="token operator">=</span> <span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    recovered <span class="token operator">=</span> res<span class="token punctuation">[</span>starting<span class="token punctuation">:</span>starting<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">]</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>recovered <span class="token operator">=</span> <span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">return</span> starting<span class="token punctuation">,</span> recovered<span class="token punctuation">,</span> res
</span><span class="code-line">
</span><span class="code-line">starting<span class="token punctuation">,</span> recovered<span class="token punctuation">,</span> res <span class="token operator">=</span> recover_i<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">shiftamount <span class="token operator">=</span> <span class="token number">4088</span> <span class="token operator">+</span> <span class="token punctuation">(</span>starting<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span>
</span><span class="code-line"><span class="token keyword">for</span> keylsb <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    lfsr32state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line">    lfsr17 <span class="token operator">=</span> lfsr17precalc<span class="token punctuation">[</span>keylsb<span class="token punctuation">]</span>
</span><span class="code-line">    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>starting<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        lfsr17<span class="token punctuation">.</span>_shift<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        lfsr32state<span class="token punctuation">.</span>append<span class="token punctuation">(</span>lfsr17<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">^</span> recovered<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">    lfsr32state <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>lfsr32state<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    lfsr32 <span class="token operator">=</span> LFSR<span class="token punctuation">(</span>lfsr32state<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
</span><span class="code-line">    good <span class="token operator">=</span> <span class="token boolean">True</span>
</span><span class="code-line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        lfsr17<span class="token punctuation">.</span>_unshift<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        lfsr32<span class="token punctuation">.</span>_unshift<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>starting<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        byte17 <span class="token operator">=</span> lfsr17<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        byte32 <span class="token operator">=</span> lfsr32<span class="token punctuation">.</span>next_byte<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">if</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">if</span> byte17 <span class="token operator">^</span> byte32 <span class="token operator">!=</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">                good <span class="token operator">=</span> <span class="token boolean">False</span>
</span><span class="code-line">                <span class="token keyword">break</span>
</span><span class="code-line">    <span class="token keyword">if</span> good<span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>starting<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">                lfsr32<span class="token punctuation">.</span>_unshift<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>shiftamount<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            lfsr32<span class="token punctuation">.</span>_unshift<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        keymsb <span class="token operator">=</span> <span class="token punctuation">(</span>lfsr32<span class="token punctuation">.</span>state <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token operator">**</span><span class="token number">24</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span>keymsb<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span>keylsb<span class="token punctuation">)</span>
</span><span class="code-line">        key <span class="token operator">=</span> <span class="token punctuation">(</span>keymsb <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">+</span> keylsb
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
</span><span class="code-line">        r<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b&quot;Key: &quot;</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        r<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre></div>
<p><strong>Flag:</strong> <code>uoftctf{wH0_w0u1D_h4ve_7houGHt_l0ng_nONceS_CAnt_S4ve_w3ak_KeYS}</code></p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fsekai.team%2Fblog%2Fuoftctf-2024%2Fexport-grade-cipher">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/blueset/sekai.team/blob/master/data/blog/uoftctf-2024/export-grade-cipher.md">View on GitHub</a></div></div><footer><div class="text-sm font-medium leading-5 divide-gray-200 xl:divide-y dark:divide-gray-700 xl:col-start-1 xl:row-start-2"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/uoftctf-2024/">UofTCTF-2024</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/crypto/">Crypto</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/lfsr/">LFSR</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/irisctf-2024/sharing-is-caring/">IrisCTF 2024 – Sharing is Caring</a></div></div><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/real-world-ctf-6th/safebridge/">Real World CTF 6th – SafeBridge</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog/">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:project.sekai@sekai.team"><span class="sr-only"><span class="w-6">mail</span></span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/project-sekai-ctf"><span class="sr-only"><span class="w-6">github</span></span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/company/project-sekai-ctf/"><span class="sr-only"><span class="w-6">linkedin</span></span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/ProjectSEKAIctf"><span class="sr-only"><span class="w-6">twitter</span></span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://ctftime.org/team/169557"><span class="sr-only"><span class="w-6">ctftime</span></span><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M24 0v24H0V0h24Zm-3.077 3.077L7.067 3.076 16 12.816 10.369 19l-2.195-2.612 3.476-3.573-8.574-9.609v17.717h17.847V3.077Z" fill="currentColor" fill-rule="evenodd"></path></svg></a></div></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><a href="/">Project SEKAI</a><div> • </div><div>© 2024</div><div> • </div><div><a href="https://1a23.com">1A23 Studio</a></div></div><div class="mb-8 text-xs text-center text-gray-200 dark:text-gray-700">This website is in no way affiliated with any of the following individuals or organizations.<!-- --> <a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a> © Timothy Lim and contributors; <a target="_blank" rel="noopener noreferrer" href="https://pjsekai.sega.jp/">Project SEKAI: Colorful Stage! feat. Hatsune Miku</a> © SEGA / © Craft Egg Inc. Developed by Colorful Palette; <a target="_blank" rel="noopener noreferrer" href="https://ec.crypton.co.jp/pages/prod/virtualsinger">Character Vocal Series</a> © Crypton Future Media, INC. <a target="_blank" rel="noopener noreferrer" href="https://www.piapro.net">www.piapro.net</a> All rights reserved.</div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var t=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var l=a=\u003et(a,\"__esModule\",{value:!0});var m=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{l(a);for(var c in s)t(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of d(s))!h.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026t(a,e,{get:()=\u003es[e],enumerable:!(c=p(s,e))||c.enumerable});return a},f=a=\u003ek(l(t(a!=null?r(u(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=m((v,i)=\u003e{i.exports=_jsx_runtime});var g={};N(g,{default:()=\u003ew,frontmatter:()=\u003eb});var n=f(o()),b={title:\"UofTCTF 2024 \\u2013 Export Grade Cipher\",date:\"2024-01-15\",draft:!1,authors:[\"wrth\"],tags:[\"UofTCTF 2024\",\"Crypto\",\"LFSR\"],summary:\"Recover LFSR by using chosen plaintext in a faulty cipher\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",blockquote:\"blockquote\",p:\"p\",code:\"code\",pre:\"pre\",h3:\"h3\",img:\"img\",em:\"em\",strong:\"strong\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"export-grade-cipher-crypto-10-solves\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#export-grade-cipher-crypto-10-solves\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Export Grade Cipher (Crypto, 10 Solves)\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:'This \"state of the art\"\\u2122 cipher can be exported to your enemies without restriction.'}),`\n`,(0,n.jsx)(e.p,{children:\"Author: nullptr\"}),`\n`,(0,n.jsx)(e.p,{children:\"nc 0.cloud.chals.io 23753\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/UofTCTF/uoftctf-2024-chals-public/tree/master/Cryptography/export-grade-cipher/\",children:\"Attachment \u0026 official solution\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"This crypto challenge is a custom cipher, so we can\\u2019t really rely on any known attacks. It doesn\\u2019t require much complex math knowledge, but the difficulty lies on being able to extract any useful information from this chosen-plaintext attack.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"We are given the source code and a module, this is what \",(0,n.jsx)(e.code,{children:\"chal.py\"}),\" looks like:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` ast\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` threading\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" exportcipher \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" flag \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` FLAG\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"except\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    FLAG \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"test{FLAG}\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"MAX_COUNT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"TIMEOUT \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"120\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# seconds\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"input_bytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"display_msg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    m \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"display_msg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        m \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" ast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"literal_eval\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"m\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"except\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# might not be valid str or bytes literal but could still be valid input, so just encode it\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"pass\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"isinstance\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"m\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"str\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        m \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" m\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"isinstance\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"m\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` m\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"timeout_handler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Time is up, you can throw out your work as the key changed.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    exit\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" __name__ \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"__main__\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Initializing Export Grade Cipher...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from_bytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"urandom\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    cipher \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" ExportGradeCipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"You may choose up to {} plaintext messages to encrypt.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"MAX_COUNT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Recover the 40-bit key to get the flag.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"You have {} seconds.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"TIMEOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# enough time to crack a 40 bit key with the compute resources of a government\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    threading\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Timer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"TIMEOUT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" timeout_handler\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"start\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"while\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\" MAX_COUNT\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        pt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" input_bytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[MSG {}] plaintext: \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"not\"}),\" pt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"break\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"pt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"512\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# don't allow excessively long messages\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Message Too Long!\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"continue\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        nonce \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"urandom\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"256\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        cipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"init_with_nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        ct \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" cipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encrypt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"pt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[MSG {}] nonce: {}\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[MSG {}] ciphertext: {}\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" ct\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# sanity check decryption\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        cipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"init_with_nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" pt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" cipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"decrypt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ct\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    recovered_key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" ast\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"literal_eval\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Recovered Key: \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"isinstance\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"recovered_key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" recovered_key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"That is the key! Here is the flag: {}\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"FLAG\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Wrong!\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"So here we can encrypt 100 ciphertexts using \",(0,n.jsx)(e.code,{children:\"ExportGradeCipher\"}),\", each with a different nonce. Then we have to guess the 40-bit key.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"So how does \",(0,n.jsx)(e.code,{children:\"ExportGradeCipher\"}),\" work?\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` os\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"LFSR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"__init__\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" seed\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" taps\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" seed \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seed \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"}),\" size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"taps\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"and\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),` taps\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` seed\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"taps \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` taps\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mask \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"_shift\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        feedback \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" tap \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"taps\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            feedback \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"}),\" tap\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" feedback\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`mask\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"next_byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        val \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xFF\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" _ \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_shift\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` val\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ExportGradeCipher\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"__init__\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 40 bit key\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"40\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` key\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"initialized \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"False\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"init_with_nonce\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 256 byte nonce, nonce size isnt export controlled so hopefully this will compensate for the short key size\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"256\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr17 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" LFSR\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xFFFF\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"9\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"11\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"14\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"17\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr32 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" LFSR\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xAB\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"24\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xFFFFFFFF\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"23\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"24\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"25\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"26\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"30\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"31\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"32\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"256\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Fisher-Yates shuffle S-table\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"255\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# generate j s.t. 0 \u003c= j \u003c= i, has modulo bias but good luck exploiting that\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            j \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"%\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        j \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# use nonce to scramble S-table some more\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"256\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            j \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"j \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"%\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"256\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" _ \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"256\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"256\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"initialized \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"_update\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` v\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` i\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"encrypt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" msg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`initialized\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        ct \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" v \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" msg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            ct \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"to_bytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_update\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` ct\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"decrypt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" ct\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`initialized\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        msg \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" v \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" ct\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            vo \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            msg \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" vo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"to_bytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_update\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"vo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` msg\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" __name__ \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"__main__\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    cipher \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" ExportGradeCipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from_bytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"urandom\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    nonce \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"urandom\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"256\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"=\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"50\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Cipher Key: {}\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Nonce: {}\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    msg \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"...\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"=\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"50\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Plaintext: {}\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"msg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    cipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"init_with_nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    ct \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" cipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encrypt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"msg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"=\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"50\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Ciphertext: {}\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ct\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    cipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"init_with_nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"nonce\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    dec \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" cipher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"decrypt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ct\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"=\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"50\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Decrypted: {}\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"dec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" msg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),` dec\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"except\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Decryption failed\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Essentially it generates a very scrambled S-box using the key and nonce, and then does substitution to the plaintext. But to add more confusion we update the S-box for every character that we substitute.\"}),`\n`,(0,n.jsx)(e.p,{children:\"So how do we approach this problem? We can start by analyzing some possible simple attacks first:\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"bruteforce\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#bruteforce\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Bruteforce?\"]}),`\n`,(0,n.jsx)(e.p,{children:\"As noted by the comments as well, it seems very unlikely to bruteforce the whole 40-bit key in reasonable time. However, do take a look at how the key is actually used:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr17 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" LFSR\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xFFFF\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"9\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"11\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"14\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"17\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr32 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" LFSR\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xAB\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"24\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xFFFFFFFF\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"23\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"24\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"25\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"26\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"30\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"31\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"32\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"So it breaks the key into 2 parts, the last 16 bits are used for LFSR17, and the other 24 bits are used for LFSR32.\"}),`\n`,(0,n.jsx)(e.p,{children:\"This means that although we can\\u2019t bruteforce the entire key, we might be able to just bruteforce the LFSR17 which is 16 bits of the key in case we need it. This observation alone will not lead us to the solution but it will be used later.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The other thing that we might need to note is that everything here operates using this LFSR, in LFSR we can shift and also unshift the state. This means that if we recover any state of the LSFR, we can unshift them back to the original key.\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"recovering-lfsr-state\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#recovering-lfsr-state\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Recovering LFSR State\"]}),`\n`,(0,n.jsx)(e.p,{children:\"So the idea is getting clearer, we want to extract the state of the LFSR, preferably LFSR32 since as we discuss previously we can just perform bruteforcing to find LFSR17. We can analyze this very confusing S-box generating function and we can probably find some crazy relation with the LFSR state maybe?\"}),`\n`,(0,n.jsx)(e.p,{children:\"There is just one problem: IT IS WAY TOO SCRAMBLY\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let\\u2019s just cross the \",(0,n.jsx)(e.code,{children:\"init_with_nonce\"}),\" out and suppose it\\u2019s secure, there is only one place left where the LFSR is actually used, the \",(0,n.jsx)(e.code,{children:\"_update()\"}),\" function.\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"_update\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#_update\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),(0,n.jsx)(e.code,{children:\"_update()\"})]}),`\n`,(0,n.jsx)(e.p,{children:\"We know how the encryption works, it substitutes the plaintext using the generated S-box and then updates the S-box by swapping the value for the current character with another number produced by the LFSR.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"_update\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` v\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` i\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"encrypt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" msg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`initialized\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    ct \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" v \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" msg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        ct \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"to_bytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_update\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` ct\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"This is interesting because it makes it such that the same consecutive characters will have different values. You can try it yourself, it will give different values for each consecutive character.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/static/images/uoftctf-2024/pt-ct-mapping.png\",alt:'Image of plaintext \"AAAA\" mapping to ciphertext with 4 different bytes'})}),`\n`,(0,n.jsxs)(e.p,{children:[\"But do take a look at the code again, what \",(0,n.jsx)(e.em,{children:\"if\"}),\" v is equal to i?\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"_update\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` v\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` i\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"If \",(0,n.jsx)(e.code,{children:\"v == i\"}),\", then the S-box will not change, thus the consecutive characters WILL HAVE THE SAME VALUE!\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let\\u2019s try to check the \",(0,n.jsx)(e.code,{children:\"i\"}),\" value and give inputs that match it. I updated the script and also doesn\\u2019t print the nonce for debug purposes:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"_update\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"hex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` v\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S_inv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"S\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` i\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/static/images/uoftctf-2024/output-update.png\",alt:\"Image of output corresponding to _update\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"So we are right, we can now extract \",(0,n.jsx)(e.code,{children:\"i\"}),\" by trying all to input a consecutive value. This works for any index too:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/static/images/uoftctf-2024/output-update-any-idx.png\",alt:\"Image of output for any index\"})}),`\n`,(0,n.jsxs)(e.h2,{id:\"putting-it-all-together\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#putting-it-all-together\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Putting it all together\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"We know \",(0,n.jsx)(e.code,{children:\"i\"}),\" is just xor of the 2 states of the LFSR, and we can bruteforce for LFSR17, so in order to get the full state of LFSR32, we need 4 consecutive \",(0,n.jsx)(e.code,{children:\"i\"}),\"s (each \",(0,n.jsx)(e.code,{children:\"i\"}),\" is 1 byte and LFSR32 is 4 bytes). Because we can only do 100 plaintexts, it\\u2019s not guaranteed, but the length limit is not bad (512 bytes) so we have a very decent chance that at least 4 consecutive \",(0,n.jsx)(e.code,{children:\"i\"}),\"s among the 512 have a value below 100.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"After recovering 4 consecutive \",(0,n.jsx)(e.code,{children:\"i\"}),\" values, we can bruteforce all LFSR17, get the state of LFSR32, and unshift them enough to get the original key.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"It needs a little bit of calculation but basically the \",(0,n.jsx)(e.code,{children:\"init_with_nonce\"}),\" function does 511 \",(0,n.jsx)(e.code,{children:\"next_byte\"}),\" per LFSR so it\\u2019s 4088 shifts, we also need to add the the starting point from the 512 bytes that we encrypt. 4088 shifts is a lot of work even to bruteforce the LFSR17 so I recommend to do a precalculation before connecting to the remote server.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Full solver:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" wrth \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" tqdm \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` tqdm\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"LFSR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"__init__\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" seed\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" taps\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" seed \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seed \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"}),\" size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"taps\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"and\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),` taps\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` seed\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"taps \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` taps\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mask \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` size\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"_shift\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        feedback \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" tap \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"taps\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            feedback \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"}),\" tap\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" feedback\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`mask\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"_unshift\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        feedback \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" tap \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"taps\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            feedback \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"}),\" tap\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" feedback \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"next_byte\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        val \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xFF\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" _ \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_shift\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` val\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"lfsr17precalc \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"precalc\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" tqdm\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"**\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    lfsr17 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" LFSR\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0xFFFF\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"9\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"11\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"14\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"17\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" _ \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4088\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_shift\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    lfsr17precalc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"append\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" con\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"nc 0.cloud.chals.io 23753\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"recover_i\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    res \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"512\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"generating ciphertext...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" tqdm\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"100\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        secret \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        test \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"512\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"sendlineafter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'b\"plaintext: \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"str\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"test\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"recvuntil\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'b\"nonce: \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        nonce \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"recvline\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"recvuntil\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'b\"ciphertext: \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        ct \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"eval\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"recvline\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" j \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"512\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" ct\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" ct\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"break\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    starting \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"and\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"and\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"and\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            starting \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` i\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"break\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" starting \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"run again\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        exit\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"starting \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    recovered \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"starting\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"starting\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"recovered \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" starting\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" recovered\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` res\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"starting\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" recovered\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" recover_i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"shiftamount \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4088\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"starting\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" keylsb \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" tqdm\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"**\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    lfsr32state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    lfsr17 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" lfsr17precalc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"keylsb\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" _ \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"starting\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_shift\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        lfsr32state\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"append\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),\" recovered\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    lfsr32state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from_bytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bytes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"lfsr32state\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    lfsr32 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" LFSR\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"lfsr32state\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"23\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"24\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"25\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"26\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"30\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"31\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"32\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    good \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_unshift\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_unshift\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"starting\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        byte17 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" lfsr17\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        byte32 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"next_byte\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" byte17 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"^\"}),\" byte32 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                good \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"False\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"break\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" good\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"starting\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" j \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_unshift\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"shiftamount\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"_unshift\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        keymsb \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"lfsr32\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"**\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"24\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"keymsb\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"keylsb\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"keymsb \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),` keylsb\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"sendlineafter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'b\"Key: \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"str\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"interactive\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Flag:\"}),\" \",(0,n.jsx)(e.code,{children:\"uoftctf{wH0_w0u1D_h4ve_7houGHt_l0ng_nONceS_CAnt_S4ve_w3ak_KeYS}\"})]})]})}}var w=y;return g;})();\n;return Component;","toc":[{"value":"Export Grade Cipher (Crypto, 10 Solves)","url":"#export-grade-cipher-crypto-10-solves","depth":2},{"value":"Bruteforce?","url":"#bruteforce","depth":3},{"value":"Recovering LFSR State","url":"#recovering-lfsr-state","depth":3},{"value":"_update()","url":"#_update","depth":3},{"value":"Putting it all together","url":"#putting-it-all-together","depth":2}],"frontMatter":{"readingTime":{"text":"19 min read","minutes":18.74,"time":1124400,"words":3748},"slug":"uoftctf-2024/export-grade-cipher","fileName":"uoftctf-2024/export-grade-cipher.md","title":"UofTCTF 2024 – Export Grade Cipher","date":"2024-01-15T00:00:00.000Z","draft":false,"authors":["wrth"],"tags":["UofTCTF 2024","Crypto","LFSR"],"summary":"Recover LFSR by using chosen plaintext in a faulty cipher"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.18,"time":10800,"words":36},"slug":["wrth"],"fileName":"wrth.md","name":"Wrth","avatar":"https://www.gravatar.com/avatar/11bd96e570fd4e221e1592df8dd95894?d=identicon\u0026size=256","specialties":["Crypto"],"twitter":"https://twitter.com/Wrth1_","linkedin":"https://www.linkedin.com/in/bill-elim/","github":"https://github.com/Wrth1","member":true,"order":26,"description":"sleeps way too much","date":null}],"prev":{"title":"IrisCTF 2024 – Sharing is Caring","date":"2024-01-07T00:00:00.000Z","draft":false,"authors":["legoclones"],"tags":["IrisCTF 2024","Misc","RF","Networks"],"summary":"Use DS-CDMA to isolate multiple signals being sent over the same communication channel","canonical":"https://justinapplegate.me/2024/irisctf-sharingiscaring","slug":"irisctf-2024/sharing-is-caring"},"next":{"title":"Real World CTF 6th – SafeBridge","date":"2024-01-29T00:00:00.000Z","draft":false,"authors":["yanhu"],"tags":["Real World CTF 6th","Blockchain","Web3","Smart Contract","Solidity","Cross Chain","Data Validation"],"summary":"Exploiting cross-chain bridge vulnerabilities to drain tokens from the bridge","canonical":"https://yanhuijessica.github.io/Chictf-Writeups/blockchain/safebridge","slug":"real-world-ctf-6th/safebridge"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["uoftctf-2024","export-grade-cipher"]},"buildId":"0wxHpwy3ehtFejYPlY-Z7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>