{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var r=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var t=a=>l(a,\"__esModule\",{value:!0});var u=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of d(s))!m.call(a,e)&&e!==\"default\"&&l(a,e,{get:()=>s[e],enumerable:!(c=p(s,e))||c.enumerable});return a},g=a=>k(t(l(a!=null?r(h(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=u((x,i)=>{i.exports=_jsx_runtime});var b={};N(b,{default:()=>y,frontmatter:()=>w});var n=g(o()),w={title:\"GDG Algiers CTF 2022 \\u2013 MLM\",date:\"2022-10-09\",draft:!1,authors:[\"sahuang\"],tags:[\"GDG Algiers 2022\",\"Misc\",\"Forensics\",\"pcapng\",\"AI\",\"Bert\"],summary:\"Analyze pcapng for BERT layer data, then predict flag with Masked Language Modelling.\",canonical:\"https://sahuang.github.io/writeups/gdg-algiers-ctf-2022\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",blockquote:\"blockquote\",p:\"p\",code:\"code\",em:\"em\",pre:\"pre\",img:\"img\",ul:\"ul\",li:\"li\",ol:\"ol\",math:\"math\",semantics:\"semantics\",mrow:\"mrow\",mn:\"mn\",mo:\"mo\",annotation:\"annotation\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"mlm-misc-500-points\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#mlm-misc-500-points\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"MLM (Misc, 500 points)\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:\"We\\u2019ve captured some traffic destined to an AI student, can u analyse it?\"}),`\n`,(0,n.jsx)(e.p,{children:\"Author : Aymen\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Attachment: \",(0,n.jsx)(e.a,{href:\"https://mega.nz/file/S9JzSRjQ#jFjg_DO93t5xAwp-f5muyCvm_TlcSEkhzJjE6g8qI6I\",children:\"Capture.pcapng\"})]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"After an exciting weekend of SekaiCTF, our team played \",(0,n.jsx)(e.a,{href:\"https://ctftime.org/event/1745\",children:\"GDG Algiers CTF 2022\"}),\" and we won the first place. Overall quality of the CTF was quite nice and there were several hard challenges. I would like to make a writeup on one challenge, namely \",(0,n.jsx)(e.code,{children:\"MLM\"}),\" in misc category. The challenge ended up with 1 solve only, and I spent a total of more than 12 hours (with some help from my teammate too).\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"forensics-analysis\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#forensics-analysis\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Forensics Analysis\"]}),`\n`,(0,n.jsx)(e.p,{children:\"The challenge is (sadly) about AI, which none of me and my team members have any prior experience with. We are given a package capture of a network traffic, so our first step would be to analyze the traffic.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Once opened in \",(0,n.jsx)(e.em,{children:\"Wireshark\"}),\", we immediately noticed there are a lot of FTP streams. If we follow the TCP stream of any of them, we can see the communication between client and server:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-text\",children:(0,n.jsxs)(e.code,{className:\"language-text code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`220---------- Welcome to Pure-FTPd [privsep] [TLS] ----------\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`220-You are user number 1 of 5 allowed.\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`220-Local time is now 10:18. Server port: 21.\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`220-This is a private system - No anonymous login\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`220-IPv6 connections are also welcome on this server.\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`220 You will be disconnected after 15 minutes of inactivity.\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`USER alBERT\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`331 User alBERT OK. Password required\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`PASS dBASE\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`230 OK. Current directory is /\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CWD .\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`250 OK. Current directory is /\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`TYPE I\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`200 TYPE is now 8-bit binary\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`PASV\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`227 Entering Passive Mode (127,0,0,1,117,48)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RETR layer0.pkl\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`150-Accepted data connection\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`150 91566.2 kbytes to download\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`226-File successfully transferred\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`226 0.603 seconds (measured here), 148.29 Mbytes per second\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"So it seems that the user \",(0,n.jsx)(e.code,{children:\"alBERT\"}),\" is trying to download a file \",(0,n.jsx)(e.code,{children:\"layer0.pkl\"}),\" from the server. We can also see that the server is running on port 21, which is the default port for FTP. Scrolling to the bottom of the packet list, we can see that there are in total 403 streams, and user has downloaded \",(0,n.jsx)(e.code,{children:\"layer0.pkl\"}),\" to \",(0,n.jsx)(e.code,{children:\"layer201.pkl\"}),\", a total of 202 files.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/static/images/gdg-algiers-2022/tcp.png\",alt:\"A TCP stream from Wireshark, showing the content of a Pickle file rendered in ASCII\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Perfect. Now we can first download all of them from \",(0,n.jsx)(e.code,{children:\"pcapng\"}),\", and somehow unpickle them and analyze the data inside. The following script has been used to extract the files:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token shebang important\",children:\"#!/bin/bash\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token for-or-select variable\",children:\"i\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"404\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"do\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   tshark -r Capture.pcapng -Y usb -z follow,tcp,raw,\",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$i\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" session_\",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$i\"}),`.pkl\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"done\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"dealing-with-layers\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#dealing-with-layers\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Dealing with layers\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"After getting a bunch of files (\",(0,n.jsx)(e.code,{children:\"session_1.pkl\"}),\" to \",(0,n.jsx)(e.code,{children:\"session_403.pkl\"}),\"), we can use the following script to extract the data inside:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"pks \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"404\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"file\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"session_'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'.pkl\"'})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    t \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" np\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"load\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"open\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"file\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"rb\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" allow_pickle\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    pks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"append\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now \",(0,n.jsx)(e.code,{children:\"pks\"}),\" will contain all the data. If we try to print it, we can see each \",(0,n.jsx)(e.code,{children:\"pkl\"}),\" file is loaded to a numpy array of floats.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"language-zsh code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`>>> pks[0]\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`array([ 3.0280282e-03, -1.7906362e-03,  5.7056175e-05, ...,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`       -1.7809691e-02,  3.6876060e-02,  1.3254955e-02], dtype=float32)\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Now I have been stuck here for a few hours (there was no hint when I reached here). There are 202 arrays, and I can observe each array has a lot of numbers either all close to 0 or all close to 1. Maybe concatenating all layers gives the binary flag?\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"language-zsh code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`>>> res = \"\"\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`>>> for i in pks:\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`...     xd = max(i)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`...     if xd > 0.5:\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`...         res += \"1\"\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`...     else:\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`...         res += \"0\"\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`>>> res\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`0001000000000100000100000000010000010000000001000001000000000100000100000000010000010000000001000001000000000100000100000000010000010000000001000001000000000100000100000000010000010000000001000001000010\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Playing around in CyberChef, I did not get anything even printable. I guess it won\\u2019t be so easy, otherwise where would the \",(0,n.jsx)(e.code,{children:\"AI\"}),\" tag came from? At this stage, I tried to talk to admin and they gave hints afterwards.\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:\"For people looking to know which model it is, take these pieces of information into consideration:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"do you know what MLM stands for in ai?\"}),`\n`,(0,n.jsx)(e.li,{children:\"the username is your way to the model\"}),`\n`,(0,n.jsx)(e.li,{children:\"default config is being used\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"dealing-with-layers-again\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#dealing-with-layers-again\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Dealing with layers (again)\"]}),`\n`,(0,n.jsx)(e.p,{children:\"After getting the hints, I figured out the answers to those 3 questions:\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"MLM stands for Masked Language Modeling\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://towardsdatascience.com/masked-language-modelling-with-bert-7d49793e5d2c\",children:\"Here\"}),\" is an article that explained MLM very well.\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"My guessing is that we probably need to input flag format with masks, e.g. \",(0,n.jsx)(e.code,{children:\"CyberErudites{[MASKED]}\"}),\", then the model will predict the masked part?\"]}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"The username is \",(0,n.jsx)(e.code,{children:\"alBERT\"}),\", hinting towards a \",(0,n.jsx)(e.code,{children:\"BERT\"}),\" model.\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"We just use the default config of \",(0,n.jsx)(e.code,{children:\"BERT\"}),\".\"]}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Still, there are a number of issues to resolve:\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"If we print out dimensions of all layers, they are all multiples of 768, but some are very large (23440896, 393216, ...). I noticed default \",(0,n.jsx)(e.code,{children:\"BERT\"}),\" has 12 layers, each of size 768. So how can we convert these large numbers to 768?\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"I have no idea how to load \",(0,n.jsx)(e.code,{children:\"BERT\"}),\" model and change the weights somehow.\"]}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"That is the end of day 1 so I went to sleep. During the 6 hours, my teammate made some progress and we figured out that, indeed \",(0,n.jsx)(e.code,{children:\"BERT\"}),\" does have only 12 layers, but if we take a look at each layer we will find that each one consists of query, key, value, dropout, etc. Also there are hints 2 and 3:\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:\"The layers had been flattened before being sent. You need to reshape them.\"}),`\n`,(0,n.jsx)(e.p,{children:\"tokenizer = BertTokenizer.from_pretrained('bert-base-uncased')\"}),`\n`,(0,n.jsx)(e.p,{children:\"model = BertForMaskedLM(config=BertConfig())\"}),`\n`,(0,n.jsx)(e.p,{children:\"using model.parameters reshape and update the layers\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Let\\u2019s have a try.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" transformers \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" BertModel\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" BertConfig\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" BertTokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` BertForMaskedLM\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` torch\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"tokenizer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" BertTokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from_pretrained\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'bert-base-uncased'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" BertForMaskedLM\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"BertConfig\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"parameters\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"We get the following:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-text\",children:(0,n.jsxs)(e.code,{className:\"language-text code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`<bound method ModuleUtilsMixin.num_parameters of BertModel(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  (embeddings): BertEmbeddings(\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    (word_embeddings): Embedding(30522, 768, padding_idx=0)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    (position_embeddings): Embedding(512, 768)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    (token_type_embeddings): Embedding(2, 768)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    (dropout): Dropout(p=0.1, inplace=False)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`[Truncated]\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The first 2 entries of \",(0,n.jsx)(e.code,{children:\"pks\"}),\" have size of \",(0,n.jsx)(e.span,{className:\"math math-inline\",children:(0,n.jsxs)(e.span,{className:\"katex\",children:[(0,n.jsx)(e.span,{className:\"katex-mathml\",children:(0,n.jsx)(e.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsxs)(e.mrow,{children:[(0,n.jsx)(e.mn,{children:\"23440896\"}),(0,n.jsx)(e.mo,{children:\"=\"}),(0,n.jsx)(e.mn,{children:\"30522\"}),(0,n.jsx)(e.mo,{children:\"\\xD7\"}),(0,n.jsx)(e.mn,{children:\"768\"})]}),(0,n.jsx)(e.annotation,{encoding:\"application/x-tex\",children:\"23440896 = 30522 \\\\times 768\"})]})})}),(0,n.jsxs)(e.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:[(0,n.jsxs)(e.span,{className:\"base\",children:[(0,n.jsx)(e.span,{className:\"strut\",style:{height:\"0.6444em\"}}),(0,n.jsx)(e.span,{className:\"mord\",children:\"23440896\"}),(0,n.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2778em\"}}),(0,n.jsx)(e.span,{className:\"mrel\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2778em\"}})]}),(0,n.jsxs)(e.span,{className:\"base\",children:[(0,n.jsx)(e.span,{className:\"strut\",style:{height:\"0.7278em\",verticalAlign:\"-0.0833em\"}}),(0,n.jsx)(e.span,{className:\"mord\",children:\"30522\"}),(0,n.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2222em\"}}),(0,n.jsx)(e.span,{className:\"mbin\",children:\"\\xD7\"}),(0,n.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2222em\"}})]}),(0,n.jsxs)(e.span,{className:\"base\",children:[(0,n.jsx)(e.span,{className:\"strut\",style:{height:\"0.6444em\"}}),(0,n.jsx)(e.span,{className:\"mord\",children:\"768\"})]})]})]})}),\" and \",(0,n.jsx)(e.span,{className:\"math math-inline\",children:(0,n.jsxs)(e.span,{className:\"katex\",children:[(0,n.jsx)(e.span,{className:\"katex-mathml\",children:(0,n.jsx)(e.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsxs)(e.mrow,{children:[(0,n.jsx)(e.mn,{children:\"393216\"}),(0,n.jsx)(e.mo,{children:\"=\"}),(0,n.jsx)(e.mn,{children:\"512\"}),(0,n.jsx)(e.mo,{children:\"\\xD7\"}),(0,n.jsx)(e.mn,{children:\"768\"})]}),(0,n.jsx)(e.annotation,{encoding:\"application/x-tex\",children:\"393216 = 512 \\\\times 768\"})]})})}),(0,n.jsxs)(e.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:[(0,n.jsxs)(e.span,{className:\"base\",children:[(0,n.jsx)(e.span,{className:\"strut\",style:{height:\"0.6444em\"}}),(0,n.jsx)(e.span,{className:\"mord\",children:\"393216\"}),(0,n.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2778em\"}}),(0,n.jsx)(e.span,{className:\"mrel\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2778em\"}})]}),(0,n.jsxs)(e.span,{className:\"base\",children:[(0,n.jsx)(e.span,{className:\"strut\",style:{height:\"0.7278em\",verticalAlign:\"-0.0833em\"}}),(0,n.jsx)(e.span,{className:\"mord\",children:\"512\"}),(0,n.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2222em\"}}),(0,n.jsx)(e.span,{className:\"mbin\",children:\"\\xD7\"}),(0,n.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2222em\"}})]}),(0,n.jsxs)(e.span,{className:\"base\",children:[(0,n.jsx)(e.span,{className:\"strut\",style:{height:\"0.6444em\"}}),(0,n.jsx)(e.span,{className:\"mord\",children:\"768\"})]})]})]})}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Great! We can exactly match 202 layer arrays with all \",(0,n.jsx)(e.code,{children:\"BERT\"}),\" parameters. Now we just need to reshape them and update the weights. Note I did some printing here to validate data shape is correct.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"shapes \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" param \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"enumerate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"parameters\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" j \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"param\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    shapes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"append\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"param\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" param \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"enumerate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"parameters\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# update param to our weights\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# if 2d, need to reshape pks[j]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"shapes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        param\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from_numpy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"pks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"view\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"shapes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        param\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from_numpy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"pks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" param \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"enumerate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"parameters\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" j \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"param\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" param\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" shapes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Thanks to \",(0,n.jsx)(e.em,{children:\"Copilot\"}),\", all the code except comments were automatically filled in. And we are happy to see parameters were indeed updated.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`tensor([[ 0.0000,  0.0000,  0.0000,  ...,  0.0000,  0.0000,  0.0000],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        [-0.0052,  0.0246,  0.0104,  ..., -0.0139, -0.0018,  0.0093],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        [-0.0145,  0.0070, -0.0057,  ..., -0.0404,  0.0120,  0.0009],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        ...,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        [ 0.0275, -0.0102,  0.0191,  ..., -0.0005,  0.0455,  0.0310],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        [-0.0179, -0.0146, -0.0174,  ...,  0.0098, -0.0223,  0.0121],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        [-0.0085, -0.0045, -0.0039,  ..., -0.0606, -0.0018,  0.0113]])\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`tensor([[ 3.0280e-03, -1.7906e-03,  5.7056e-05,  ..., -1.2136e-04,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          1.6935e-03, -1.5684e-03],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        [-1.3746e-02, -6.2399e-03,  1.6096e-02,  ...,  2.0177e-02,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          2.0433e-02, -1.9886e-02],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        [ 3.5869e-02, -3.5923e-02, -2.1710e-02,  ..., -2.9126e-03,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          8.1522e-03, -6.2686e-03],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        ...,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        [-9.2989e-03,  2.8955e-02, -2.1906e-02,  ...,  1.1191e-02,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          2.1969e-02, -6.1168e-03],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        [ 2.5005e-02, -4.3759e-03, -2.5020e-03,  ...,  4.6897e-03,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          4.4512e-02,  7.9216e-03],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        [ 4.7227e-02, -2.3265e-02, -9.8726e-03,  ..., -1.7810e-02,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          3.6876e-02,  1.3255e-02]])\n`})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"get-flag\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#get-flag\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Get flag\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now the remaining step would be just to use the model to predict the flag. We can use \",(0,n.jsx)(e.code,{children:\"CyberErudites{[MASKED]}\"}),\" as input, and the model will predict the masked part.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"text \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"CyberErudites{\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mask_token \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"}\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encode_plus\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"text\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" return_tensors \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"pt\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"mask_index \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"where\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"input_ids\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mask_token_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"**\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"logits \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" output\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`logits\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"softmax \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" F\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"softmax\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"logits\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dim \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"mask_word \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" softmax\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" mask_index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"top_10 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"topk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mask_word\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dim \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Predict top 10\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" token \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" top_10\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   word \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"decode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   new_sentence \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" text\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mask_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" word\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"new_sentence\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Looks good? The output is quite disappointing:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`CyberErudites{l}\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CyberErudites{##3}\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CyberErudites{m}\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CyberErudites{practiced}\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CyberErudites{s}\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CyberErudites{infinity}\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CyberErudites{specialists}\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CyberErudites{##5}\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CyberErudites{##u}\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CyberErudites{might}\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Hmm, what could go wrong? At this point I was pretty sure our model is correct, so maybe it is just an issue of how we formatted input. Thanks to my teammate, he pointed out an important part: if we just make the whole input as a mask, the first word to be predicted will be \",(0,n.jsx)(e.code,{children:\"cyber\"}),\"!\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\">>\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" text \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`mask_token\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encode_plus\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"text\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" return_tensors \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"pt\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" mask_index \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"where\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"input_ids\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mask_token_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"**\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" logits output\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`logits\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" softmax \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" F\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"softmax\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"logits\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dim \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" mask_word \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" softmax\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" mask_index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" top_10 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"topk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mask_word\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dim \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" token \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" top_10\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"     word \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"decode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"     new_sentence \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" text\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mask_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" word\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"     \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"new_sentence\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`cyber\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"##me\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`y\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"##3\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`hobbs\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`curiously\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"So we just need to recursively add text to initially empty flag until we get the whole flag. Notice that sometimes code will output \",(0,n.jsx)(e.code,{children:\"##\"}),\", we just need to remove them. Here is the full code:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-py\",children:(0,n.jsxs)(e.code,{className:\"language-py code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nn \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" functional \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),` F\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" transformers \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" BertModel\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" BertConfig\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" BertTokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` BertForMaskedLM\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` torch\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" pickle\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" numpy \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),` np\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"pks \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# store all the weights\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"404\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"file\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"session_'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'.pkl\"'})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    t \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" np\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"load\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"open\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"file\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"rb\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" allow_pickle\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    pks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"append\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"tokenizer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" BertTokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from_pretrained\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'bert-base-uncased'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"model \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" BertForMaskedLM\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"BertConfig\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"shapes \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" param \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"enumerate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"parameters\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    shapes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"append\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"param\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" param \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"enumerate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"parameters\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# update param to our weights\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# if 2d, need to reshape pks[j]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"shapes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        param\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from_numpy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"pks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"view\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"shapes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        param\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from_numpy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"pks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"flag \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"''\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"while\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"not\"}),\" flag\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"endswith\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'}'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    text \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" flag \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`mask_token\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encode_plus\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"text\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" return_tensors \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"pt\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    mask_index \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"where\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"input_ids\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mask_token_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"**\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"input\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    logits \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" output\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`logits\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    softmax \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" F\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"softmax\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"logits\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dim \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    mask_word \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" softmax\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" mask_index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    top_10 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"topk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mask_word\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dim \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    word \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"decode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"top_10\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    new_sentence \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" text\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tokenizer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mask_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" word\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    flag \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" new_sentence\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'##'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"''\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"flag\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Output: \",(0,n.jsx)(e.code,{children:\"cybererudites{l4nguag3_m0d3l5_are_aw3s0me_4nd_s0_is_y0u}\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Finally solved this an hour before CTF ended!\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"conclusion\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#conclusion\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"This challenge quite difficult mainly because none of us has any prior experience in AI. The forensics part is straightforward, but it is kinda tricky with the \",(0,n.jsx)(e.code,{children:\"pkl\"}),\" models and how we updated parameters in default \",(0,n.jsx)(e.code,{children:\"BERT\"}),\" model. Probably would not have finished it without admin hints.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"It is a really nice challenge to learn about AI from reading documentations and trial-and-error. I would definitely recommend this challenge to anyone who wants to learn more about AI.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Shoutout to my teammates BattleMonger and Zafirr for the support. Also thanks to Aymen for the interesting challenge!\"})]})}}var y=f;return b;})();\n;return Component;","toc":[{"value":"MLM (Misc, 500 points)","url":"#mlm-misc-500-points","depth":2},{"value":"Forensics Analysis","url":"#forensics-analysis","depth":2},{"value":"Dealing with layers","url":"#dealing-with-layers","depth":2},{"value":"Dealing with layers (again)","url":"#dealing-with-layers-again","depth":2},{"value":"Get flag","url":"#get-flag","depth":2},{"value":"Conclusion","url":"#conclusion","depth":2}],"frontMatter":{"readingTime":{"text":"13 min read","minutes":12.13,"time":727800,"words":2426},"slug":"gdg-algiers-2022/mlm","fileName":"gdg-algiers-2022/mlm.md","title":"GDG Algiers CTF 2022 – MLM","date":"2022-10-09T00:00:00.000Z","draft":false,"authors":["sahuang"],"tags":["GDG Algiers 2022","Misc","Forensics","pcapng","AI","Bert"],"summary":"Analyze pcapng for BERT layer data, then predict flag with Masked Language Modelling.","canonical":"https://sahuang.github.io/writeups/gdg-algiers-ctf-2022"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.2,"time":12000,"words":40},"slug":["sahuang"],"fileName":"sahuang.md","name":"sahuang","avatar":"https://www.gravatar.com/avatar/740255f8ddc8f903d3addafb219ea077?d=identicon&s=256","specialties":["Crypto","Reverse"],"github":"https://github.com/sahuang","linkedin":"https://www.linkedin.com/in/xiaohai-xu-1a8884138/","member":true,"order":0,"description":"Rhythm Gamer. Also the team founder.","date":null}],"prev":{"title":"BSidesTLV 2022 CTF – SEV","date":"2022-07-01T00:00:00.000Z","draft":false,"authors":["radewoosh"],"tags":["BSidesTLV 2022","Crypto","ECC","Elliptic Curve"],"summary":"Steal secret key and get the flag.","slug":"bsidestlv-2022/sev"},"next":{"title":"STACK The Flags 2022 Open – Fullpwn","date":"2022-12-05T00:00:00.000Z","draft":false,"authors":["elleuch"],"tags":["STACK The Flags 2022","fullpwn","Electron","XSS","RCE","Selenium","HackTheBox"],"summary":"Fullpwn Solutions from STACK The Flags CTF","slug":"stack-the-flags-2022/fullpwn"}},"__N_SSG":true}